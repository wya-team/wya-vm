(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"./src/libs/vm.min.js":function(t,n,e){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),o=e("./node_modules/lodash/lodash.js"),a=e("./node_modules/@wya/utils/lib/index.js"),s=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),l=e("./node_modules/@babel/runtime/helpers/typeof.js"),d=e("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),A=e("./node_modules/@babel/runtime/helpers/classCallCheck.js"),c=e("./node_modules/@babel/runtime/helpers/createClass.js"),m=e("./node_modules/@babel/runtime/helpers/assertThisInitialized.js"),u=e("./node_modules/@babel/runtime/helpers/inherits.js"),h=e("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),p=e("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),g=e("./node_modules/vue/dist/vue.esm.js"),f=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),b=e("./node_modules/@babel/runtime/regenerator/index.js"),v=e("./node_modules/@wya/vc/lib/customer/index.js"),x=e("./node_modules/@wya/vc/lib/portal/index.js"),E=e("./node_modules/@wya/vc/lib/slider/index.js"),y=e("./node_modules/@wya/vc/lib/select/index.js"),w=e("./node_modules/@wya/vc/lib/option/index.js"),C=e("./node_modules/@wya/vc/lib/clipboard/index.js"),_=e("./node_modules/@wya/vc/lib/utils/index.js"),$=e("./node_modules/@wya/vc/lib/icon/index.js"),k=e("./node_modules/@wya/vc/lib/html-img/index.js"),B=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js");function D(t){return t&&"object"===i(t)&&"default"in t?t:{default:t}}var S=D(r),O=D(s),M=D(l),z=D(d),T=D(A),F=D(c),N=D(m),U=D(u),Y=D(h),L=D(p),I=D(g),R=D(f),W=D(b),P=D(v),X=D(x),j=D(E),H=D(y),q=D(w),G=D(C),V=D($),K=D(k),J=D(B),Z="@wya/vm/selection",Q={TOP:"TOP",BOTTOM:"BOTTOM",UP:"UP",DOWN:"DOWN",DELETE:"DELETE",SELECTION:"SELECTION",LOCK:"LOCK",COPY:"COPY",PASTE:"PASTE"},tt={TOP:"置顶",BOTTOM:"置底",UP:"上移一层",DOWN:"下移一层",DELETE:"删除",SELECTION:"取消组合",LOCK:function(t){return t.disabled?"取消锁定":"锁定"},COPY:"复制",PASTE:"粘帖"},nt={TOP:"p-top",BOTTOM:"p-bottom",UP:"p-move-up",DOWN:"p-move-down",DELETE:"p-delete2",SELECTION:"p-line",LOCK:"p-lock",COPY:"p-order",PASTE:"p-rotate-left"};function et(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,i)}return e}function it(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?et(Object(e),!0).forEach((function(n){S.default(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):et(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}var rt=function(){var t=!1;try{var n=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,n)}catch(t){console.log(t)}return t}(),ot=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},at=+new Date,st=0,lt=function(t){return"vm".concat(t?"-".concat(t):"","-").concat(at).concat(++st)},dt=function(t){return t!=t},At=function(t,n){for(var e in n)if(n[e].test(t[e]))return!0;return!1},ct=function(t){return{left:t.x,right:t.x+t.w,top:t.y,bottom:t.y+t.h}},mt=it(it({},console),{},{debug:function(){for(var t,n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];(t=console).log.apply(t,["%c [@wya/vm]","color: red; font-weight: bold"].concat(e))}}),ut="undefined"==typeof window,ht=!ut&&document.documentElement,pt=[0,45,90,135,180,225,270,315,360],gt={start:["touchstart","mousedown"],move:["touchmove","mousemove"],end:["touchend","touchcancel","mouseup"]},ft=!1;ut||(ht.addEventListener("keydown",(function(t){ft=16===t.keyCode||"Shift"===t.key})),ht.addEventListener("keyup",(function(t){!ft||16!==t.keyCode&&"Shift"!==t.key||(ft=!1)})));var bt={replace:!0,name:"vm-draggable",props:{handles:{type:Array,default:function(){return["top","right","bottom","left","top-left","top-right","bottom-right","bottom-left","rotate"]}},w:{type:Number,default:0,validator:function(t){return t>=0}},h:{type:Number,default:0,validator:function(t){return t>=0}},r:{type:Number,default:0},minW:{type:Number,default:36,validator:function(t){return t>0}},minH:{type:Number,default:36,validator:function(t){return t>0}},x:{type:Number,default:0},y:{type:Number,default:0},z:{type:Number,default:1},scale:{type:Number,default:1},grid:{type:Array,default:function(){return[1,1]}},guides:{type:Array,default:function(){return[[],[]]}},restrain:{type:Number,default:0},parent:{type:Boolean,default:!1},entryRegExp:{type:Object,default:function(){return{className:/vm-hack-entry/,id:/^(app|pages)$/}}},editorRegExp:{type:Object,default:function(){return{className:/vm-hack-editor/}}},prevent:{type:Boolean,default:!0},preventRegExp:{type:Object,default:function(){return{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT|OPTION)$/,className:/vm-hack-pevent/}}},module:{type:String},disabled:{type:Boolean,default:!1},closeable:{type:Boolean,default:!1},draggable:{type:Boolean,default:!0},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!0},active:{type:Boolean,default:!1},offset:{type:Array,default:function(){return[0,0]}}},data:function(){return{isResizing:!1,isDraging:!1,isRotating:!1,isChanging:!1,isActive:!1}},computed:{coord:function(){return{left:this.x+"px",top:this.y+"px",zIndex:this.z}},style:function(){return{width:0===this.w?"auto":"".concat(this.w,"px"),height:0===this.h?"auto":"".concat(this.h,"px"),transform:"rotate(".concat(this.r,"deg)")}},width:function(){var t=Math.floor(1.15*Math.sqrt(this.w*this.w+this.h*this.h));return"".concat(t,"px")},realHandles:function(){var t=this.handles;return this.rotatable||(t=t.filter((function(t){return"rotate"!==t}))),this.resizable||(t=t.filter((function(t){return"rotate"===t}))),t}},watch:{active:{immediate:!0,handler:function(t){t&&this.setActived()}}},beforeCreate:function(){this.parentX=0,this.parentY=0,this.parentW=9999,this.parentH=9999,this.mouseX=0,this.mouseY=0,this.lastMouseX=0,this.lastMouseY=0,this.mouseOffX=0,this.mouseOffY=0,this.handle=null,this.eventOpts=!rt||{capture:!0,passive:!0},this.beforeStatus=null},mounted:function(){var t=this;this.w&&this.minW>this.w&&this.sync({w:this.minW}),this.h&&this.minH>this.h&&this.sync({h:this.minH}),this.$nextTick((function(){var n=t.$el.parentNode.getBoundingClientRect(),e=n.x,i=n.y;t.parentX=e+t.offset[0],t.parentY=i+t.offset[1],t.parent&&t.calculation(),t.$emit("resizing")}))},destroyed:function(){this.operateDOMEvents("remove")},methods:{calculation:function(){var t=this.$el.parentNode.getBoundingClientRect(),n=t.width,e=t.height;if(!n||!e)throw new Error("@wya/vm: 父层容器宽度计算异常");this.parentW=n/this.scale,this.parentH=e/this.scale,this.w>this.parentW&&this.sync({w:this.parentW}),this.h>this.parentH&&this.sync({h:this.parentH}),this.x+this.w>this.parentW&&this.sync({x:this.parentW-this.w}),this.y+this.h>this.parentH&&this.sync({y:this.parentH-this.h})},sync:function(t){for(var n in t)this[n]!=t[n]&&(!this.beforeStatus&&(this.beforeStatus={x:this.x,y:this.y,z:this.z,w:this.w,r:this.r}),this.$emit("update:".concat(n),t[n]))},operateDOMEvents:function(t){var n=this,e="add"===t?ht.addEventListener:ht.removeEventListener;gt.start.forEach((function(t){e(t,n.handleDeselect,n.eventOpts)})),gt.move.forEach((function(t){e(t,n.handleMove,n.eventOpts)})),gt.end.forEach((function(t){e(t,n.handleUp,n.eventOpts)}))},setActived:function(){this.handleContainerDown(),this.handleUp()},handleContainerDown:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.prevent&&t.preventDefault&&!At(t.target,this.preventRegExp)&&t.preventDefault(),!this.disabled){var n=t.target||t.srcElement;if(!n||this.$el.contains(n)){if(!this.isActive){var e=this.getPositionByEvent(t),i=e.mousePositionX,r=e.mousePositionY;this.lastMouseX=i+ht.scrollLeft,this.lastMouseY=r+ht.scrollTop,this.operateDOMEvents("add"),this.isActive=!0,this.$emit("activated",t)}this.draggable&&(this.isDraging=!0)}}},handleDeselect:function(t){var n=this,e=this.getPositionByEvent(t),i=e.mousePositionX,r=e.mousePositionY;this.mouseX=i+ht.scrollLeft,this.mouseY=r+ht.scrollTop,this.lastMouseX=this.mouseX,this.lastMouseY=this.mouseY;var o=t.target||t.srcElement,a=t.path||t.composedPath&&t.composedPath()||[];!a.some((function(t){return At(t,n.entryRegExp)}))||this.$el.contains(o)||At(o,{className:/is-(top|right|bottom|left)(-(top|right|bottom|left)$|$)/})||a.some((function(t){return At(t,n.editorRegExp)}))||this.isActive&&(this.operateDOMEvents("remove"),this.isActive=!1,this.$emit("deactivated",t))},handleDown:function(t,n){this.prevent&&t.preventDefault&&!At(t.target,this.preventRegExp)&&t.preventDefault(),this.handle=n,"rotate"===n?this.rotatable&&(this.isRotating=!0):this.resizable&&(this.isResizing=!0);var e=this.getPositionByEvent(t);e.mousePositionX,e.mousePositionY},handleMove:function(t){var n=this.getPositionByEvent(t),e=n.mousePositionX,i=n.mousePositionY;this.mouseX=e+ht.scrollLeft,this.mouseY=i+ht.scrollTop;var r=parseInt(this.x,10),o=parseInt(this.y,10),a=parseInt(this.w,10),s=parseInt(this.h,10),l=Math.round((this.mouseX-this.parentX+this.offset[0])/this.scale),d=Math.round((this.mouseY-this.parentY+this.offset[1])/this.scale),A=l-Math.round((this.lastMouseX-this.parentX+this.offset[0])/this.scale),c=d-Math.round((this.lastMouseY-this.parentY+this.offset[1])/this.scale);if(this.lastMouseX=this.mouseX,this.lastMouseY=this.mouseY,this.isResizing)this.handle.includes("top")&&(o-d+s<this.minH?d=o+s-this.minH:this.parent&&d<0&&(d=0),s=o+s-d,o=d),this.handle.includes("bottom")&&(d-o<this.minH?d=o+this.minH:this.parent&&d>this.parentH&&(d=Math.round(this.parentH)),s=d-o),this.handle.includes("left")&&(r-l+a<this.minW?l=r+a-this.minW:this.parent&&l<0&&(l=0),a=r+a-l,r=l),this.handle.includes("right")&&(l-r<this.minW?l=r+this.minW:this.parent&&l>this.parentW&&(l=Math.round(this.parentW)),a=l-r),ft&&(s=a/this.w*this.h),!this.disabled&&this.sync({x:Math.round(r/this.grid[0])*this.grid[0],y:Math.round(o/this.grid[1])*this.grid[1],w:Math.round(a/this.grid[0])*this.grid[0],h:Math.round(s/this.grid[1])*this.grid[1]}),this.$emit("resizing");else if(this.isRotating){var m=this.getAngle([this.parentX+this.x*this.scale+this.w/2*this.scale,-(this.parentY+this.y*this.scale+this.h/2*this.scale)],[this.lastMouseX+this.offset[0],-(this.lastMouseY+this.offset[1])]),u=pt.find((function(t){return Math.abs(t-m)<3}));m="number"==typeof u?u:m,!this.disabled&&this.sync({r:360===m?0:m}),this.$emit("rotating")}else if(this.isDraging){var h=this.guides[0]&&this.guides[0].find((function(t){return Math.abs(r+A-t)<3})),p=this.guides[0]&&this.guides[0].find((function(t){return Math.abs(r+A+a-t)<2})),g=this.guides[1]&&this.guides[1].find((function(t){return Math.abs(o+c-t)<3})),f=this.guides[1]&&this.guides[1].find((function(t){return Math.abs(o+c+s-t)<2}));h&&(A=h-r),p&&(A=p-r-a),g&&(c=g-o),f&&(c=f-o-s),this.parent&&((r+A<0||r+A+a>this.parentW)&&(A=0),(o+c<0||o+c+s>this.parentH)&&(c=0)),r+=A,o+=c,!this.disabled&&this.sync({x:Math.round(r/this.grid[0])*this.grid[0],y:Math.round(o/this.grid[1])*this.grid[1]}),this.$emit("dragging")}!this.isChanging&&(this.isRotating||this.isDraging||this.isResizing)&&(this.isChanging=!0)},getAngle:function(t,n){var e=n[0]-t[0],i=n[1]-t[1],r=360*Math.atan2(i,e)/(2*Math.PI);return r=r>90?450-r:90-r,Math.floor(r)},getRestrain:function(t){var n=this.restrain;return(t/n).toFixed(0)*n},getPositionByEvent:function(t){return{mousePositionX:(t.targetTouches?t.targetTouches[0].pageX:t.clientX)||0,mousePositionY:(t.targetTouches?t.targetTouches[0].pageY:t.clientY)||0}},handleUp:function(t){this.isChanging=!1,this.handle=null;var n=this.restrain;n&&n>0&&this.sync({x:this.getRestrain(this.x),y:this.getRestrain(this.y),w:this.getRestrain(this.w),h:this.getRestrain(this.h)}),this.isRotating&&(this.isRotating=!1,this.beforeStatus&&this.$emit("rotate-end")),this.isResizing&&(this.isResizing=!1,this.beforeStatus&&this.$emit("resize-end")),this.isDraging&&(this.isDraging=!1,this.beforeStatus&&this.$emit("drag-end")),this.beforeStatus&&(this.$emit("end",this.beforeStatus),this.beforeStatus=null)}}};function vt(t,n,e,i,r,o,a,s,l,d){"boolean"!=typeof a&&(l=s,s=a,a=!1);var A,c="function"==typeof e?e.options:e;if(t&&t.render&&(c.render=t.render,c.staticRenderFns=t.staticRenderFns,c._compiled=!0,r&&(c.functional=!0)),i&&(c._scopeId=i),o?(A=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,l(t)),t&&t._registeredComponents&&t._registeredComponents.add(o)},c._ssrRegister=A):n&&(A=a?function(t){n.call(this,d(t,this.$root.$options.shadowRoot))}:function(t){n.call(this,s(t))}),A)if(c.functional){var m=c.render;c.render=function(t,n){return A.call(n),m(t,n)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,A):[A]}return e}var xt,Et="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function yt(t){return function(t,n){return function(t,n){var e=Et?n.media||"default":t,i=wt[e]||(wt[e]={ids:new Set,styles:[]});if(!i.ids.has(t)){i.ids.add(t);var r=n.source;if(n.map&&(r+="\n/*# sourceURL="+n.map.sources[0]+" */",r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n.map))))+" */"),i.element||(i.element=document.createElement("style"),i.element.type="text/css",n.media&&i.element.setAttribute("media",n.media),void 0===xt&&(xt=document.head||document.getElementsByTagName("head")[0]),xt.appendChild(i.element)),"styleSheet"in i.element)i.styles.push(r),i.element.styleSheet.cssText=i.styles.filter(Boolean).join("\n");else{var o=i.ids.size-1,a=document.createTextNode(r),s=i.element.childNodes;s[o]&&i.element.removeChild(s[o]),s.length?i.element.insertBefore(a,s[o]):i.element.appendChild(a)}}}(t,n)}}var wt={};var Ct=bt,_t=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"vm-draggable",class:t.draggable?"":"vm-draggable-disabled",style:t.coord,on:{mousedown:t.handleContainerDown,touchstart:function(n){return n.stopPropagation(),t.handleContainerDown.apply(null,arguments)}}},[e("div",{class:{"is-events-none":t.isChanging},style:t.style},[t._t("default")],2),t._v(" "),(t.active||t.isActive)&&(t.closeable||t.realHandles.length>0)?e("div",{staticClass:"vm-draggable__handles",class:{"is-disabled":t.disabled,"is-active":t.active||t.isActive},style:t.style},[t._l(t.realHandles,(function(n){return[t.disabled?t._e():e("div",{key:n,staticClass:"vm-draggable__handle",class:"is-"+n,on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:(e.stopPropagation(),t.handleDown(e,n))},touchstart:function(e){return e.stopPropagation(),t.handleDown(e,n)}}})]})),t._v(" "),t.rotatable&&t.isRotating?e("div",{staticClass:"vm-draggable__rotate",style:{width:t.width}}):t._e(),t._v(" "),t.closeable?e("p",{staticClass:"vm-draggable__delete",on:{click:function(n){return t.$emit("delete")}}},[t._v("\n\t\t\t✕\n\t\t")]):t._e()],2):t._e(),t._v(" "),t.isRotating?[e("div",{staticClass:"vm-draggable__rotate--deg is-0",style:{width:t.width}}),t._v(" "),e("div",{staticClass:"vm-draggable__rotate--deg is-45",style:{width:t.width}}),t._v(" "),e("div",{staticClass:"vm-draggable__rotate--deg is-90",style:{width:t.width}}),t._v(" "),e("div",{staticClass:"vm-draggable__rotate--deg is-135",style:{width:t.width}}),t._v(" "),e("div",{staticClass:"vm-draggable__rotate--tip"},[t._v("\n\t\t\t"+t._s(t.r)+" °\n\t\t")])]:t._e()],2)};_t._withStripped=!0;var $t=vt({render:_t,staticRenderFns:[]},(function(t){t&&t("data-v-4eecbf5e_0",{source:'@charset "UTF-8";\n.vm-draggable {\n  padding: 0;\n  position: absolute;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.vm-draggable:hover {\n  cursor: move;\n}\n.vm-draggable .is-events-none {\n  pointer-events: none;\n}\n.vm-draggable .is-delete {\n  background: #5495F6;\n  position: absolute;\n  right: 0;\n  width: 20px;\n  color: white;\n  text-align: center;\n  z-index: 300;\n}\n.vm-draggable-disabled:hover {\n  cursor: default;\n}\n.vm-draggable__handles.is-active {\n  padding: 0;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  position: absolute;\n  z-index: 2;\n  border: 1px dotted #5495F6;\n}\n.vm-draggable__handles.is-active .vm-draggable__handle {\n  display: block;\n}\n.vm-draggable__handles.is-disabled {\n  border: 1px dotted #e96101;\n}\n.vm-draggable__handles.is-disabled .handle-rotate:after {\n  background: #e96101;\n}\n.vm-draggable__handles.is-disabled .handle-rotate:before {\n  color: #e96101;\n}\n.vm-draggable__handle {\n  display: none;\n  position: absolute;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  z-index: 999;\n}\n.vm-draggable__handle.is-left {\n  top: 0;\n  left: -5px;\n  cursor: ew-resize;\n  position: absolute;\n  height: 100%;\n  width: 5px;\n}\n.vm-draggable__handle.is-left:hover {\n  background: -webkit-gradient(linear, left top, right top, from(rgba(255, 255, 255, 0)), to(#3F51B5));\n  background: linear-gradient(to right, rgba(255, 255, 255, 0), #3F51B5);\n}\n.vm-draggable__handle.is-right {\n  top: 0;\n  right: -5px;\n  cursor: ew-resize;\n  position: absolute;\n  height: 100%;\n  width: 5px;\n}\n.vm-draggable__handle.is-right:hover {\n  background: -webkit-gradient(linear, right top, left top, from(rgba(255, 255, 255, 0)), to(#3F51B5));\n  background: linear-gradient(to left, rgba(255, 255, 255, 0), #3F51B5);\n}\n.vm-draggable__handle.is-top {\n  position: absolute;\n  width: 100%;\n  height: 5px;\n  top: -5px;\n  left: 0;\n  cursor: ns-resize;\n}\n.vm-draggable__handle.is-top:hover {\n  background: -webkit-gradient(linear, left top, left bottom, from(rgba(255, 255, 255, 0)), to(#3F51B5));\n  background: linear-gradient(to bottom, rgba(255, 255, 255, 0), #3F51B5);\n}\n.vm-draggable__handle.is-bottom {\n  position: absolute;\n  width: 100%;\n  height: 5px;\n  bottom: -5px;\n  left: 0;\n  cursor: ns-resize;\n}\n.vm-draggable__handle.is-bottom:hover {\n  background: -webkit-gradient(linear, left bottom, left top, from(rgba(255, 255, 255, 0)), to(#3F51B5));\n  background: linear-gradient(to top, rgba(255, 255, 255, 0), #3F51B5);\n}\n.vm-draggable__handle.is-top-left {\n  top: 0;\n  left: 0;\n  cursor: nwse-resize;\n  padding: 5px;\n}\n.vm-draggable__handle.is-bottom-left {\n  bottom: 0;\n  left: 0;\n  cursor: nesw-resize;\n  padding: 5px;\n}\n.vm-draggable__handle.is-top-right {\n  top: 0;\n  right: 0;\n  cursor: nesw-resize;\n  padding: 5px;\n}\n.vm-draggable__handle.is-bottom-right {\n  bottom: 0;\n  right: 0;\n  cursor: nwse-resize;\n  padding: 5px;\n}\n.vm-draggable__handle.is-rotate {\n  top: 0;\n  left: 50%;\n  -webkit-transform: translate(-50%, -100%);\n      -ms-transform: translate(-50%, -100%);\n          transform: translate(-50%, -100%);\n  cursor: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" style="font-size: 20px;"><text y="15">↻</text></svg>\') 10 10, default;\n  display: -webkit-box !important;\n  display: -webkit-flex !important;\n  display: -ms-flexbox !important;\n  display: flex !important;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n  -webkit-flex-direction: column;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n}\n.vm-draggable__handle.is-rotate:after {\n  content: " ";\n  height: 10px;\n  width: 1px;\n  background: #5495F6;\n}\n.vm-draggable__handle.is-rotate:before {\n  content: "☐";\n  -webkit-transform: translateY(26%);\n      -ms-transform: translateY(26%);\n          transform: translateY(26%);\n  color: #5495F6;\n}\n\n/**\n * rotate\n */\n.vm-draggable__rotate {\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  z-index: 2;\n  width: 500px;\n  border: 1px solid #1fb6ff;\n  background-color: #1fb6ff;\n  -webkit-transform: translate(-50%, -50%) rotate(90deg);\n      -ms-transform: translate(-50%, -50%) rotate(90deg);\n          transform: translate(-50%, -50%) rotate(90deg);\n}\n.vm-draggable__rotate--deg {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  z-index: 2;\n  width: 500px;\n  border-top: 1px dashed #fff;\n  border-bottom: 1px dashed #262626;\n  opacity: 0.4;\n}\n.vm-draggable__rotate--deg.is-0 {\n  -webkit-transform: translate(-50%, -50%);\n      -ms-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n}\n.vm-draggable__rotate--deg.is-45 {\n  -webkit-transform: translate(-50%, -50%) rotate(45deg);\n      -ms-transform: translate(-50%, -50%) rotate(45deg);\n          transform: translate(-50%, -50%) rotate(45deg);\n}\n.vm-draggable__rotate--deg.is-90 {\n  -webkit-transform: translate(-50%, -50%) rotate(90deg);\n      -ms-transform: translate(-50%, -50%) rotate(90deg);\n          transform: translate(-50%, -50%) rotate(90deg);\n}\n.vm-draggable__rotate--deg.is-135 {\n  -webkit-transform: translate(-50%, -50%) rotate(135deg);\n      -ms-transform: translate(-50%, -50%) rotate(135deg);\n          transform: translate(-50%, -50%) rotate(135deg);\n}\n.vm-draggable__rotate--tip {\n  position: absolute;\n  top: -50px;\n  left: 60%;\n  width: 40px;\n  height: 16px;\n  line-height: 16px;\n  text-align: center;\n  border: 1px solid #262626;\n  border-radius: 8px;\n  background-color: #fff;\n}\n.vm-draggable__delete {\n  background: #5495F6;\n  position: absolute;\n  right: 0px;\n  width: 20px;\n  color: white;\n  text-align: center;\n  z-index: 300;\n  top: 0;\n  right: 0px;\n  cursor: pointer;\n}\n\n/*# sourceMappingURL=draggable.vue.map */',map:{version:3,sources:["draggable.vue","/Users/deot/Desktop/wya/github/wya-vm/src/base/draggable.vue"],names:[],mappings:"AAAA,gBAAgB;ACgqBhB;EACA,UAAA;EACA,kBAAA;EACA,8BAAA;UAAA,sBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AD9pBA;AC+pBA;EACA,YAAA;AD7pBA;AC+pBA;EACA,oBAAA;AD7pBA;ACgqBA;EACA,mBAAA;EACA,kBAAA;EACA,QAAA;EACA,WAAA;EACA,YAAA;EACA,kBAAA;EACA,YAAA;AD9pBA;ACkqBA;EACA,eAAA;AD/pBA;ACmqBA;EACA,UAAA;EACA,MAAA;EACA,OAAA;EACA,QAAA;EACA,SAAA;EACA,kBAAA;EACA,UAAA;EACA,0BAAA;ADhqBA;ACkqBA;EACA,cAAA;ADhqBA;ACmqBA;EACA,0BAAA;ADjqBA;ACmqBA;EACA,mBAAA;ADjqBA;ACmqBA;EACA,cAAA;ADjqBA;ACsqBA;EACA,aAAA;EACA,kBAAA;EACA,8BAAA;UAAA,sBAAA;EACA,YAAA;ADnqBA;ACoqBA;EACA,MAAA;EACA,UAAA;EACA,iBAAA;EACA,kBAAA;EACA,YAAA;EACA,UAAA;ADlqBA;ACmqBA;EACA,oGAAA;EAAA,sEAAA;ADjqBA;ACoqBA;EACA,MAAA;EACA,WAAA;EACA,iBAAA;EACA,kBAAA;EACA,YAAA;EACA,UAAA;ADlqBA;ACmqBA;EACA,oGAAA;EAAA,qEAAA;ADjqBA;ACqqBA;EACA,kBAAA;EACA,WAAA;EACA,WAAA;EACA,SAAA;EACA,OAAA;EACA,iBAAA;ADnqBA;ACoqBA;EACA,sGAAA;EAAA,uEAAA;ADlqBA;ACqqBA;EACA,kBAAA;EACA,WAAA;EACA,WAAA;EACA,YAAA;EACA,OAAA;EACA,iBAAA;ADnqBA;ACoqBA;EACA,sGAAA;EAAA,oEAAA;ADlqBA;ACqqBA;EACA,MAAA;EACA,OAAA;EACA,mBAAA;EACA,YAAA;ADnqBA;ACqqBA;EACA,SAAA;EACA,OAAA;EACA,mBAAA;EACA,YAAA;ADnqBA;ACqqBA;EACA,MAAA;EACA,QAAA;EACA,mBAAA;EACA,YAAA;ADnqBA;ACqqBA;EACA,SAAA;EACA,QAAA;EACA,mBAAA;EACA,YAAA;ADnqBA;ACqqBA;EACA,MAAA;EACA,SAAA;EACA,yCAAA;MAAA,qCAAA;UAAA,iCAAA;EACA,yKAAA;EACA,+BAAA;EAAA,gCAAA;EAAA,+BAAA;EAAA,wBAAA;EACA,4BAAA;EAAA,6BAAA;EAAA,8BAAA;MAAA,0BAAA;UAAA,sBAAA;EACA,yBAAA;EAAA,2BAAA;MAAA,sBAAA;UAAA,mBAAA;EACA,wBAAA;EAAA,+BAAA;MAAA,qBAAA;UAAA,uBAAA;ADnqBA;ACoqBA;EACA,YAAA;EACA,YAAA;EACA,UAAA;EACA,mBAAA;ADlqBA;ACoqBA;EACA,YAAA;EACA,kCAAA;MAAA,8BAAA;UAAA,0BAAA;EACA,cAAA;ADlqBA;;ACuqBA;;EAAA;AAGA;EACA,kBAAA;EACA,SAAA;EACA,QAAA;EACA,UAAA;EACA,YAAA;EACA,yBAAA;EACA,yBAAA;EACA,sDAAA;MAAA,kDAAA;UAAA,8CAAA;ADpqBA;ACsqBA;EACA,kBAAA;EACA,QAAA;EACA,SAAA;EACA,UAAA;EACA,YAAA;EACA,2BAAA;EACA,iCAAA;EACA,YAAA;ADnqBA;ACoqBA;EACA,wCAAA;MAAA,oCAAA;UAAA,gCAAA;ADlqBA;ACoqBA;EACA,sDAAA;MAAA,kDAAA;UAAA,8CAAA;ADlqBA;ACoqBA;EACA,sDAAA;MAAA,kDAAA;UAAA,8CAAA;ADlqBA;ACoqBA;EACA,uDAAA;MAAA,mDAAA;UAAA,+CAAA;ADlqBA;ACsqBA;EACA,kBAAA;EACA,UAAA;EACA,SAAA;EACA,WAAA;EACA,YAAA;EACA,iBAAA;EACA,kBAAA;EACA,yBAAA;EACA,kBAAA;EACA,sBAAA;ADnqBA;ACsqBA;EACA,mBAAA;EACA,kBAAA;EACA,UAAA;EACA,WAAA;EACA,YAAA;EACA,kBAAA;EACA,YAAA;EACA,MAAA;EACA,UAAA;EACA,eAAA;ADnqBA;;AAEA,wCAAwC",file:"draggable.vue",sourcesContent:['@charset "UTF-8";\n.vm-draggable {\n  padding: 0;\n  position: absolute;\n  box-sizing: border-box;\n  user-select: none;\n}\n.vm-draggable:hover {\n  cursor: move;\n}\n.vm-draggable .is-events-none {\n  pointer-events: none;\n}\n.vm-draggable .is-delete {\n  background: #5495F6;\n  position: absolute;\n  right: 0;\n  width: 20px;\n  color: white;\n  text-align: center;\n  z-index: 300;\n}\n\n.vm-draggable-disabled:hover {\n  cursor: default;\n}\n\n.vm-draggable__handles.is-active {\n  padding: 0;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  position: absolute;\n  z-index: 2;\n  border: 1px dotted #5495F6;\n}\n.vm-draggable__handles.is-active .vm-draggable__handle {\n  display: block;\n}\n.vm-draggable__handles.is-disabled {\n  border: 1px dotted #e96101;\n}\n.vm-draggable__handles.is-disabled .handle-rotate:after {\n  background: #e96101;\n}\n.vm-draggable__handles.is-disabled .handle-rotate:before {\n  color: #e96101;\n}\n\n.vm-draggable__handle {\n  display: none;\n  position: absolute;\n  box-sizing: border-box;\n  z-index: 999;\n}\n.vm-draggable__handle.is-left {\n  top: 0;\n  left: -5px;\n  cursor: ew-resize;\n  position: absolute;\n  height: 100%;\n  width: 5px;\n}\n.vm-draggable__handle.is-left:hover {\n  background: linear-gradient(to right, rgba(255, 255, 255, 0), #3F51B5);\n}\n.vm-draggable__handle.is-right {\n  top: 0;\n  right: -5px;\n  cursor: ew-resize;\n  position: absolute;\n  height: 100%;\n  width: 5px;\n}\n.vm-draggable__handle.is-right:hover {\n  background: linear-gradient(to left, rgba(255, 255, 255, 0), #3F51B5);\n}\n.vm-draggable__handle.is-top {\n  position: absolute;\n  width: 100%;\n  height: 5px;\n  top: -5px;\n  left: 0;\n  cursor: ns-resize;\n}\n.vm-draggable__handle.is-top:hover {\n  background: linear-gradient(to bottom, rgba(255, 255, 255, 0), #3F51B5);\n}\n.vm-draggable__handle.is-bottom {\n  position: absolute;\n  width: 100%;\n  height: 5px;\n  bottom: -5px;\n  left: 0;\n  cursor: ns-resize;\n}\n.vm-draggable__handle.is-bottom:hover {\n  background: linear-gradient(to top, rgba(255, 255, 255, 0), #3F51B5);\n}\n.vm-draggable__handle.is-top-left {\n  top: 0;\n  left: 0;\n  cursor: nwse-resize;\n  padding: 5px;\n}\n.vm-draggable__handle.is-bottom-left {\n  bottom: 0;\n  left: 0;\n  cursor: nesw-resize;\n  padding: 5px;\n}\n.vm-draggable__handle.is-top-right {\n  top: 0;\n  right: 0;\n  cursor: nesw-resize;\n  padding: 5px;\n}\n.vm-draggable__handle.is-bottom-right {\n  bottom: 0;\n  right: 0;\n  cursor: nwse-resize;\n  padding: 5px;\n}\n.vm-draggable__handle.is-rotate {\n  top: 0;\n  left: 50%;\n  transform: translate(-50%, -100%);\n  cursor: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" style="font-size: 20px;"><text y="15">↻</text></svg>\') 10 10, default;\n  display: flex !important;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n}\n.vm-draggable__handle.is-rotate:after {\n  content: " ";\n  height: 10px;\n  width: 1px;\n  background: #5495F6;\n}\n.vm-draggable__handle.is-rotate:before {\n  content: "☐";\n  transform: translateY(26%);\n  color: #5495F6;\n}\n\n/**\n * rotate\n */\n.vm-draggable__rotate {\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  z-index: 2;\n  width: 500px;\n  border: 1px solid #1fb6ff;\n  background-color: #1fb6ff;\n  transform: translate(-50%, -50%) rotate(90deg);\n}\n\n.vm-draggable__rotate--deg {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  z-index: 2;\n  width: 500px;\n  border-top: 1px dashed #fff;\n  border-bottom: 1px dashed #262626;\n  opacity: 0.4;\n}\n.vm-draggable__rotate--deg.is-0 {\n  transform: translate(-50%, -50%);\n}\n.vm-draggable__rotate--deg.is-45 {\n  transform: translate(-50%, -50%) rotate(45deg);\n}\n.vm-draggable__rotate--deg.is-90 {\n  transform: translate(-50%, -50%) rotate(90deg);\n}\n.vm-draggable__rotate--deg.is-135 {\n  transform: translate(-50%, -50%) rotate(135deg);\n}\n\n.vm-draggable__rotate--tip {\n  position: absolute;\n  top: -50px;\n  left: 60%;\n  width: 40px;\n  height: 16px;\n  line-height: 16px;\n  text-align: center;\n  border: 1px solid #262626;\n  border-radius: 8px;\n  background-color: #fff;\n}\n\n.vm-draggable__delete {\n  background: #5495F6;\n  position: absolute;\n  right: 0px;\n  width: 20px;\n  color: white;\n  text-align: center;\n  z-index: 300;\n  top: 0;\n  right: 0px;\n  cursor: pointer;\n}\n\n/*# sourceMappingURL=draggable.vue.map */',"<template>\n\t<div\n\t\t:style=\"coord\"\n\t\t:class=\"!draggable ? 'vm-draggable-disabled' : ''\"\n\t\tclass=\"vm-draggable\"\n\t\t@mousedown=\"handleContainerDown\"\n\t\t@touchstart.stop=\"handleContainerDown\"\n\t>\n\t\t<div :style=\"style\" :class=\"{ 'is-events-none': isChanging }\">\n\t\t\t<slot :style=\"style\" />\n\t\t</div>\n\t\t\x3c!-- handle --\x3e\n\t\t<div\n\t\t\tv-if=\"(active || isActive) && (closeable || realHandles.length > 0)\"\n\t\t\t:class=\"{ 'is-disabled': disabled, 'is-active': (active || isActive) }\"\n\t\t\t:style=\"style\"\n\t\t\tclass=\"vm-draggable__handles\"\n\t\t>\n\t\t\t\x3c!-- 此处使用stop，阻止冒泡，如果active为true, 设置激活状态通过模拟方式 --\x3e\n\t\t\t<template v-for=\"item in realHandles\">\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"!disabled\"\n\t\t\t\t\t:key=\"item\"\n\t\t\t\t\t:class=\"`is-${item}`\"\n\t\t\t\t\tclass=\"vm-draggable__handle\"\n\t\t\t\t\t@mousedown.left.stop=\"handleDown($event, item)\"\n\t\t\t\t\t@touchstart.stop=\"handleDown($event, item)\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<div v-if=\"rotatable && isRotating\" :style=\"{ width }\" class=\"vm-draggable__rotate\" />\n\t\t\t\x3c!-- delete --\x3e\n\t\t\t<p v-if=\"closeable\" class=\"vm-draggable__delete\" @click=\"$emit('delete')\">\n\t\t\t\t✕\n\t\t\t</p>\n\t\t</div>\n\n\t\t\x3c!-- 位置不会改变的 --\x3e\n\t\t\x3c!-- grid for rotate --\x3e\n\t\t<template v-if=\"isRotating\">\n\t\t\t<div :style=\"{ width }\" class=\"vm-draggable__rotate--deg is-0\" />\n\t\t\t<div :style=\"{ width }\" class=\"vm-draggable__rotate--deg is-45\" />\n\t\t\t<div :style=\"{ width }\" class=\"vm-draggable__rotate--deg is-90\" />\n\t\t\t<div :style=\"{ width }\" class=\"vm-draggable__rotate--deg is-135\" />\n\t\t\t<div class=\"vm-draggable__rotate--tip\">\n\t\t\t\t{{ r }} °\n\t\t\t</div>\n\t\t</template>\n\t</div>\n</template>\n\n<script>\nimport { isPassiveSupported, eleInRegExp } from '../utils/helper';\nimport { PAGE_MOULE } from '../utils/constants';\n\nconst IS_SERVER = typeof window === 'undefined';\nconst doc = !IS_SERVER && document.documentElement;\nconst angleArr = [0, 45, 90, 135, 180, 225, 270, 315, 360];\n\nexport const draggableEvents = {\n\tstart: ['touchstart', 'mousedown'],\n\tmove: ['touchmove', 'mousemove'],\n\tend: ['touchend', 'touchcancel', 'mouseup']\n};\n\nlet isPressShift = false;\nif (!IS_SERVER) {\n\tdoc.addEventListener('keydown', (e) => {\n\t\tisPressShift = e.keyCode === 16 || e.key === 'Shift';\n\t});\n\tdoc.addEventListener('keyup', (e) => {\n\t\tif (isPressShift && (e.keyCode === 16 || e.key === 'Shift')) {\n\t\t\tisPressShift = false;\n\t\t}\n\t});\n}\n\nexport default {\n\treplace: true,\n\tname: 'vm-draggable',\n\tprops: {\n\t\thandles: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => (['top', 'right', 'bottom', 'left', 'top-left', 'top-right', 'bottom-right', 'bottom-left', 'rotate'])\n\t\t},\n\t\t// 宽度\n\t\tw: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0,\n\t\t\tvalidator: val => val >= 0\n\t\t},\n\t\t// 高度\n\t\th: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0,\n\t\t\tvalidator: val => val >= 0\n\t\t},\n\t\t// 选择角度\n\t\tr: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\t\t// 最小宽度\n\t\tminW: {\n\t\t\ttype: Number,\n\t\t\tdefault: 36,\n\t\t\tvalidator: val => val > 0\n\t\t},\n\t\t// 最小高度\n\t\tminH: {\n\t\t\ttype: Number,\n\t\t\tdefault: 36,\n\t\t\tvalidator: val => val > 0\n\t\t},\n\t\t// 距父元素左上角X轴偏移量\n\t\tx: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\t\t// 距父元素左上角Y轴偏移量\n\t\ty: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\t\t// zIndex\n\t\tz: {\n\t\t\ttype: Number,\n\t\t\tdefault: 1\n\t\t},\n\t\tscale: {\n\t\t\ttype: Number,\n\t\t\tdefault: 1\n\t\t},\n\t\tgrid: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => {\n\t\t\t\treturn [1, 1];\n\t\t\t}\n\t\t},\n\n\t\tguides: {\n\t\t\ttype: Array,\n\t\t\tdefault() {\n\t\t\t\treturn [[], []];\n\t\t\t}\n\t\t},\n\n\t\t// 约束组件大小\n\t\trestrain: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\t\tparent: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t},\n\n\t\t// 在入口文件下，才会去判断editorRegExp，如弹层不会判断让其失去激活状态（除非配置）\n\t\tentryRegExp: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => ({\n\t\t\t\tclassName: /vm-hack-entry/,\n\t\t\t\tid: /^(app|pages)$/\n\t\t\t})\n\t\t},\n\n\t\teditorRegExp: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => ({\n\t\t\t\tclassName: /vm-hack-editor/\n\t\t\t})\n\t\t},\n\n\t\t/**\n\t\t * 是否屏蔽默认事件\n\t\t */\n\t\tprevent: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t},\n\t\tpreventRegExp: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => ({\n\t\t\t\ttagName: /^(INPUT|TEXTAREA|BUTTON|SELECT|OPTION)$/,\n\t\t\t\tclassName: /vm-hack-pevent/,\n\t\t\t})\n\t\t},\n\n\t\tmodule: {\n\t\t\ttype: String,\n\t\t},\n\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t},\n\n\t\tcloseable: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t},\n\n\t\tdraggable: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t},\n\n\t\tresizable: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t},\n\n\t\trotatable: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t},\n\n\t\t// 激活状态， 特殊需求\n\t\tactive: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t},\n\n\t\toffset: {\n\t\t\ttype: Array,\n\t\t\tdefault() {\n\t\t\t\treturn [0, 0];\n\t\t\t}\n\t\t},\n\n\t\t// autoOnTop: {\n\t\t// \ttype: Boolean,\n\t\t// \tdefault: false\n\t\t// }\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tisResizing: false,\n\t\t\tisDraging: false,\n\t\t\tisRotating: false,\n\t\t\tisChanging: false,\n\t\t\tisActive: false\n\t\t};\n\t},\n\tcomputed: {\n\t\tcoord() {\n\t\t\treturn {\n\t\t\t\tleft: this.x + 'px',\n\t\t\t\ttop: this.y + 'px',\n\t\t\t\tzIndex: this.z\n\t\t\t};\n\t\t},\n\t\tstyle() {\n\t\t\tconst w = this.w === 0 ? 'auto' : `${this.w}px`;\n\t\t\tconst h = this.h === 0 ? 'auto' : `${this.h}px`;\n\t\t\treturn {\n\t\t\t\twidth: w,\n\t\t\t\theight: h,\n\t\t\t\ttransform: `rotate(${this.r}deg)`\n\t\t\t};\n\t\t},\n\t\twidth() {\n\t\t\tlet num = Math.floor(\n\t\t\t\tMath.sqrt(this.w * this.w + this.h * this.h) * 1.15\n\t\t\t);\n\t\t\treturn `${num}px`;\n\t\t},\n\t\trealHandles() {\n\t\t\tlet handles = this.handles;\n\n\t\t\tif (!this.rotatable) {\n\t\t\t\thandles = handles.filter(i => i !== 'rotate');\n\t\t\t}\n\n\t\t\tif (!this.resizable) {\n\t\t\t\thandles = handles.filter(i => i === 'rotate');\n\t\t\t}\n\n\t\t\treturn handles;\n\t\t}\n\t},\n\twatch: {\n\t\tactive: {\n\t\t\timmediate: true,\n\t\t\thandler(v) {\n\t\t\t\tv && this.setActived();\n\t\t\t}\n\t\t}\n\t},\n\tbeforeCreate() {\n\t\tthis.parentX = 0;\n\t\tthis.parentY = 0;\n\t\tthis.parentW = 9999;\n\t\tthis.parentH = 9999;\n\t\tthis.mouseX = 0;\n\t\tthis.mouseY = 0;\n\t\tthis.lastMouseX = 0;\n\t\tthis.lastMouseY = 0;\n\t\tthis.mouseOffX = 0;\n\t\tthis.mouseOffY = 0;\n\n\t\tthis.handle = null;\n\n\t\t// 组件捕获阶段执行\n\t\tthis.eventOpts = !isPassiveSupported || { capture: true, passive: true };\n\n\t\t// 改变前状态\n\t\tthis.beforeStatus = null;\n\t},\n\tmounted() {\n\t\tif (this.w && this.minW > this.w) {\n\t\t\tthis.sync({ w: this.minW });\n\t\t}\n\t\tif (this.h && this.minH > this.h) {\n\t\t\tthis.sync({ h: this.minH });\n\t\t}\n\n\t\tthis.$nextTick(() => {\n\t\t\tconst { x, y } = this.$el.parentNode.getBoundingClientRect();\n\t\t\tthis.parentX = x + this.offset[0];\n\t\t\tthis.parentY = y + this.offset[1];\n\n\t\t\t// 判断是否只能在父级元素中拖动\n\t\t\tthis.parent && this.calculation();\n\t\t\tthis.$emit('resizing');\n\t\t});\n\t},\n\tdestroyed() {\n\t\tthis.operateDOMEvents('remove');\n\t},\n\tmethods: {\n\t\tcalculation() {\n\t\t\tconst { width, height } = this.$el.parentNode.getBoundingClientRect();\n\t\t\tif (!width || !height) {\n\t\t\t\tthrow new Error('@wya/vm: 父层容器宽度计算异常');\n\t\t\t}\n\n\t\t\t// 原始高度\n\t\t\tthis.parentW = width / this.scale;\n\t\t\tthis.parentH = height / this.scale; // this.$el.parentNode.clientHeight\n\n\t\t\tif (this.w > this.parentW) {\n\t\t\t\tthis.sync({ w: this.parentW });\n\t\t\t}\n\t\t\tif (this.h > this.parentH) {\n\t\t\t\tthis.sync({ h: this.parentH });\n\t\t\t}\n\t\t\tif ((this.x + this.w) > this.parentW) {\n\t\t\t\tthis.sync({ x: this.parentW - this.w });\n\t\t\t}\n\t\t\tif ((this.y + this.h) > this.parentH) {\n\t\t\t\tthis.sync({ y: this.parentH - this.h });\n\t\t\t}\n\t\t},\n\t\tsync(opts) {\n\t\t\tfor (let key in opts) {\n\t\t\t\tif (this[key] != opts[key]) {\n\t\t\t\t\t!this.beforeStatus && (this.beforeStatus = {\n\t\t\t\t\t\tx: this.x,\n\t\t\t\t\t\ty: this.y,\n\t\t\t\t\t\tz: this.z,\n\t\t\t\t\t\tw: this.w,\n\t\t\t\t\t\tr: this.r\n\t\t\t\t\t});\n\t\t\t\t\tthis.$emit(`update:${key}`, opts[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\toperateDOMEvents(type) {\n\t\t\tlet fn = type === 'add' ? doc.addEventListener : doc.removeEventListener;\n\n\t\t\t// 使用原生绑定 不区分移动端还是桌面端\n\t\t\tdraggableEvents.start.forEach(eventName => {\n\t\t\t\tfn(eventName, this.handleDeselect, this.eventOpts);\n\t\t\t});\n\t\t\tdraggableEvents.move.forEach(eventName => {\n\t\t\t\tfn(eventName, this.handleMove, this.eventOpts);\n\t\t\t});\n\t\t\tdraggableEvents.end.forEach(eventName => {\n\t\t\t\tfn(eventName, this.handleUp, this.eventOpts);\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * 模拟设置isActive状态\n\t\t */\n\t\tsetActived() {\n\t\t\tthis.handleContainerDown();\n\t\t\tthis.handleUp();\n\t\t},\n\t\t/**\n\t\t * 组件被按下事件\n\t\t */\n\t\thandleContainerDown(e = {}) {\n\t\t\tthis.prevent\n\t\t\t\t&& e.preventDefault\n\t\t\t\t&& !eleInRegExp(e.target, this.preventRegExp)\n\t\t\t\t&& e.preventDefault();\n\n\t\t\t// 判断是否支持拖动\n\t\t\tif (this.disabled) return;\n\t\t\tconst target = e.target || e.srcElement;\n\t\t\t// 确保事件发生在组件内部\n\t\t\tif (!target || this.$el.contains(target)) {\n\t\t\t\tif (!this.isActive) {\n\t\t\t\t\tconst { mousePositionX, mousePositionY } = this.getPositionByEvent(e);\n\n\t\t\t\t\tthis.lastMouseX = mousePositionX + doc.scrollLeft;\n\t\t\t\t\tthis.lastMouseY = mousePositionY + doc.scrollTop;\n\n\t\t\t\t\t// 绑定事件\n\t\t\t\t\tthis.operateDOMEvents('add');\n\n\t\t\t\t\tthis.isActive = true;\n\t\t\t\t\tthis.$emit('activated', e);\n\t\t\t\t}\n\t\t\t\tthis.draggable && (this.isDraging = true);\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * 取消选择事件\n\t\t */\n\t\thandleDeselect(e) {\n\t\t\tconst { mousePositionX, mousePositionY } = this.getPositionByEvent(e);\n\n\t\t\tthis.mouseX = mousePositionX + doc.scrollLeft;\n\t\t\tthis.mouseY = mousePositionY + doc.scrollTop;\n\t\t\tthis.lastMouseX = this.mouseX;\n\t\t\tthis.lastMouseY = this.mouseY;\n\t\t\tconst target = e.target || e.srcElement; // body不要带上class, 否则会存在问题\n\n\t\t\t// 内部管理\n\t\t\tconst regex = {\n\t\t\t\tclassName: /is-(top|right|bottom|left)(-(top|right|bottom|left)$|$)/\n\t\t\t};\n\n\t\t\tlet path = e.path || (e.composedPath && e.composedPath()) || [];\n\n\t\t\t// 是否是入口下的元素，如果不是，就意味着可能是弹层（避免销毁）\n\t\t\tlet isInline = path.some(item => eleInRegExp(item, this.entryRegExp));\n\n\t\t\tif (\n\t\t\t\tisInline\n\t\t\t\t&& !this.$el.contains(target)\n\t\t\t\t&& !eleInRegExp(target, regex)\n\t\t\t\t&& (!path.some(item => eleInRegExp(item, this.editorRegExp)))\n\t\t\t) {\n\t\t\t\tif (this.isActive) {\n\t\t\t\t\t// 解绑\n\t\t\t\t\tthis.operateDOMEvents('remove');\n\n\t\t\t\t\tthis.isActive = false;\n\t\t\t\t\tthis.$emit('deactivated', e);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * 拖动点按下事件\n\t\t */\n\t\thandleDown(e, handle) {\n\t\t\tthis.prevent\n\t\t\t\t&& e.preventDefault\n\t\t\t\t&& !eleInRegExp(e.target, this.preventRegExp)\n\t\t\t\t&& e.preventDefault();\n\n\t\t\t// 将handle设置为当前元素\n\t\t\tthis.handle = handle;\n\t\t\tif (handle === 'rotate') {\n\t\t\t\tthis.rotatable && (this.isRotating = true);\n\t\t\t} else {\n\t\t\t\tthis.resizable && (this.isResizing = true);\n\t\t\t}\n\n\t\t\tconst { mousePositionX, mousePositionY } = this.getPositionByEvent(e);\n\n\t\t\t// this.preMouseX = mousePositionX + doc.scrollLeft;\n\t\t\t// this.preMouseY = mousePositionY + doc.scrollTop;\n\t\t},\n\t\thandleMove(e) {\n\t\t\tconst { mousePositionX, mousePositionY } = this.getPositionByEvent(e);\n\t\t\tthis.mouseX = mousePositionX + doc.scrollLeft;\n\t\t\tthis.mouseY = mousePositionY + doc.scrollTop;\n\n\t\t\t// x, y, w, h\n\t\t\tlet elmX = parseInt(this.x, 10);\n\t\t\tlet elmY = parseInt(this.y, 10);\n\t\t\tlet elmW = parseInt(this.w, 10);\n\t\t\tlet elmH = parseInt(this.h, 10);\n\n\t\t\t// 鼠标所在的轴xy坐标值\n\t\t\tlet axisX = Math.round((this.mouseX - this.parentX + this.offset[0]) / this.scale);\n\t\t\tlet axisY = Math.round((this.mouseY - this.parentY + this.offset[1]) / this.scale);\n\t\t\tlet diffX = axisX - Math.round((this.lastMouseX - this.parentX + this.offset[0]) / this.scale);\n\t\t\tlet diffY = axisY - Math.round((this.lastMouseY - this.parentY + this.offset[1]) / this.scale);\n\t\t\tthis.lastMouseX = this.mouseX;\n\t\t\tthis.lastMouseY = this.mouseY;\n\t\t\tif (this.isResizing) {\n\t\t\t\tif (this.handle.includes('top')) {\n\t\t\t\t\tif (elmY - axisY + elmH < this.minH) {\n\t\t\t\t\t\taxisY = elmY + elmH - this.minH;\n\t\t\t\t\t} else if (this.parent && axisY < 0) {\n\t\t\t\t\t\taxisY = 0;\n\t\t\t\t\t}\n\t\t\t\t\telmH = elmY + elmH - axisY;\n\t\t\t\t\telmY = axisY;\n\t\t\t\t}\n\t\t\t\tif (this.handle.includes('bottom')) {\n\t\t\t\t\tif (axisY - elmY < this.minH) {\n\t\t\t\t\t\taxisY = elmY + this.minH;\n\t\t\t\t\t} else if (this.parent && axisY > this.parentH) {\n\t\t\t\t\t\taxisY = Math.round(this.parentH);\n\t\t\t\t\t}\n\t\t\t\t\telmH = axisY - elmY;\n\t\t\t\t}\n\t\t\t\tif (this.handle.includes('left')) {\n\t\t\t\t\tif (elmX - axisX + elmW < this.minW) {\n\t\t\t\t\t\taxisX = elmX + elmW - this.minW;\n\t\t\t\t\t} else if (this.parent && axisX < 0) {\n\t\t\t\t\t\taxisX = 0;\n\t\t\t\t\t}\n\t\t\t\t\telmW = elmX + elmW - axisX;\n\t\t\t\t\telmX = axisX;\n\t\t\t\t}\n\t\t\t\tif (this.handle.includes('right')) {\n\t\t\t\t\tif (axisX - elmX < this.minW) {\n\t\t\t\t\t\taxisX = elmX + this.minW;\n\t\t\t\t\t} else if (this.parent && axisX > this.parentW) {\n\t\t\t\t\t\taxisX = Math.round(this.parentW);\n\t\t\t\t\t}\n\t\t\t\t\telmW = axisX - elmX;\n\t\t\t\t}\n\t\t\t\t// 控制一个方向\n\t\t\t\tif (isPressShift) { \n\t\t\t\t\telmH = elmW / this.w * this.h;\n\t\t\t\t}\n\t\t\t\t!this.disabled && this.sync({\n\t\t\t\t\tx: (Math.round(elmX / this.grid[0]) * this.grid[0]),\n\t\t\t\t\ty: (Math.round(elmY / this.grid[1]) * this.grid[1]),\n\t\t\t\t\tw: (Math.round(elmW / this.grid[0]) * this.grid[0]),\n\t\t\t\t\th: (Math.round(elmH / this.grid[1]) * this.grid[1]),\n\t\t\t\t});\n\t\t\t\tthis.$emit('resizing');\n\t\t\t} else if (this.isRotating) {\n\t\t\t\tlet angle = this.getAngle(\n\t\t\t\t\t[\n\t\t\t\t\t\tthis.parentX + this.x * this.scale + this.w / 2 * this.scale, \n\t\t\t\t\t\t-(this.parentY + this.y * this.scale + this.h / 2 * this.scale)\n\t\t\t\t\t],\n\t\t\t\t\t[\n\t\t\t\t\t\tthis.lastMouseX + this.offset[0], \n\t\t\t\t\t\t-(this.lastMouseY + this.offset[1])\n\t\t\t\t\t]\n\t\t\t\t);\n\n\t\t\t\tlet criticalAngle = angleArr.find(item => Math.abs(item - angle) < 3);\n\t\t\t\tangle = typeof criticalAngle === 'number' ? criticalAngle : angle;\n\n\t\t\t\t!this.disabled && this.sync({\n\t\t\t\t\tr: angle === 360 ? 0 : angle\n\t\t\t\t});\n\t\t\t\tthis.$emit('rotating');\n\t\t\t} else if (this.isDraging) {\n\n\t\t\t\t// 找出可吸附的辅助线\n\t\t\t\tlet leftline = this.guides[0] && this.guides[0].find(item => {\n\t\t\t\t\treturn Math.abs(elmX + diffX - item) < 3;\n\t\t\t\t});\n\t\t\t\tlet rightline = this.guides[0] && this.guides[0].find(item => {\n\t\t\t\t\treturn Math.abs(elmX + diffX + elmW - item) < 2;\n\t\t\t\t});\n\t\t\t\tlet topline = this.guides[1] && this.guides[1].find(item => {\n\t\t\t\t\treturn Math.abs(elmY + diffY - item) < 3;\n\t\t\t\t});\n\t\t\t\tlet bottomline = this.guides[1] && this.guides[1].find(item => {\n\t\t\t\t\treturn Math.abs(elmY + diffY + elmH - item) < 2;\n\t\t\t\t});\n\n\t\t\t\tleftline && (diffX = leftline - elmX);\n\t\t\t\trightline && (diffX = rightline - elmX - elmW);\n\t\t\t\ttopline && (diffY = topline - elmY);\n\t\t\t\tbottomline && (diffY = bottomline - elmY - elmH);\n\n\t\t\t\tif (this.parent) {\n\t\t\t\t\tif (elmX + diffX < 0 || elmX + diffX + elmW > this.parentW) {\n\t\t\t\t\t\tdiffX = 0;\n\t\t\t\t\t}\n\t\t\t\t\tif (elmY + diffY < 0 || elmY + diffY + elmH > this.parentH) {\n\t\t\t\t\t\tdiffY = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telmX += diffX;\n\t\t\t\telmY += diffY;\n\n\t\t\t\t!this.disabled && this.sync({\n\t\t\t\t\tx: (Math.round(elmX / this.grid[0]) * this.grid[0]),\n\t\t\t\t\ty: (Math.round(elmY / this.grid[1]) * this.grid[1]),\n\t\t\t\t});\n\t\t\t\tthis.$emit('dragging');\n\t\t\t}\n\n\t\t\t// 正在改变\n\t\t\t!this.isChanging\n\t\t\t\t&& (this.isRotating || this.isDraging || this.isResizing)\n\t\t\t\t&& (this.isChanging = true);\n\n\t\t},\n\n\t\tgetAngle(center, last) {\n\t\t\tlet diffX = last[0] - center[0];\n\t\t\tlet diffY = last[1] - center[1];\n\t\t\t/**\n\t\t\t * https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Math/atan2\n\t\t\t * -180 <= c < 180\n\t\t\t */\n\t\t\tlet c = 360 * Math.atan2(diffY, diffX) / (2 * Math.PI);\n\t\t\tc = c > 90\n\t\t\t\t? (450 - c) // 第4\n\t\t\t\t: 90 - c; // 第1，2，3象限\n\t\t\treturn Math.floor(c);\n\t\t},\n\t\tgetRestrain(num) {\n\t\t\tconst restrain = this.restrain;\n\t\t\treturn (num / restrain).toFixed(0) * restrain;\n\t\t},\n\t\tgetPositionByEvent(e) {\n\t\t\tconst mousePositionX = e.targetTouches\n\t\t\t\t? e.targetTouches[0].pageX\n\t\t\t\t: e.clientX;\n\t\t\tconst mousePositionY = e.targetTouches\n\t\t\t\t? e.targetTouches[0].pageY\n\t\t\t\t: e.clientY;\n\t\t\treturn {\n\t\t\t\tmousePositionX: mousePositionX || 0,\n\t\t\t\tmousePositionY: mousePositionY || 0\n\t\t\t};\n\t\t},\n\t\thandleUp(e) {\n\t\t\tthis.isChanging = false;\n\t\t\tthis.handle = null;\n\t\t\t// 约束\n\t\t\tconst restrain = this.restrain;\n\t\t\tif (restrain && restrain > 0) {\n\t\t\t\tthis.sync({\n\t\t\t\t\tx: this.getRestrain(this.x),\n\t\t\t\t\ty: this.getRestrain(this.y),\n\t\t\t\t\tw: this.getRestrain(this.w),\n\t\t\t\t\th: this.getRestrain(this.h),\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (this.isRotating) {\n\t\t\t\tthis.isRotating = false;\n\t\t\t\tthis.beforeStatus && this.$emit('rotate-end');\n\t\t\t}\n\t\t\tif (this.isResizing) {\n\t\t\t\tthis.isResizing = false;\n\t\t\t\tthis.beforeStatus && this.$emit('resize-end');\n\t\t\t}\n\t\t\tif (this.isDraging) {\n\t\t\t\tthis.isDraging = false;\n\t\t\t\tthis.beforeStatus && this.$emit('drag-end');\n\t\t\t}\n\t\t\tif (this.beforeStatus) {\n\t\t\t\tthis.$emit('end', this.beforeStatus);\n\t\t\t\tthis.beforeStatus = null;\n\t\t\t}\n\t\t}\n\t},\n};\n<\/script>\n\n<style lang=\"scss\">\n\n$url: 'data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"30\" height=\"30\" style=\"font-size: 20px;\"><text y=\"15\">↻</text></svg>';\n\n.vm-draggable {\n\tpadding: 0;\n\tposition: absolute;\n\tbox-sizing: border-box;\n\tuser-select: none;\n\t&:hover {\n\t\tcursor: move;\n\t}\n\t.is-events-none {\n\t\tpointer-events: none;\n\t}\n\t// 重复？\n\t.is-delete {\n\t\tbackground: #5495F6;\n\t\tposition: absolute;\n\t\tright: 0;\n\t\twidth: 20px;\n\t\tcolor: white;\n\t\ttext-align: center;\n\t\tz-index: 300\n\t}\n}\n.vm-draggable-disabled {\n\t&:hover {\n\t\tcursor: default;\n\t}\n}\n.vm-draggable__handles {\n\t&.is-active {\n\t\tpadding: 0;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tbottom: 0;\n\t\tposition: absolute;\n\t\tz-index: 2;\n\t\tborder: 1px dotted #5495F6;\n\t\t// cursor: move;\n\t\t.vm-draggable__handle {\n\t\t\tdisplay: block;\n\t\t}\n\t}\n\t&.is-disabled {\n\t\tborder: 1px dotted #e96101;\n\t\t.handle-rotate {\n\t\t\t&:after {\n\t\t\t\tbackground: #e96101;\n\t\t\t}\n\t\t\t&:before {\n\t\t\t\tcolor: #e96101;\n\t\t\t}\n\t\t}\n\t}\n}\n.vm-draggable__handle {\n\tdisplay: none;\n\tposition: absolute;\n\tbox-sizing: border-box;\n\tz-index: 999;\n\t&.is-left {\n\t\ttop: 0;\n\t\tleft: -5px;\n\t\tcursor: ew-resize;\n\t\tposition: absolute;\n\t\theight: 100%;\n\t\twidth: 5px;\n\t\t&:hover {\n\t\t\tbackground: linear-gradient(to right, rgba(255, 255, 255, 0), #3F51B5);\n\t\t}\n\t}\n\t&.is-right {\n\t\ttop: 0;\n\t\tright: -5px;\n\t\tcursor: ew-resize;\n\t\tposition: absolute;\n\t\theight: 100%;\n\t\twidth: 5px;\n\t\t&:hover {\n\t\t\tbackground: linear-gradient(to left, rgba(255, 255, 255, 0), #3F51B5);\n\t\t}\n\t}\n\n\t&.is-top {\n\t\tposition: absolute;\n\t\twidth: 100%;\n\t\theight: 5px;\n\t\ttop: -5px;\n\t\tleft: 0;\n\t\tcursor: ns-resize;\n\t\t&:hover {\n\t\t\tbackground: linear-gradient(to bottom, rgba(255, 255, 255, 0), #3F51B5);\n\t\t}\n\t}\n\t&.is-bottom {\n\t\tposition: absolute;\n\t\twidth: 100%;\n\t\theight: 5px;\n\t\tbottom: -5px;\n\t\tleft: 0;\n\t\tcursor: ns-resize;\n\t\t&:hover {\n\t\t\tbackground: linear-gradient(to top, rgba(255, 255, 255, 0), #3F51B5);\n\t\t}\n\t}\n\t&.is-top-left {\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tcursor: nwse-resize;\n\t\tpadding: 5px;\n\t}\n\t&.is-bottom-left {\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\tcursor: nesw-resize;\n\t\tpadding: 5px;\n\t}\n\t&.is-top-right {\n\t\ttop: 0;\n\t\tright: 0;\n\t\tcursor: nesw-resize;\n\t\tpadding: 5px;\n\t}\n\t&.is-bottom-right {\n\t\tbottom: 0;\n\t\tright: 0;\n\t\tcursor: nwse-resize;\n\t\tpadding: 5px;\n\t}\n\t&.is-rotate {\n\t\ttop: 0;\n\t\tleft: 50%;\n\t\ttransform: translate(-50%, -100%);\n\t\tcursor: url($url) 10 10,default;\n\t\tdisplay: flex !important;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\t&:after {\n\t\t\tcontent: ' ';\n\t\t\theight: 10px;\n\t\t\twidth: 1px;\n\t\t\tbackground: #5495F6;\n\t\t}\n\t\t&:before {\n\t\t\tcontent: '☐';\n\t\t\ttransform: translateY(26%);\n\t\t\tcolor: #5495F6;\n\t\t}\n\t}\n}\n\n/**\n * rotate\n */\n.vm-draggable__rotate {\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 50%;\n\tz-index: 2;\n\twidth: 500px;\n\tborder: 1px solid #1fb6ff;\n\tbackground-color: #1fb6ff;\n\ttransform: translate(-50%, -50%) rotate(90deg);\n}\n.vm-draggable__rotate--deg {\n\tposition: absolute;\n\ttop: 50%;\n\tleft: 50%;\n\tz-index: 2;\n\twidth: 500px;\n\tborder-top: 1px dashed #fff;\n\tborder-bottom: 1px dashed #262626;\n\topacity: .4;\n\t&.is-0 {\n\t\ttransform: translate(-50%, -50%);\n\t}\n\t&.is-45 {\n\t\ttransform: translate(-50%, -50%) rotate(45deg);\n\t}\n\t&.is-90 {\n\t\ttransform: translate(-50%, -50%) rotate(90deg);\n\t}\n\t&.is-135 {\n\t\ttransform: translate(-50%, -50%) rotate(135deg);\n\t}\n}\n\n.vm-draggable__rotate--tip {\n\tposition: absolute;\n\ttop: -50px;\n\tleft: 60%;\n\twidth: 40px;\n\theight: 16px;\n\tline-height: 16px;\n\ttext-align: center;\n\tborder: 1px solid #262626;\n\tborder-radius: 8px;\n\tbackground-color: #fff;\n}\n\n.vm-draggable__delete {\n\tbackground: #5495F6;\n\tposition: absolute;\n\tright: 0px;\n\twidth: 20px;\n\tcolor: white;\n\ttext-align: center;\n\tz-index: 300;\n\ttop: 0;\n\tright: 0px;\n\tcursor: pointer;\n}\n\n</style>\n"]},media:void 0})}),Ct,void 0,!1,void 0,!1,yt,void 0,void 0),kt=document.documentElement,Bt=null,Dt={replace:!0,name:"vm-srot-list-item",props:{index:{type:[Number,String],required:!0},type:{type:String,default:"@wya/vm"},disabled:$t.props.disabled,editorRegExp:$t.props.editorRegExp,entryRegExp:$t.props.entryRegExp,prevent:$t.props.prevent,preventRegExp:$t.props.preventRegExp,closeable:$t.props.closeable,draggable:{type:Boolean,default:!0},showHighlight:{type:Boolean,default:!0}},data:function(){return{isActive:!1,isHover:!1,highlight:!1}},computed:{},watch:{},beforeCreate:function(){this.eventOpts=!rt||{capture:!0,passive:!0}},mounted:function(){},destroyed:function(){this.operateDOMEvents("remove")},methods:{operateDOMEvents:function(t){("add"===t?kt.addEventListener:kt.removeEventListener)("mousedown",this.handleDeselect,this.eventOpts)},setActived:function(){this.handleClick()},handleClick:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.prevent&&t.preventDefault&&!At(t.target,this.preventRegExp)&&t.preventDefault(),!this.disabled){var n=t.target||t.srcElement;n&&!this.$el.contains(n)||this.isActive||(this.operateDOMEvents("add"),this.isActive=!0,this.$emit("activated",t))}},handleDeselect:function(t){var n=this,e=t.target||t.srcElement,i=t.path||t.composedPath&&t.composedPath()||[];!i.some((function(t){return At(t,n.entryRegExp)}))||this.$el.contains(e)||i.some((function(t){return At(t,n.editorRegExp)}))||this.isActive&&(this.operateDOMEvents("remove"),this.isActive=!1,this.$emit("deactivated",t))},handleDragStart:function(t){t.dataTransfer.setData(this.type,this.index),t.dataTransfer.effectAllowed="move",(Bt=t.target).__START_INDEX__=this.index,Bt.__END_INDEX__=this.index,Bt.__DRAGGABLE__=this.draggable,t.target.style.opacity=0},handleDragEnter:function(t){var n=this;if(this.draggable&&Bt&&Bt.__DRAGGABLE__&&t.target!=Bt){if(this.index!=Bt.__END_INDEX__){if(this.timer)return;this.timer=setTimeout((function(){n.timer=null}),500),this.$emit("sorting",[Bt.__END_INDEX__,this.index]),Bt.__END_INDEX__=this.index}}else Bt||(this.highlight=!0,this.$emit("highlight-change",!0))},handleDragLeave:function(t){this.$refs.highlight!==t.fromElement&&(this.highlight=!1,this.$emit("highlight-change",!1))},handleDragEnd:function(t){t.dataTransfer.clearData(this.type),t.target.style.opacity=1,Bt&&this.$emit("sort-end",[Bt.__START_INDEX__,Bt.__END_INDEX__]),Bt=null}}},St=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"vm-sortable",class:t.draggable?"":"vm-sortable-disabled",attrs:{draggable:t.draggable&&!t.disabled},on:{click:t.handleClick,dragstart:t.handleDragStart,dragenter:t.handleDragEnter,dragleave:t.handleDragLeave,dragover:function(t){t.preventDefault()},dragend:t.handleDragEnd,mouseenter:function(n){t.isHover=!0},mouseleave:function(n){t.isHover=!1}}},[e("div",{staticStyle:{"pointer-events":"none"}},[t._t("default")],2),t._v(" "),t.isActive||t.isHover?e("div",{staticClass:"vm-sortable__handle",class:{"is-disabled":t.disabled,"is-active":!0}}):t._e(),t._v(" "),t.closeable&&(t.isActive||t.isHover)?e("p",{staticClass:"vm-sortable__delete",on:{click:function(n){return t.$emit("delete")}}},[t._v("\n\t\t✕\n\t")]):t._e(),t._v(" "),t.showHighlight&&t.highlight?e("p",{ref:"highlight",staticClass:"vm-sortable__highlight"},[t._v("\n\t\t释放鼠标将模块添加到此处\n\t")]):t._e()])};St._withStripped=!0;var Ot=vt({render:St,staticRenderFns:[]},(function(t){t&&t("data-v-1a8f2f03_0",{source:".vm-sortable {\n  padding: 0;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  position: relative;\n  -webkit-transition: opacity 0.5s;\n  transition: opacity 0.5s;\n}\n.vm-sortable:hover {\n  cursor: move;\n}\n.vm-sortable .vm-sortable__handle.is-active {\n  padding: 0;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  position: absolute;\n  z-index: 2;\n  border: 1px dotted #5495F6;\n}\n.vm-sortable.is-disabled {\n  cursor: no-drop;\n}\n.vm-sortable-disabled:hover {\n  cursor: default;\n}\n.vm-sortable__delete {\n  background: #5495F6;\n  position: absolute;\n  right: 0px;\n  width: 20px;\n  color: white;\n  text-align: center;\n  z-index: 300;\n  top: 0;\n  right: 0px;\n  cursor: pointer;\n}\n.vm-sortable__highlight {\n  height: 55px;\n  background: #E7F4FF;\n  color: #5495F6;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  border: 1px dotted #5495F6;\n}\n\n/*# sourceMappingURL=sortable.vue.map */",map:{version:3,sources:["/Users/deot/Desktop/wya/github/wya-vm/src/base/sortable.vue","sortable.vue"],names:[],mappings:"AAuOA;EACA,UAAA;EACA,8BAAA;UAAA,sBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;EACA,kBAAA;EACA,gCAAA;EAAA,wBAAA;ACtOA;ADuOA;EACA,YAAA;ACrOA;ADwOA;EACA,UAAA;EACA,MAAA;EACA,OAAA;EACA,QAAA;EACA,SAAA;EACA,kBAAA;EACA,UAAA;EACA,0BAAA;ACtOA;AD0OA;EACA,eAAA;ACxOA;AD4OA;EACA,eAAA;ACzOA;AD4OA;EACA,mBAAA;EACA,kBAAA;EACA,UAAA;EACA,WAAA;EACA,YAAA;EACA,kBAAA;EACA,YAAA;EACA,MAAA;EACA,UAAA;EACA,eAAA;ACzOA;AD4OA;EACA,YAAA;EACA,mBAAA;EACA,cAAA;EACA,oBAAA;EAAA,qBAAA;EAAA,oBAAA;EAAA,aAAA;EACA,yBAAA;EAAA,2BAAA;MAAA,sBAAA;UAAA,mBAAA;EACA,wBAAA;EAAA,+BAAA;MAAA,qBAAA;UAAA,uBAAA;EACA,0BAAA;ACzOA;;AAEA,uCAAuC",file:"sortable.vue",sourcesContent:['<template>\n\t<div\n\t\t:draggable="draggable && !disabled"\n\t\t:class="!draggable ? \'vm-sortable-disabled\' : \'\'"\n\t\tclass="vm-sortable"\n\t\t@click="handleClick"\n\t\t@dragstart="handleDragStart"\n\t\t@dragenter="handleDragEnter"\n\t\t@dragleave="handleDragLeave"\n\t\t@dragover.prevent\n\t\t@dragend="handleDragEnd"\n\t\t@mouseenter="isHover = true"\n\t\t@mouseleave="isHover = false"\n\t>\n\t\t<div style="pointer-events: none;">\n\t\t\t<slot />\n\t\t</div>\n\t\t\x3c!-- handle --\x3e\n\t\t<div\n\t\t\tv-if="isActive || isHover"\n\t\t\t:class="{\n\t\t\t\t\'is-disabled\': disabled,\n\t\t\t\t\'is-active\': true\n\t\t\t}"\n\t\t\tclass="vm-sortable__handle"\n\t\t/>\n\t\t<p\n\t\t\tv-if="closeable && (isActive || isHover)"\n\t\t\tclass="vm-sortable__delete"\n\t\t\t@click="$emit(\'delete\')"\n\t\t>\n\t\t\t✕\n\t\t</p>\n\n\t\t<p\n\t\t\tv-if="showHighlight && highlight"\n\t\t\tref="highlight"\n\t\t\tclass="vm-sortable__highlight"\n\t\t>\n\t\t\t释放鼠标将模块添加到此处\n\t\t</p>\n\t</div>\n</template>\n\n<script>\nimport { isPassiveSupported, eleInRegExp } from \'../utils/helper\';\nimport Draggable from \'./draggable.vue\';\n\nconst doc = document.documentElement;\nlet eleDrag = null;\n\nexport default {\n\treplace: true,\n\tname: \'vm-srot-list-item\',\n\tprops: {\n\t\t// 当前排序数组的索引值，非order\n\t\tindex: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true\n\t\t},\n\t\t// 用于getData/setData\n\t\ttype: {\n\t\t\ttype: String,\n\t\t\tdefault: \'@wya/vm\'\n\t\t},\n\t\tdisabled: Draggable.props.disabled,\n\t\teditorRegExp: Draggable.props.editorRegExp,\n\t\tentryRegExp: Draggable.props.entryRegExp,\n\t\tprevent: Draggable.props.prevent,\n\t\tpreventRegExp: Draggable.props.preventRegExp,\n\t\tcloseable: Draggable.props.closeable,\n\t\tdraggable: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t},\n\t\tshowHighlight: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t}\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tisActive: false,\n\t\t\tisHover: false,\n\t\t\thighlight: false\n\t\t};\n\t},\n\tcomputed: {\n\n\t},\n\twatch: {},\n\tbeforeCreate() {\n\t\t// 组件捕获阶段执行\n\t\tthis.eventOpts = !isPassiveSupported || { capture: true, passive: true };\n\t},\n\tmounted() {\n\n\t},\n\tdestroyed() {\n\t\tthis.operateDOMEvents(\'remove\');\n\t},\n\tmethods: {\n\t\toperateDOMEvents(type) {\n\t\t\tlet fn = type === \'add\' ? doc.addEventListener : doc.removeEventListener;\n\n\t\t\tfn(\'mousedown\', this.handleDeselect, this.eventOpts);\n\t\t},\n\t\t/**\n\t\t * 模拟设置Active状态\n\t\t */\n\t\tsetActived() {\n\t\t\tthis.handleClick();\n\t\t},\n\t\t/**\n\t\t * 组件被按下事件\n\t\t */\n\t\thandleClick(e = {}) {\n\t\t\t// 去除默认事件\n\t\t\tthis.prevent\n\t\t\t\t&& e.preventDefault\n\t\t\t\t&& !eleInRegExp(e.target, this.preventRegExp)\n\t\t\t\t&& e.preventDefault();\n\n\t\t\t// 判断是否支持拖动\n\t\t\tif (this.disabled) return;\n\t\t\tconst target = e.target || e.srcElement;\n\t\t\t// 确保事件发生在组件内部\n\t\t\tif (!target || this.$el.contains(target)) {\n\t\t\t\tif (!this.isActive) {\n\t\t\t\t\t// 绑定事件\n\t\t\t\t\tthis.operateDOMEvents(\'add\');\n\n\t\t\t\t\tthis.isActive = true;\n\t\t\t\t\tthis.$emit(\'activated\', e);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * 取消选择事件\n\t\t */\n\t\thandleDeselect(e) {\n\t\t\tconst target = e.target || e.srcElement; // body不要带上class, 否则会存在问题\n\n\t\t\tlet path = e.path || (e.composedPath && e.composedPath()) || [];\n\n\t\t\t// 是否是入口下的元素，如果不是，就意味着可能是弹层（避免销毁）\n\t\t\tlet isInline = path.some(item => eleInRegExp(item, this.entryRegExp));\n\n\t\t\tif (\n\t\t\t\tisInline\n\t\t\t\t&& !this.$el.contains(target)\n\t\t\t\t&& (!path.some(item => eleInRegExp(item, this.editorRegExp)))\n\t\t\t) {\n\t\t\t\tif (this.isActive) {\n\t\t\t\t\t// 解绑\n\t\t\t\t\tthis.operateDOMEvents(\'remove\');\n\n\t\t\t\t\tthis.isActive = false;\n\t\t\t\t\tthis.$emit(\'deactivated\', e);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t* 拖拽开始\n\t\t*/\n\t\thandleDragStart(e) {\n\t\t\t// 定义拖动数据 - 拖到别的输入框展示的内容\n\t\t\te.dataTransfer.setData(this.type, this.index);\n\n\t\t\t// 拖放效果\n\t\t\te.dataTransfer.effectAllowed = "move";\n\n\t\t\teleDrag = e.target;\n\n\t\t\teleDrag.__START_INDEX__ = this.index;\n\t\t\teleDrag.__END_INDEX__ = this.index;\n\t\t\teleDrag.__DRAGGABLE__ = this.draggable;\n\n\t\t\te.target.style.opacity = 0;\n\t\t},\n\n\t\t/**\n\t\t* 拖拽元素进入目标元素头上的时候\n\t\t*/\n\t\thandleDragEnter(e) {\n\t\t\tif (this.draggable && eleDrag && eleDrag.__DRAGGABLE__ && e.target != eleDrag) { // 排序\n\t\t\t\tif (this.index != eleDrag.__END_INDEX__) {\n\t\t\t\t\tif (this.timer) return;\n\t\t\t\t\tthis.timer = setTimeout(() => {\n\t\t\t\t\t\tthis.timer = null;\n\t\t\t\t\t}, 500);\n\n\t\t\t\t\tthis.$emit(\'sorting\', [eleDrag.__END_INDEX__, this.index]);\n\t\t\t\t\teleDrag.__END_INDEX__ = this.index;\n\t\t\t\t}\n\t\t\t} else if (!eleDrag) { // 处理高亮\n\t\t\t\tthis.highlight = true;\n\t\t\t\tthis.$emit(\'highlight-change\', true);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * 拖拽离开\n\t\t */\n\t\thandleDragLeave(e) {\n\t\t\tif (this.$refs.highlight === e.fromElement) return;\n\n\t\t\tthis.highlight = false;\n\t\t\tthis.$emit(\'highlight-change\', false);\n\t\t},\n\n\t\t/**\n\t\t* 拖拽结束\n\t\t*/\n\t\thandleDragEnd(e) {\n\t\t\te.dataTransfer.clearData(this.type);\n\n\t\t\te.target.style.opacity = 1;\n\n\t\t\tif (eleDrag) {\n\t\t\t\tthis.$emit(\'sort-end\', [eleDrag.__START_INDEX__, eleDrag.__END_INDEX__]);\n\t\t\t}\n\n\t\t\teleDrag = null;\n\t\t}\n\t},\n};\n<\/script>\n\n<style lang="scss">\n.vm-sortable {\n\tpadding: 0;\n\tbox-sizing: border-box;\n\tuser-select: none;\n\tposition: relative;\n\ttransition: opacity .5s; // 目的是让拖拽的那个元素保持不透明， 文档流里透明\n\t&:hover {\n\t\tcursor: move;\n\t}\n\t.vm-sortable__handle {\n\t\t&.is-active {\n\t\t\tpadding: 0;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\t\t\tright: 0;\n\t\t\tbottom: 0;\n\t\t\tposition: absolute;\n\t\t\tz-index: 2;\n\t\t\tborder: 1px dotted #5495F6;\n\t\t\t// cursor: move;\n\t\t}\n\t}\n\t&.is-disabled {\n\t\tcursor: no-drop;\n\t}\n}\n.vm-sortable-disabled {\n\t&:hover {\n\t\tcursor: default;\n\t}\n}\n.vm-sortable__delete {\n\tbackground: #5495F6;\n\tposition: absolute;\n\tright: 0px;\n\twidth: 20px;\n\tcolor: white;\n\ttext-align: center;\n\tz-index: 300;\n\ttop: 0;\n\tright: 0px;\n\tcursor: pointer;\n}\n\n.vm-sortable__highlight {\n\theight: 55px;\n\tbackground: #E7F4FF;\n\tcolor: #5495F6;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tborder: 1px dotted #5495F6;\n}\n\n</style>\n',".vm-sortable {\n  padding: 0;\n  box-sizing: border-box;\n  user-select: none;\n  position: relative;\n  transition: opacity 0.5s;\n}\n.vm-sortable:hover {\n  cursor: move;\n}\n.vm-sortable .vm-sortable__handle.is-active {\n  padding: 0;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  position: absolute;\n  z-index: 2;\n  border: 1px dotted #5495F6;\n}\n.vm-sortable.is-disabled {\n  cursor: no-drop;\n}\n\n.vm-sortable-disabled:hover {\n  cursor: default;\n}\n\n.vm-sortable__delete {\n  background: #5495F6;\n  position: absolute;\n  right: 0px;\n  width: 20px;\n  color: white;\n  text-align: center;\n  z-index: 300;\n  top: 0;\n  right: 0px;\n  cursor: pointer;\n}\n\n.vm-sortable__highlight {\n  height: 55px;\n  background: #E7F4FF;\n  color: #5495F6;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border: 1px dotted #5495F6;\n}\n\n/*# sourceMappingURL=sortable.vue.map */"]},media:void 0})}),Dt,void 0,!1,void 0,!1,yt,void 0,void 0),Mt={name:"vm-widget",props:{draggable:{type:Boolean,default:!0},module:{type:String,required:!0},index:{type:Number}},computed:{style:function(){return this.draggable?{cursor:"move"}:{}}},methods:{handleStart:function(t){t.dataTransfer.setData("@wya/vm",JSON.stringify({module:this.module,index:this.index}))}}},zt=function(){var t=this,n=t.$createElement;return(t._self._c||n)("div",{style:t.style,attrs:{draggable:t.draggable},on:{dragstart:function(n){t.draggable&&t.handleStart(n)}}},[t._t("default")],2)};zt._withStripped=!0;var Tt=vt({render:zt,staticRenderFns:[]},void 0,Mt,void 0,!1,void 0,!1,void 0,void 0,void 0),Ft={name:"vm-tpl-viewer",components:{},props:{vm:{type:Object,default:function(){return{}}},id:String,x:Number,y:Number,z:Number,w:Number,h:Number,r:Number,name:[Number,String]},data:function(){return{}},computed:{},created:function(){},methods:{}},Nt=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{style:[{height:t.h?t.h+"px":"auto",width:t.w?t.w+"px":"auto",color:"black"}]},[t._v("\n\tid: "+t._s(t.id)+" "),e("br"),t._v("\n\tX: "+t._s(t.x)+" "),e("br"),t._v("\n\tY: "+t._s(t.y)+" "),e("br"),t._v("\n\tZ: "+t._s(t.z)+" "),e("br"),t._v("\n\tWidth: "+t._s(t.w?t.w:"auto")+" "),e("br"),t._v("\n\tHeight: "+t._s(t.h?t.h:"auto")+" "),e("br"),t._v("\n\tRotate: "+t._s(t.r)+" "),e("br"),t._v("\n\tName: "+t._s(t.name)+" "),e("br")])};Nt._withStripped=!0;var Ut=vt({render:Nt,staticRenderFns:[]},(function(t){t&&t("data-v-f166bc66_0",{source:"\n\n/*# sourceMappingURL=viewer.vue.map */",map:{version:3,sources:["viewer.vue"],names:[],mappings:";;AAEA,qCAAqC",file:"viewer.vue"},media:void 0})}),Ft,"data-v-f166bc66",!1,void 0,!1,yt,void 0,void 0),Yt={name:"vm-tpl-editor",components:{},inheritAttrs:!1,props:{},data:function(){return{}},computed:{},created:function(){},methods:{handleChange:function(t,n){this.$emit("change",S.default({},n,t.target.value))},handleClick:function(){this.$emit("change",{x:this.x+1})}}},Lt=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticStyle:{display:"flex","flex-direction":"column"}},[e("div",[t._v("w: "),e("input",{domProps:{value:t.$attrs.w},on:{input:function(n){return t.handleChange(n,"w")}}})]),t._v(" "),e("div",[t._v("h: "),e("input",{domProps:{value:t.$attrs.h},on:{input:function(n){return t.handleChange(n,"h")}}})]),t._v(" "),e("div",[t._v("x: "),e("input",{domProps:{value:t.$attrs.x},on:{input:function(n){return t.handleChange(n,"x")}}})]),t._v(" "),e("div",[t._v("y: "),e("input",{domProps:{value:t.$attrs.y},on:{input:function(n){return t.handleChange(n,"y")}}})]),t._v(" "),e("div",[t._v("z: "),e("input",{domProps:{value:t.$attrs.z},on:{input:function(n){return t.handleChange(n,"z")}}})]),t._v(" "),e("div",[t._v("r: "),e("input",{domProps:{value:t.$attrs.r},on:{input:function(n){return t.handleChange(n,"r")}}})]),t._v(" "),e("div",[t._v("name: "),e("input",{domProps:{value:t.$attrs.name},on:{input:function(n){return t.handleChange(n,"name")}}})])])};Lt._withStripped=!0;var It={module:"tpl",type:"基础组件",name:"模版",Viewer:Ut,Editor:vt({render:Lt,staticRenderFns:[]},(function(t){t&&t("data-v-2cf16f80_0",{source:"input {\n  border: 1px solid #000;\n  margin: 10px;\n}\n\n/*# sourceMappingURL=editor.vue.map */",map:{version:3,sources:["/Users/deot/Desktop/wya/github/wya-vm/src/combo/modules/tpl/editor.vue","editor.vue"],names:[],mappings:"AAkDA;EACA,sBAAA;EACA,YAAA;ACjDA;;AAEA,qCAAqC",file:"editor.vue",sourcesContent:['<template>\n\t<div style="display: flex; flex-direction: column;">\n\t\t<div>w: <input :value="$attrs.w" @input="handleChange($event, \'w\')"></div>\n\t\t<div>h: <input :value="$attrs.h" @input="handleChange($event, \'h\')"></div>\n\t\t<div>x: <input :value="$attrs.x" @input="handleChange($event, \'x\')"></div>\n\t\t<div>y: <input :value="$attrs.y" @input="handleChange($event, \'y\')"></div>\n\t\t<div>z: <input :value="$attrs.z" @input="handleChange($event, \'z\')"></div>\n\t\t<div>r: <input :value="$attrs.r" @input="handleChange($event, \'r\')"></div>\n\t\t<div>name: <input :value="$attrs.name" @input="handleChange($event, \'name\')"></div>\n\t</div>\n</template>\n\n<script>\n\nexport default {\n\tname: \'vm-tpl-editor\',\n\tcomponents: {\n\t},\n\t// 以下两周都可行，相对的inheritAttrs比较好用的一点\n\tinheritAttrs: false,\n\tprops: {\n\t\t// w: Number,\n\t\t// h: Number,\n\t\t// r: Number,\n\t\t// x: Number,\n\t\t// y: Number,\n\t\t// z: Number,\n\t\t// name: [Number, String],\n\t},\n\tdata() {\n\t\treturn {\n\t\t};\n\t},\n\tcomputed: {\n\t},\n\tcreated() {\n\t},\n\tmethods: {\n\t\thandleChange(e, key) {\n\t\t\tthis.$emit(\'change\', { [key]: e.target.value });\n\t\t},\n\t\thandleClick() {\n\t\t\t// this.$emit(\'update:x\', this.x + 1);\n\t\t\tthis.$emit(\'change\', { x: this.x + 1 });\n\t\t}\n\t},\n};\n<\/script>\n\n<style lang="scss">\ninput {\n\tborder: 1px solid #000;\n\tmargin: 10px;\n}\n</style>\n',"input {\n  border: 1px solid #000;\n  margin: 10px;\n}\n\n/*# sourceMappingURL=editor.vue.map */"]},media:void 0})}),Yt,void 0,!1,void 0,!1,yt,void 0,void 0),max:5,insertion:"",data:{w:200,h:150,r:0,x:0,y:0,z:1,parent:!1,closeable:!0,name:"名称"},dataValidity:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.name?null:{error:"输入框内容必填"}}},Rt={name:"vm-tpl-viewer",components:{},props:{vm:{type:Object,default:function(){return{}}},id:String,x:Number,y:Number,z:Number,w:Number,h:Number,r:Number,name:[Number,String]},data:function(){return{}},computed:{},created:function(){},methods:{}},Wt=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{style:[{height:t.h?t.h+"px":"auto",width:t.w?t.w+"px":"auto",color:"black"}]},[t._v("\n\tid: "+t._s(t.id)+" "),e("br"),t._v("\n\tX: "+t._s(t.x)+" "),e("br"),t._v("\n\tY: "+t._s(t.y)+" "),e("br"),t._v("\n\tZ: "+t._s(t.z)+" "),e("br"),t._v("\n\tWidth: "+t._s(t.w?t.w:"auto")+" "),e("br"),t._v("\n\tHeight: "+t._s(t.h?t.h:"auto")+" "),e("br"),t._v("\n\tRotate: "+t._s(t.r)+" "),e("br"),t._v("\n\tName: "+t._s(t.name)+" "),e("br")])};Wt._withStripped=!0;var Pt=vt({render:Wt,staticRenderFns:[]},(function(t){t&&t("data-v-a7673120_0",{source:"\n\n/*# sourceMappingURL=viewer.vue.map */",map:{version:3,sources:["viewer.vue"],names:[],mappings:";;AAEA,qCAAqC",file:"viewer.vue"},media:void 0})}),Rt,void 0,!1,void 0,!1,yt,void 0,void 0),Xt={name:"vm-array-editor",components:{},inheritAttrs:!1,props:{},data:function(){return{}},computed:{},created:function(){},methods:{handleChange:function(t,n){this.$emit("change",S.default({},n,t.target.value))},handleClick:function(){this.$emit("change",{x:this.x+1})}}},jt=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticStyle:{display:"flex","flex-direction":"column"}},[e("div",[t._v("w: "),e("input",{domProps:{value:t.$attrs.w},on:{input:function(n){return t.handleChange(n,"w")}}})]),t._v(" "),e("div",[t._v("h: "),e("input",{domProps:{value:t.$attrs.h},on:{input:function(n){return t.handleChange(n,"h")}}})]),t._v(" "),e("div",[t._v("x: "),e("input",{domProps:{value:t.$attrs.x},on:{input:function(n){return t.handleChange(n,"x")}}})]),t._v(" "),e("div",[t._v("y: "),e("input",{domProps:{value:t.$attrs.y},on:{input:function(n){return t.handleChange(n,"y")}}})]),t._v(" "),e("div",[t._v("z: "),e("input",{domProps:{value:t.$attrs.z},on:{input:function(n){return t.handleChange(n,"z")}}})]),t._v(" "),e("div",[t._v("r: "),e("input",{domProps:{value:t.$attrs.r},on:{input:function(n){return t.handleChange(n,"r")}}})]),t._v(" "),e("div",[t._v("name: "),e("input",{domProps:{value:t.$attrs.name},on:{input:function(n){return t.handleChange(n,"name")}}})])])};jt._withStripped=!0;var Ht={tpl:It,array:{module:"array",type:"营销组件",name:"数组模版",widgets:[{render:function(t,n){return t("div",["一行两列"])}},{name:"一行两列",image:"https://avatars3.githubusercontent.com/u/34465004?s=200&v=4"}],Viewer:Pt,Editor:vt({render:jt,staticRenderFns:[]},(function(t){t&&t("data-v-7c4434dc_0",{source:"input {\n  border: 1px solid #000;\n  margin: 10px;\n}\n\n/*# sourceMappingURL=editor.vue.map */",map:{version:3,sources:["/Users/deot/Desktop/wya/github/wya-vm/src/combo/modules/array/editor.vue","editor.vue"],names:[],mappings:"AAkDA;EACA,sBAAA;EACA,YAAA;ACjDA;;AAEA,qCAAqC",file:"editor.vue",sourcesContent:['<template>\n\t<div style="display: flex; flex-direction: column;">\n\t\t<div>w: <input :value="$attrs.w" @input="handleChange($event, \'w\')"></div>\n\t\t<div>h: <input :value="$attrs.h" @input="handleChange($event, \'h\')"></div>\n\t\t<div>x: <input :value="$attrs.x" @input="handleChange($event, \'x\')"></div>\n\t\t<div>y: <input :value="$attrs.y" @input="handleChange($event, \'y\')"></div>\n\t\t<div>z: <input :value="$attrs.z" @input="handleChange($event, \'z\')"></div>\n\t\t<div>r: <input :value="$attrs.r" @input="handleChange($event, \'r\')"></div>\n\t\t<div>name: <input :value="$attrs.name" @input="handleChange($event, \'name\')"></div>\n\t</div>\n</template>\n\n<script>\n\nexport default {\n\tname: \'vm-array-editor\',\n\tcomponents: {\n\t},\n\t// 以下两周都可行，相对的inheritAttrs比较好用的一点\n\tinheritAttrs: false,\n\tprops: {\n\t\t// w: Number,\n\t\t// h: Number,\n\t\t// r: Number,\n\t\t// x: Number,\n\t\t// y: Number,\n\t\t// z: Number,\n\t\t// name: [Number, String],\n\t},\n\tdata() {\n\t\treturn {\n\t\t};\n\t},\n\tcomputed: {\n\t},\n\tcreated() {\n\t},\n\tmethods: {\n\t\thandleChange(e, key) {\n\t\t\tthis.$emit(\'change\', { [key]: e.target.value });\n\t\t},\n\t\thandleClick() {\n\t\t\t// this.$emit(\'update:x\', this.x + 1);\n\t\t\tthis.$emit(\'change\', { x: this.x + 1 });\n\t\t}\n\t},\n};\n<\/script>\n\n<style lang="scss">\ninput {\n\tborder: 1px solid #000;\n\tmargin: 10px;\n}\n</style>\n',"input {\n  border: 1px solid #000;\n  margin: 10px;\n}\n\n/*# sourceMappingURL=editor.vue.map */"]},media:void 0})}),Xt,void 0,!1,void 0,!1,yt,void 0,void 0),max:5,insertion:"",data:function(t){return{w:200,h:150,r:0,x:0,y:0,z:1,parent:!1,closeable:!0,name:"名称".concat(t)}},dataValidity:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.name?null:{error:"输入框内容必填"}}}},qt={data:function(){return{states:{currentSnapshot:0,totalSnapshot:0}}},created:function(){this.historyData=[]},methods:{updateHistory:function(t,n){var e=this.states,i=e.currentSnapshot,r=e.totalSnapshot,a=n.id,s=n.original,l=n.index,d=n.data,A={type:t,id:a,original:s,index:l,revert:n.revert,data:o.cloneDeep(d)};i===r?this.historyData.push(A):this.historyData.splice(i,r-i,A),this.resetHistorySnapshot()},removeHistory:function(t){if(t){var n=this.historyData.length;this.historyData.splice(n-t-1,t),this.resetHistorySnapshot()}},resetHistorySnapshot:function(){var t=this.historyData.length;this.states.currentSnapshot=t,this.states.totalSnapshot=t}}},Gt={data:function(){return{states:{currentEditor:null,pageEditor:null,frameW:0,frameH:0}}},watch:{"states.pageEditor":{deep:!0,immediate:!0,handler:function(t,n){t&&t.w&&(this.states.frameW=t.w),t&&t.h&&(this.states.frameH=t.h),null===n&&t&&this.combo&&this.combo.resetScale&&this.combo.resetScale(500)}}},methods:{updatePageEditor:function(t){if(!t.length)return{};for(var n=0;n<t.length;n++){var e=t[n];if("page"===e.module){this.states.pageEditor=e;break}}},resetCurrentEditor:function(t){this.states.currentEditor=t||this.states.pageEditor||null,t&&"page"===t.module&&(this.states.pageEditor=t)},updateCurrentEditor:function(){var t,n=this.states,e=n.data,i=void 0===e?[]:e,r=n.currentEditor;r&&(t=i.find((function(t){return t.id===r.id}))),this.states.currentEditor=t||this.states.pageEditor||null}}};function Vt(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,i)}return e}function Kt(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?Vt(Object(e),!0).forEach((function(n){S.default(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Vt(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function Jt(t){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var e,i=L.default(t);if(n){var r=L.default(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return Y.default(this,e)}}var Zt=function(t){U.default(e,t);var n=Jt(e);function e(t){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(T.default(this,e),i=n.call(this),S.default(N.default(i),"mutations",{INIT:function(t,n){if(t._data!==n&&!o.isEqualWith(n,t.data)){var e=this._makeRebuildData(n);t._data=e,t.data=e,this.updatePageEditor(e),this.updateCurrentEditor()}},CREATE:function(t,n){n.id;var e=n.index,i=n.data,r=n.revert;t.data.splice(e,0,i),this.updateHistory("CREATE",Kt(Kt({},n),{},{data:i,index:e,revert:r}))},DELETE:function(t,n){var e=n.id,i=n.revert,r=t.data.findIndex((function(t){return t.id===e})),o=t.data[r];t.data.splice(r,1),this.resetCurrentEditor(),this.updateHistory("DELETE",Kt(Kt({},n),{},{revert:i,data:o,index:r}))},UPDATE:function(t,n){var e=n.id,i=n.changed,r=n.original,o=void 0===r?{}:r,a=n.history,s=void 0===a||a,l=n.revert,d=t.data.findIndex((function(t){return t.id===e}));i&&Object.keys(i).forEach((function(n){o[n]=t.data[d][n],ot(t.data[d],n)?t.data[d][n]=i[n]:(mt.debug("当前模块不存在字段".concat(n,", 强制替换值以适配响应")),t.data.splice(d,1,Kt(Kt({},t.data[d]),{},S.default({},n,i[n]))))})),t.currentEditor&&t.currentEditor.id===e&&this.resetCurrentEditor(t.data[d]),s&&this.updateHistory("UPDATE",Kt(Kt({},n),{},{revert:l,original:o,data:t.data[d],index:d}))},SORT:function(t,n){var e=n.changed,i=n.original,r=n.history,o=void 0===r||r,a=n.revert;if(e&&e[0]!==e[1]){var s=t.data[e[0]],l=t.data[e[1]];l.z&&s.z&&s.z!=l.z&&(s.z=l.z),t.data.splice(e[1]+(e[0]<e[1]),0,s),t.data.splice(e[0]+(e[0]>e[1]),1)}!o||i&&i[0]===i[1]||this.updateHistory("SORT",{original:e||i,revert:a})},DUMMY:function(t,n){var e=n.revert;this.updateHistory("DUMMY",Kt(Kt({},n),{},{revert:e}))},UNDO:function(t,n){var e=this,i=n.current;t.currentSnapshot=i;var r=this.historyData[i]||{},a=r.type,s=r.id,l=r.data,d=r.index,A=r.original,c={CREATE:function(){return t.data.splice(d,1)},DELETE:function(){return t.data.splice(d,0,l)},UPDATE:function(){return t.data.splice(d,1,o.cloneDeep(Kt(Kt({},l),A)))},SORT:function(){return e.commit("SORT",{changed:A.slice().reverse(),history:!1})},DUMMY:function(){}};c[a]&&c[a](),t.currentEditor&&t.currentEditor.id===s&&this.resetCurrentEditor(t.data[d])},REDO:function(t,n){var e=this,i=n.current;t.currentSnapshot=i;var r=this.historyData[i-1]||{},o=r.type,a=r.id,s=r.data,l=r.index,d=r.original,A={CREATE:function(){return t.data.splice(l,0,s)},DELETE:function(){return t.data.splice(l,1)},UPDATE:function(){return t.data.splice(l,1,s)},SORT:function(){return e.commit("SORT",{changed:d,history:!1})},DUMMY:function(){}};A[o]&&A[o](),t.currentEditor&&t.currentEditor.id===a&&this.resetCurrentEditor(t.data[l])}}),!t)throw new Error("combo必传");return i.combo=t,Object.keys(r).forEach((function(t){i.states[t]=r[t]})),i}return F.default(e,[{key:"destroy",value:function(){this.$destroy()}},{key:"commit",value:function(t){t=t.toUpperCase();var n=this.mutations;if(!n[t])throw new Error("[wya-vm/combo]: mutation 未定义 - ".concat(t));for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];n[t].apply(this,[this.states].concat(i))}},{key:"_makeRebuildData",value:function(t){var n=this.combo.$options.modules;return o.cloneDeep(t).map((function(t){var e=n[t.module]||{},i=e.data,r=void 0===i?{}:i,o=e.rebuilder,a=void 0===o?{}:o;return"function"==typeof r&&(r=r()),"function"==typeof a&&(a=a()),Object.keys(t).forEach((function(n){a[n]&&(t[n]instanceof Array?t[n]=t[n].map((function(t){return Kt(Kt({},a[n]),t)})):t[n]instanceof Object&&(t[n]=Kt(Kt({},a[n]),t[n])))})),Kt(Kt({},r),t)}))}}]),e}(I.default.extend({mixins:[qt,Gt],data:function(){return{states:{data:[]}}},computed:{},methods:{}})),Qt={name:"vm-assist-preview",provide:function(){var t=this;return{getVM:function(){return t},getData:function(){return t.dataSource}}},components:{},props:{dataSource:Array,mode:String,frameW:Number},data:function(){return{SELECTION_MODULE:Z,vm:{type:"preview"}}},computed:{isDraggable:function(){return"draggable"===this.mode},scale:function(){return void 0===this.frameW?1:window.innerWidth/this.frameW}},created:function(){this.isWatch=!1,this.currentId=""},methods:{handleClick:function(t){var n=this;this.currentId=this.currentId===t?null:t,this.isWatch||(this.isWatch=!0,this.$watch("dataSource",(function(t){n.currentId&&(console.log("\n----"),console.log(new RegExp((new Date).toString())),console.log(JSON.parse(JSON.stringify(t.find((function(t){return t.id===n.currentId}))))),console.log("----\n\n"))}),{deep:!0,immediate:!0}))}}},tn=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"vm-assist-preview"},[e("div",{staticStyle:{position:"relative"}},t._l(t.dataSource,(function(n,i){return e("div",{key:n.id,style:t.isDraggable?{position:"absolute",width:n.w?n.w*t.scale+"px":"auto",height:n.h?n.h*t.scale+"px":"auto",borderRadius:n.borderRadius?n.borderRadius*t.scale+"px":"inherit",left:n.x*t.scale+"px",top:n.y*t.scale+"px",transform:"rotate("+n.r+"deg)"}:{},on:{click:function(e){return e.altKey?e.ctrlKey||e.shiftKey||e.metaKey?null:t.handleClick(n.id):null}}},[n.module!==t.SELECTION_MODULE?[e("vm-"+n.module+"-viewer",t._b({tag:"component",attrs:{vm:t.vm,index:i}},"component",n,!1))]:[e("div")]],2)})),0)])};tn._withStripped=!0;var nn=vt({render:tn,staticRenderFns:[]},void 0,Qt,void 0,!1,void 0,!1,void 0,void 0,void 0);function en(t,n){void 0===n&&(n={});var e=n.insertAt;if(t&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===e&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}}en("#test{color:red}");var rn=["filename","getFile"],on={name:"vm-preview",components:{"vc-html-img":K.default},props:{dataSource:Array,styles:{type:Object},className:{type:String},animate:{type:String,default:"vm-fade"},mask:{type:Boolean,default:!0},mode:{type:String,default:"draggable"},expect:{type:String},imageOpts:Object},data:function(){return{isActive:!1,transform:"translate(-100px, -100px)"}},computed:{isDraggable:function(){return"draggable"===this.mode},useImageMode:function(){return"image"===this.expect||"download"===this.expect},componentType:function(){return this.useImageMode?"vc-html-img":"div"},popupStyle:function(){return this.useImageMode?{top:"100%",bottom:"unset"}:{}},htmlImgOpts:function(){var t=this.imageOpts||{};return t.filename,t.getFile,z.default(t,rn)}},watch:{},mounted:function(){this.isActive=!0,this.generateImage(),this.download()},methods:{generateImage:function(){var t=this;return R.default(W.default.mark((function n(){var e;return W.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("image"===t.expect){n.next=2;break}return n.abrupt("return");case 2:return n.prev=2,n.next=5,t.$refs.htmlImg.getImage(t.imageOpts||{});case 5:e=n.sent,t.isActive=!1,t.$emit("sure",e),n.next=14;break;case 10:n.prev=10,n.t0=n.catch(2),t.isActive=!1,t.$emit("close",res);case 14:case"end":return n.stop()}}),n,null,[[2,10]])})))()},download:function(){},handleClose:function(){var t=this;this.isActive=!1,setTimeout((function(){t.$emit("close")}),300)}}},an=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"vm-assist-preview-popup",style:t.popupStyle},[t.mask?e("transition",{attrs:{name:t.animate}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.isActive,expression:"isActive"}],staticClass:"vm-assist-preview-popup__mask",on:{click:t.handleClose}})]):t._e(),t._v(" "),t.mask?e("transition",{attrs:{name:t.animate}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.isActive,expression:"isActive"}],staticClass:"vm-assist-preview-popup__close",on:{click:t.handleClose}},[t._v("\n\t\t\t✕\n\t\t")])]):t._e(),t._v(" "),e("transition",{attrs:{name:t.animate}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.isActive,expression:"isActive"}],staticClass:"vm-assist-preview-popup__content"},[e(t.componentType,{ref:"htmlImg",tag:"component",style:t.styles,attrs:{options:t.htmlImgOpts}},[e("vm-preview",{attrs:{"data-source":t.dataSource,mode:t.mode}})],1)],1)])],1)};an._withStripped=!0;var sn={Preview:nn,PreviewPopup:vt({render:an,staticRenderFns:[]},(function(t){t&&t("data-v-aee5bcf4_0",{source:".vm-assist-preview-popup {\n  position: fixed;\n  top: 0;\n  right: 0;\n  left: 0;\n  bottom: 0;\n  z-index: 999;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n}\n.vm-assist-preview-popup__mask {\n  position: absolute;\n  z-index: 997;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.2);\n  -webkit-transition: opacity 0.2s;\n  transition: opacity 0.2s;\n}\n.vm-assist-preview-popup__content {\n  position: relative;\n  z-index: 998;\n  overflow: auto;\n  max-height: 100vh;\n  max-width: 100vw;\n  -webkit-transition: opacity 0.2s, -webkit-transform 0.2s;\n  transition: opacity 0.2s, -webkit-transform 0.2s;\n  transition: transform 0.2s, opacity 0.2s;\n  transition: transform 0.2s, opacity 0.2s, -webkit-transform 0.2s;\n}\n.vm-assist-preview-popup__close {\n  position: absolute;\n  right: 30px;\n  top: 30px;\n  font-size: 24px;\n  z-index: 999;\n}\n.vm-fade-enter, .vm-fade-leave-active {\n  opacity: 0;\n}\n\n/*# sourceMappingURL=popup.vue.map */",map:{version:3,sources:["/Users/deot/Desktop/wya/github/wya-vm/src/combo/assist/components/preview/popup.vue","popup.vue"],names:[],mappings:"AAuIA;EACA,eAAA;EACA,MAAA;EACA,QAAA;EACA,OAAA;EACA,SAAA;EACA,YAAA;EACA,oBAAA;EAAA,qBAAA;EAAA,oBAAA;EAAA,aAAA;EACA,yBAAA;EAAA,2BAAA;MAAA,sBAAA;UAAA,mBAAA;EACA,wBAAA;EAAA,+BAAA;MAAA,qBAAA;UAAA,uBAAA;ACtIA;ADwIA;EACA,kBAAA;EACA,YAAA;EACA,MAAA;EACA,OAAA;EACA,WAAA;EACA,YAAA;EACA,oCAAA;EAEA,gCAAA;EAAA,wBAAA;ACtIA;ADwIA;EACA,kBAAA;EACA,YAAA;EACA,cAAA;EACA,iBAAA;EACA,gBAAA;EACA,wDAAA;EAAA,gDAAA;EAAA,wCAAA;EAAA,gEAAA;ACrIA;ADuIA;EACA,kBAAA;EACA,WAAA;EACA,SAAA;EACA,eAAA;EACA,YAAA;ACpIA;ADsIA;EACA,UAAA;ACnIA;;AAEA,oCAAoC",file:"popup.vue",sourcesContent:['<template>\n\t<div class="vm-assist-preview-popup" :style="popupStyle">\n\t\t<transition v-if="mask" :name="animate">\n\t\t\t<div v-show="isActive" class="vm-assist-preview-popup__mask" @click="handleClose" />\n\t\t</transition>\n\t\t<transition v-if="mask" :name="animate">\n\t\t\t<div v-show="isActive" class="vm-assist-preview-popup__close" @click="handleClose">\n\t\t\t\t&#10005;\n\t\t\t</div>\n\t\t</transition>\n\t\t<transition :name="animate">\n\t\t\t<div v-show="isActive" class="vm-assist-preview-popup__content">\n\t\t\t\t<component \n\t\t\t\t\t:is="componentType" \n\t\t\t\t\tref="htmlImg" \n\t\t\t\t\t:style="styles" \n\t\t\t\t\t:options="htmlImgOpts"\n\t\t\t\t>\n\t\t\t\t\t<vm-preview \n\t\t\t\t\t\t:data-source="dataSource" \n\t\t\t\t\t\t:mode="mode"\n\t\t\t\t\t/>\n\t\t\t\t</component>\n\t\t\t</div>\n\t\t</transition>\n\t</div>\n</template>\n\n<script>\nimport { HtmlImg } from \'../../../../vc\';\n\nexport default {\n\tname: \'vm-preview\',\n\tcomponents: {\n\t\t\'vc-html-img\': HtmlImg\n\t},\n\tprops: {\n\t\tdataSource: Array,\n\t\tstyles: {\n\t\t\ttype: Object\n\t\t},\n\t\tclassName: {\n\t\t\ttype: String\n\t\t},\n\t\tanimate: {\n\t\t\ttype: String,\n\t\t\tdefault: \'vm-fade\'\n\t\t},\n\t\tmask: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t},\n\t\tmode: {\n\t\t\ttype: String,\n\t\t\tdefault: \'draggable\'\n\t\t},\n\n\t\t// download / image\n\t\texpect: {\n\t\t\ttype: String,\n\t\t},\n\n\t\timageOpts: Object\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tisActive: false,\n\t\t\ttransform: `translate(-100px, -100px)`\n\t\t};\n\t},\n\tcomputed: {\n\t\tisDraggable() {\n\t\t\treturn this.mode === \'draggable\';\n\t\t},\n\t\tuseImageMode() {\n\t\t\treturn this.expect === \'image\' || this.expect === \'download\';\n\t\t},\n\n\t\tcomponentType() {\n\t\t\treturn this.useImageMode ? \'vc-html-img\' : \'div\';\n\t\t},\n\n\t\tpopupStyle() {\n\t\t\tif (this.useImageMode) {\n\t\t\t\treturn {\n\t\t\t\t\ttop: \'100%\',\n\t\t\t\t\tbottom: \'unset\'\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn {};\n\t\t},\n\t\thtmlImgOpts() {\n\t\t\tconst { filename, getFile, ...rest } = this.imageOpts || {};\n\n\t\t\treturn rest;\n\t\t}\n\t},\n\twatch: {\n\t\t\n\t},\n\tmounted() {\n\t\tthis.isActive = true;\n\t\tthis.generateImage();\n\t\tthis.download();\n\t},\n\n\tmethods: {\n\t\tasync generateImage() {\n\t\t\tif (this.expect !== \'image\') return;\n\t\t\ttry {\n\t\t\t\tconst res = await this.$refs.htmlImg.getImage(this.imageOpts || {});\n\n\t\t\t\tthis.isActive = false;\n\t\t\t\tthis.$emit(\'sure\', res);\n\t\t\t} catch (e) {\n\t\t\t\tthis.isActive = false;\n\t\t\t\tthis.$emit(\'close\', res);\n\t\t\t}\n\t\t},\n\n\t\tdownload() {\n\t\t\t// TODO\n\t\t},\n\n\t\thandleClose() {\n\t\t\tthis.isActive = false;\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.$emit(\'close\');\n\t\t\t}, 300); // 动画时间\n\t\t}\n\t},\n};\n<\/script>\n\n<style lang="scss">\n.vm-assist-preview-popup {\n\tposition: fixed;\n\ttop: 0;\n\tright: 0;\n\tleft: 0;\n\tbottom: 0;\n\tz-index: 999;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n.vm-assist-preview-popup__mask {\n\tposition: absolute;\n\tz-index: 997;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\tbackground-color: rgba(#000, 0.2);\n\t// opacity: 0;\n\ttransition: opacity 0.2s;\n}\n.vm-assist-preview-popup__content {\n\tposition: relative;\n\tz-index: 998;\n\toverflow: auto; // 区域之外不形式\n\tmax-height: 100vh; \n\tmax-width: 100vw; \n\ttransition: transform 0.2s, opacity 0.2s;\n}\n.vm-assist-preview-popup__close {\n\tposition: absolute;\n\tright: 30px; \n\ttop: 30px;\n\tfont-size: 24px;\n\tz-index: 999;\n}\n.vm-fade-enter, .vm-fade-leave-active {\n\topacity: 0;\n}\n</style>\n',".vm-assist-preview-popup {\n  position: fixed;\n  top: 0;\n  right: 0;\n  left: 0;\n  bottom: 0;\n  z-index: 999;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.vm-assist-preview-popup__mask {\n  position: absolute;\n  z-index: 997;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.2);\n  transition: opacity 0.2s;\n}\n\n.vm-assist-preview-popup__content {\n  position: relative;\n  z-index: 998;\n  overflow: auto;\n  max-height: 100vh;\n  max-width: 100vw;\n  transition: transform 0.2s, opacity 0.2s;\n}\n\n.vm-assist-preview-popup__close {\n  position: absolute;\n  right: 30px;\n  top: 30px;\n  font-size: 24px;\n  z-index: 999;\n}\n\n.vm-fade-enter, .vm-fade-leave-active {\n  opacity: 0;\n}\n\n/*# sourceMappingURL=popup.vue.map */"]},media:void 0})}),on,void 0,!1,void 0,!1,yt,void 0,void 0)},ln="undefined"==typeof window,dn=!ln&&document.documentElement,An=function(t,n){return"add"===t?n.addEventListener:n.removeEventListener},cn=function(){function t(n){if(T.default(this,t),!n)throw new Error("combo必传");this.combo=n,this.frame=null,this.disabled=!this.combo.keyboardEnabled,this.isBlur=!0,this.handleKeydown=this.handleKeydown.bind(this),this.handleKeyup=this.handleKeyup.bind(this),this.handleFocus=this.handleFocus.bind(this),this.handleBlur=this.handleBlur.bind(this)}return F.default(t,[{key:"init",value:function(){this.frame=this.combo.$refs.frame,this.operateDOMEvents("add")}},{key:"destroy",value:function(){this.operateDOMEvents("remove")}},{key:"operateDOMEvents",value:function(t){if(!ln){var n=An(t,dn);if(n("keydown",this.handleKeydown),n("keyup",this.handleKeyup),this.frame)An(t,this.frame.$el)("mousedown",this.handleFocus),n("mousedown",this.handleBlur)}}},{key:"handleKeydown",value:function(t){if(!this.disabled&&!this.isBlur&&(mt.debug("".concat(t.ctrlKey?"ctrl":"").concat(t.metaKey?"command":"").concat(t.shiftKey?" + shift":"").concat(t.ctrlKey||t.metaKey||t.shiftKey?" + ":"").concat(t.key)),t.metaKey||t.ctrlKey)){if(90===t.keyCode||"z"===t.key)return void(t.shiftKey?this.combo.redo():this.combo.undo());if(67===t.keyCode||"c"===t.key)return void this.combo.copy();if(88===t.keyCode||"x"===t.key)return void this.combo.cut();if(86===t.keyCode||"v"===t.key)return void this.combo.paste();if(68===t.keyCode||"d"===t.key||83===t.keyCode||"s"===t.key)return void t.preventDefault()}}},{key:"handleKeyup",value:function(t){this.disabled}},{key:"handleFocus",value:function(t){!this.disabled&&this.isBlur&&this.frame.$el.contains(t.target)&&(this.isBlur=!1,mt.debug("keyboard focus"))}},{key:"handleBlur",value:function(t){var n=t.target,e=Boolean(n.getAttribute("contenteditable"))||/^(INPUT|TEXTAREA)$/.test(n.nodeName);this.disabled||this.isBlur||!e&&this.frame.$el.contains(t.target)||(this.isBlur=!0,mt.debug("keyboard blur"))}},{key:"enable",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.disabled=!t}}]),t}(),mn={keyboard:{props:{keyboardEnabled:{type:Boolean,default:!1}},data:function(){return this.keyboard=new cn(this),{}},watch:{keyboardEnabled:function(t){this.keyboard.enable(t)}},mounted:function(){this.keyboard.init()},destroyed:function(){this.keyboard.destroy()}}},un=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.map((function(t){return sn[t]})).filter((function(t){return!!t}))},hn=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.map((function(t){return mn[t]})).filter((function(t){return!!t}))};en(".vm-combo__theme--dark .vm-widget .vm-widget__wrapper{background:#535353;color:#fff}.vm-combo__theme--dark .vm-widget .vm-widget__header{color:#fff}.vm-combo__theme--dark .vm-widget .vm-widget__title{color:#fff;border-bottom:1px solid #4c4c4c}.vm-combo__theme--dark .vm-widget .vm-widget__tabs{color:#bdbdbd;border-right:none;border-bottom:none}.vm-combo__theme--dark .vm-widget .vm-widget__tabs p.is-active{color:#fff;background:#424242}.vm-combo__theme--dark .vm-widget .vm-widget__menu{border-top:1px solid #4c4c4c}.vm-combo__theme--dark .vm-widget .vm-widget__content{background:#424242}.vm-combo__theme--dark .vm-widget .vm-widget__arrow{border:2px solid #fff;border-top:0;border-left:0}.vm-combo__theme--dark .vm-widget .vm-widget__combo{border-bottom:1px solid #4c4c4c}.vm-combo__theme--dark .vm-editor .vm-editor__wrapper{background:#535353;color:#fff}.vm-combo__theme--dark .vm-frame-draggable--inner{border-left:1px solid #000;border-right:1px solid #000}.vm-combo__theme--dark .vm-ruler .vm-ruler__canvas{background:#474747}.vm-combo__theme--dark .vm-ruler .vm-ruler__guide{background:#535353}.vm-combo__theme--dark .vm-thumbnail{background:#424242}.vm-combo__theme--dark .vm-zoom-bar{background:#343434;-webkit-box-shadow:none;box-shadow:none}");var pn=["type"];function gn(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,i)}return e}function fn(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?gn(Object(e),!0).forEach((function(n){S.default(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):gn(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}var bn={name:"vm-combo",provide:function(){var t=this;return{getVM:function(){return t},getData:function(){return t.dataSource}}},components:{},mixins:hn(["keyboard"]),model:{prop:"data-source",event:"change"},props:{width:Number,height:Number,dataSource:{type:Array,default:function(){return[]}},frameStyle:Object,frameW:Number,frameH:Number,frameOpts:Object,widgetStyle:Object,widgetContentStyle:Object,widgetW:Number,widgetH:Number,widgetOpts:Object,editorStyle:Object,editorW:Number,editorH:Number,editorOpts:Object,theme:{type:String,default:"default"},showWidget:{type:Boolean,default:!0},showEditor:{type:Boolean,default:!0},showLines:{type:Boolean,default:!0},showRuler:{type:Boolean,default:!0},showZoomBar:{type:Boolean,default:!0},showThumbnail:{type:Boolean,default:!0}},data:function(){return this.store=new Zt(this,{frameW:this.frameW,frameH:this.frameH}),{}},computed:fn({style:function(){return{width:this.width?"".concat(this.width,"px"):"auto",height:this.height?"".concat(this.height,"px"):"auto"}},classes:function(){return{"vm-combo__theme--dark":"dark"===this.theme}}},function(t){var n={};return Object.keys(t).forEach((function(e){var i,r=t[e];"string"==typeof r?i=function(){return this.store.states[r]}:"function"==typeof r?i=function(){return r.call(this,this.store.states)}:console.error("invalid value type"),i&&(n[e]=i)})),n}({rebuildData:"data",rebuildFrameW:"frameW",rebuildFrameH:"frameH",current:"currentSnapshot",total:"totalSnapshot",editor:"currentEditor",pageEditor:"pageEditor"})),watch:{dataSource:{deep:!0,immediate:!0,handler:function(t){this.store.commit("INIT",t)}}},created:function(){this.VMComboId=lt("combo"),this.clipboardData=null,this.create=this.add,this.delete=this.remove},destroyed:function(){this.$options.previewManager.destroy()},methods:{syncData:function(){this.$emit("change",this.rebuildData),this.$emit("update:data-source",this.rebuildData)},handleActivated:function(t,n){this.store.resetCurrentEditor(n)},handleDeactivated:function(t,n){this.store.resetCurrentEditor()},handleWidgetChange:function(t){for(var n=arguments.length,e=new Array(n>1?n-1:0),i=1;i<n;i++)e[i-1]=arguments[i];this.$emit.apply(this,["widget-change",t].concat(e))},handleChange:function(t){var n=t.type,e=z.default(t,pn),i=e.id,r=e.original,o=e.changed,a=e.revert;switch(n){case"CREATE":case"UPDATE":case"DELETE":if(!i)throw new Error("[wya-vm/combo]: id 必传");break;case"SORT":if(!r&&!o)throw new Error("[wya-vm/combo]: original/changed 必传");break;case"DUMMY":if(void 0===a)throw new Error("[wya-vm/combo]: revert 不能为undefined")}this.store.commit(n,e),this.syncData()},add:function(t,n){this.$refs.frame.handleDrop({fake:!0,dataTransfer:{getData:function(){return JSON.stringify({module:t,index:n})}}},!0),this.syncData()},remove:function(t){var n=this,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i="object"===M.default(t),r=(i?t.id:t)||(this.editor||{}).id;r&&(e||"page"!==this.editor.module)?(t=i?t:this.rebuildData.findIndex((function(t){return t.id===r})),this.store.commit("DELETE",{id:r,revert:t.selections&&t.selections.length}),t.module===Z&&t.selections.forEach((function(e){n.store.commit("DELETE",{id:e,revert:t.selections&&t.selections.length})})),this.syncData()):this.$emit("error",{type:"id",msg:"请先选择操作对象"})},cut:function(){var t=this;if(this.editor&&"page"!==this.editor.module&&this.editor.module!==Z){this.clipboardData={type:"CUT",data:o.cloneDeep(this.editor),selections:this.editor.module===Z?o.cloneDeep(this.rebuildData.filter((function(n){return t.editor.selections.includes(n.id)}))):[]};var n=this.clipboardData.selections.length;this.store.commit("DELETE",{id:this.editor.id,revert:n}),this.clipboardData.selections.forEach((function(e){t.store.commit("DELETE",{id:e,revert:n})})),this.syncData()}},copy:function(t){(t||this.editor&&"page"!==this.editor.module)&&(t=t||this.editor,this.clipboardData={type:"COPY",data:o.cloneDeep(t),selections:this.editor.module===Z?o.cloneDeep(this.rebuildData.filter((function(n){return t.selections.includes(n.id)}))):[]})},paste:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.clipboardData){var e=this.clipboardData;e.type;var i=e.data,r=e.selections,a=void 0===r?[]:r,s=this.rebuildData.length,l=a.length,d=lt(),A=o.cloneDeep(i);if(A.x&&(A.x+=10),A.y&&(A.y+=10),Object.keys(n).forEach((function(t){return A[t]=n[t]})),A.id=d,A.module===Z){a=a.map((function(t){return t.id=lt(),t})),A.selections=a.map((function(t){return t.id}));var c=A.x-i.x,m=A.y-i.y;a.forEach((function(n,e){t.store.commit("CREATE",{index:s+e,id:n.id,revert:l,data:fn(fn({},n),{},{x:n.x+c,y:n.y+m})})}))}this.store.commit("CREATE",{index:s+l,id:d,data:A,revert:l}),this.syncData(),this.$refs.frame.setActivedById(d)}},undo:function(){var t=this,n=this.current-1;if(n<0)this.$emit("error",{type:"undo",msg:"目前已经是初始状态"});else{var e=(this.store.historyData[n]||{}).revert;this.store.commit("UNDO",{current:n}),e&&Array.from({length:e}).forEach((function(){t.store.commit("UNDO",{current:t.current-1})})),mt.debug("current: ".concat(this.current,", total: ").concat(this.total)),this.syncData()}},redo:function(){var t=this,n=this.current+1;if(n>this.total)this.$emit("error",{type:"undo",msg:"目前已经是最终状态"});else{var e=(this.store.historyData[n]||{}).revert;this.store.commit("REDO",{current:n}),e&&Array.from({length:e}).forEach((function(){t.store.commit("REDO",{current:t.current+1})})),mt.debug("current: ".concat(this.current,", total: ").concat(this.total)),this.syncData()}},save:function(){var t=o.cloneDeep(this.rebuildData)||[];if(0===t.length)return this.$emit("error",{type:"save",msg:"保存对象不能为空"}),!1;for(var n=this.$options.modules,e=0;e<t.length;e++){var i=t[e].module;if(n[i].dataValidity){var r=n[i].dataValidity(t[e]);if(r){var a=r.msg||r.message||r.error||r;return this.$emit("error",{type:"save",msg:"第".concat(e+1,"个 - ").concat(a),index:e}),this.$refs.frame.setActived(e),!1}}}return this.$emit("save",t),!0},getImage:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise((function(e,i){t.$options.previewManager.popup({dataSource:o.cloneDeep(t.rebuildData),styles:fn(fn({},t.frameStyle),{},{width:0===t.rebuildFrameW?"auto":"".concat(t.rebuildFrameW,"px"),height:0===t.rebuildFrameH?"auto":"".concat(t.rebuildFrameH,"px")}),className:"vm-combo__frame",expect:"image",imageOpts:n,onSure:e,onClose:i})}))},preview:function(){return 0===this.rebuildData.length?(this.$emit("error",{type:"preview",msg:"预览数据对象不能为空"}),!1):(this.$options.previewManager.popup({dataSource:o.cloneDeep(this.rebuildData),styles:fn(fn({},this.frameStyle),{},{width:0===this.rebuildFrameW?"auto":"".concat(this.rebuildFrameW,"px"),height:0===this.rebuildFrameH?"auto":"".concat(this.rebuildFrameH,"px")}),className:"vm-combo__frame"}),!0)},download:function(){var t=JSON.stringify(this.dataSource,null,"\t"),n=new Blob([t],{type:"application/json;charset=UTF-8"}),e=URL.createObjectURL(n),i=document.createElement("a");i.textContent="download json",i.href=e,i.download="data",i.click(),URL.revokeObjectURL(e)},upload:function(){var t=this,n=document.createElement("input");n.type="file",n.accept=".json",n.click(),n.onchange=function(){var e=n.files[0],i=new FileReader;i.readAsText(e,"UTF-8"),i.onload=function(n){try{var e=JSON.parse(n.target.result);t.store.commit("INIT",e)}catch(n){console.log(n)}}}}}},vn=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"vm-combo",class:t.classes,style:t.style},[t.showWidget?e("vm-widget",t._b({style:t.widgetStyle,attrs:{"content-style":t.widgetContentStyle,theme:t.theme},on:{change:t.handleWidgetChange}},"vm-widget",t.widgetOpts,!1)):t._e(),t._v(" "),e("vm-frame",t._b({ref:"frame",attrs:{"frame-style":t.frameStyle,width:t.rebuildFrameW,height:t.rebuildFrameH,"data-source":t.rebuildData,editor:t.editor,"show-lines":t.showLines,"show-ruler":t.showRuler,"show-zoom-bar":t.showZoomBar,"show-thumbnail":t.showThumbnail,theme:t.theme},on:{activated:t.handleActivated,deactivated:t.handleDeactivated,change:t.handleChange,"sort-end":function(n){return t.$emit("sort-end",arguments[0],arguments[1])},error:function(n){return t.$emit("error",arguments[0])}},scopedSlots:t._u([{key:"frame-header",fn:function(){return[t._t("frame-header")]},proxy:!0},{key:"frame-footer",fn:function(){return[t._t("frame-footer")]},proxy:!0}],null,!0)},"vm-frame",t.frameOpts,!1)),t._v(" "),t.showEditor?e("vm-editor",t._b({style:t.editorStyle,attrs:{value:t.editor,width:t.editorW,height:t.editorH},on:{change:t.handleChange}},"vm-editor",t.editorOpts,!1)):t._e()],1)};vn._withStripped=!0;var xn=vt({render:vn,staticRenderFns:[]},(function(t){t&&t("data-v-2c18d9de_0",{source:"@charset \"UTF-8\";\n/**\n * [commonDirectionFill 方向名词补充]\n * @param  {[string]} $key [l r b t]\n * @return {[string]}      [left right bottom top]\n */\n/**\n * [commonColumnWidth 平均分配百分比]\n * @param  {[number]} $col   [所占比]\n * @param  {[number]} $total [总]\n * @return {[number]}        [所占比/总 * 100%]\n */\n/**\n * [commonBorder 1px的兼容问题]\n * @param  {[string]} $border: ltbr          [border的方向缩写拼接]\n * @return {[type]}          [1px border]\n */\n/**\n * 1px\n * 已为父元素添加position: relative;\n * 其他只操作before和after;\n * 暂时不抽离公用\n */\n/**\n * [commonPadding padding]\n * @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonMargin margin]\n* @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonAbsolute absolute]\n * @param  {[list]} $direction-val... [top, right, bottom, left 的值]\n * @return {[type]}                   [description]\n */\n/**\n * 水平垂直居中\n */\n/**\n * 文字相关\n */\n/**\n * 一行文字\n */\n/* stylelint-disable */\n/**\n * [commonClearfix 清除浮动]\n * @return {[type]} [description]\n */\n/* Var\n -------------------------- */\n/* Func\n -------------------------- */\n/* Mix\n -------------------------- */\n/**\n * @param $root: 默认置顶\n */\n/**\n * 1. +, >, ~, ' '\n * 2. 同element\n * 3. 同modifier\n * 4. 同block\n */\n/**\n * -> [className].is_require \n * 与xxx:hover类似\n */\n/**\n * 用 @at-root 来重置 & 读取次数的计数\n * 如 [clsssName] [className]:hover\n */\n/**\n * 自定义规则\n */\n/**\n * TODO: 使用vc-scroller;\n */\n.vm-combo {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n}\n\n/*# sourceMappingURL=combo.vue.map */",map:{version:3,sources:["combo.vue","/Users/deot/Desktop/wya/github/wya-vm/src/combo/combo.vue"],names:[],mappings:"AAAA,gBAAgB;AAChB;;;;EAIE;AACF;;;;;EAKE;AACF;;;;EAIE;AACF;;;;;EAKE;AACF;;;;;;;EAOE;AACF;;;;;;;EAOE;AACF;;;;EAIE;AACF;;EAEE;AACF;;EAEE;AACF;;EAEE;AACF,sBAAsB;AACtB;;;EAGE;AACF;6BAC6B;AAC7B;6BAC6B;AAC7B;6BAC6B;AAC7B;;EAEE;AACF;;;;;EAKE;AACF;;;EAGE;AACF;;;EAGE;AACF;;EAEE;AACF;;EAEE;AC0fF;EACA,oBAAA;EAAA,qBAAA;EAAA,oBAAA;EAAA,aAAA;ADxfA;;AAEA,oCAAoC",file:"combo.vue",sourcesContent:["@charset \"UTF-8\";\n/**\n * [commonDirectionFill 方向名词补充]\n * @param  {[string]} $key [l r b t]\n * @return {[string]}      [left right bottom top]\n */\n/**\n * [commonColumnWidth 平均分配百分比]\n * @param  {[number]} $col   [所占比]\n * @param  {[number]} $total [总]\n * @return {[number]}        [所占比/总 * 100%]\n */\n/**\n * [commonBorder 1px的兼容问题]\n * @param  {[string]} $border: ltbr          [border的方向缩写拼接]\n * @return {[type]}          [1px border]\n */\n/**\n * 1px\n * 已为父元素添加position: relative;\n * 其他只操作before和after;\n * 暂时不抽离公用\n */\n/**\n * [commonPadding padding]\n * @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonMargin margin]\n* @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonAbsolute absolute]\n * @param  {[list]} $direction-val... [top, right, bottom, left 的值]\n * @return {[type]}                   [description]\n */\n/**\n * 水平垂直居中\n */\n/**\n * 文字相关\n */\n/**\n * 一行文字\n */\n/* stylelint-disable */\n/**\n * [commonClearfix 清除浮动]\n * @return {[type]} [description]\n */\n/* Var\n -------------------------- */\n/* Func\n -------------------------- */\n/* Mix\n -------------------------- */\n/**\n * @param $root: 默认置顶\n */\n/**\n * 1. +, >, ~, ' '\n * 2. 同element\n * 3. 同modifier\n * 4. 同block\n */\n/**\n * -> [className].is_require \n * 与xxx:hover类似\n */\n/**\n * 用 @at-root 来重置 & 读取次数的计数\n * 如 [clsssName] [className]:hover\n */\n/**\n * 自定义规则\n */\n/**\n * TODO: 使用vc-scroller;\n */\n.vm-combo {\n  display: flex;\n}\n\n/*# sourceMappingURL=combo.vue.map */","<template>\n\t<div :style=\"style\" :class=\"classes\" class=\"vm-combo\">\n\t\t<vm-widget \n\t\t\tv-if=\"showWidget\"\n\t\t\t:style=\"widgetStyle\" \n\t\t\t:content-style=\"widgetContentStyle\" \n\t\t\t:theme=\"theme\"\n\t\t\tv-bind=\"widgetOpts\"\n\t\t\t@change=\"handleWidgetChange\"\n\t\t/>\n\t\t<vm-frame \n\t\t\tref=\"frame\"\n\t\t\t:frame-style=\"frameStyle\" \n\t\t\t:width=\"rebuildFrameW\" \n\t\t\t:height=\"rebuildFrameH\" \n\t\t\t:data-source=\"rebuildData\" \n\t\t\t:editor=\"editor\" \n\t\t\t:show-lines=\"showLines\"\n\t\t\t:show-ruler=\"showRuler\"\n\t\t\t:show-zoom-bar=\"showZoomBar\"\n\t\t\t:show-thumbnail=\"showThumbnail\"\n\t\t\t:theme=\"theme\"\n\t\t\tv-bind=\"frameOpts\"\n\t\t\t@activated=\"handleActivated\"\n\t\t\t@deactivated=\"handleDeactivated\"\n\t\t\t@change=\"handleChange\"\n\t\t\t@sort-end=\"$emit('sort-end', arguments[0], arguments[1])\"\n\t\t\t@error=\"$emit('error', arguments[0])\"\n\t\t>\n\t\t\t<template #frame-header>\n\t\t\t\t<slot name=\"frame-header\" />\n\t\t\t</template>\n\t\t\t<template #frame-footer>\n\t\t\t\t<slot name=\"frame-footer\" />\n\t\t\t</template>\n\t\t</vm-frame>\n\t\t\x3c!-- v-show主要用于没有页面设置 --\x3e\n\t\t<vm-editor \n\t\t\tv-if=\"showEditor\"\n\t\t\t:value=\"editor\"\n\t\t\t:style=\"editorStyle\"\n\t\t\t:width=\"editorW\"\n\t\t\t:height=\"editorH\"\n\t\t\tv-bind=\"editorOpts\"\n\t\t\t@change=\"handleChange\"\n\t\t/>\n\t</div>\n</template>\n\n<script>\nimport { Store, mapStates } from './store';\nimport { Assist } from './assist';\nimport { cloneDeep, isEqualWith, getUid, Logger } from '../utils/helper';\nimport { PAGE_MOULE, SELECTION_MODULE } from '../utils/constants';\nimport './theme-dark.scss';\n\nexport default {\n\tname: 'vm-combo',\n\tprovide() {\n\t\treturn {\n\t\t\tgetVM: () => this,\n\t\t\tgetData: () => this.dataSource\n\t\t};\n\t},\n\tcomponents: {\n\t\t// 会被注入vm-frame, vm-widget, vm-editor,\n\t},\n\tmixins: Assist.mixins(['keyboard']),\n\tmodel: {\n\t\tprop: 'data-source',\n\t\tevent: 'change'\n\t},\n\tprops: {\n\t\twidth: Number,\n\t\theight: Number,\n\t\tdataSource: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => ([])\n\t\t},\n\t\t/**\n\t\t * frame\n\t\t */\n\t\tframeStyle: Object,\n\t\tframeW: Number,\n\t\tframeH: Number,\n\t\tframeOpts: Object,\n\t\t/**\n\t\t * widget\n\t\t */\n\t\twidgetStyle: Object,\n\t\twidgetContentStyle: Object,\n\t\twidgetW: Number,\n\t\twidgetH: Number,\n\t\twidgetOpts: Object,\n\n\t\t/**\n\t\t * widget\n\t\t */\n\t\teditorStyle: Object,\n\t\teditorW: Number,\n\t\teditorH: Number,\n\t\teditorOpts: Object,\n\n\t\t/**\n\t\t * combo\n\t\t */\n\t\ttheme: {\n\t\t\ttype: String,\n\t\t\tdefault: 'default' // default / light / dark\n\t\t},\n\t\tshowWidget: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t},\n\t\tshowEditor: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t},\n\t\tshowLines: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t},\n\t\tshowRuler: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t},\n\t\tshowZoomBar: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t},\n\t\tshowThumbnail: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t},\n\t},\n\tdata() {\n\t\t// beforeCreate中无法获取props的值，created中会导致watch中immediate无效;\n\t\tthis.store = new Store(this, {\n\t\t\tframeW: this.frameW,\n\t\t\tframeH: this.frameH,\n\t\t});\n\t\treturn {};\n\t},\n\tcomputed: {\n\t\tstyle() {\n\t\t\tconst w = !this.width ? 'auto' : `${this.width}px`;\n\t\t\tconst h = !this.height ? 'auto' : `${this.height}px`;\n\n\t\t\treturn {\n\t\t\t\twidth: w,\n\t\t\t\theight: h\n\t\t\t};\n\t\t},\n\n\t\tclasses() {\n\t\t\treturn {\n\t\t\t\t'vm-combo__theme--dark': this.theme === 'dark'\n\t\t\t};\n\t\t},\n\n\t\t...mapStates({\n\t\t\trebuildData: 'data',\n\t\t\trebuildFrameW: 'frameW',\n\t\t\trebuildFrameH: 'frameH',\n\t\t\tcurrent: 'currentSnapshot',\n\t\t\ttotal: 'totalSnapshot',\n\t\t\teditor: 'currentEditor',\n\t\t\tpageEditor: 'pageEditor',\n\t\t})\n\t},\n\twatch: {\n\t\tdataSource: {\n\t\t\tdeep: true,\n\t\t\timmediate: true,\n\t\t\thandler(v) {\n\t\t\t\tthis.store.commit('INIT', v);\n\t\t\t}\n\t\t}\n\t},\n\tcreated() {\n\t\tthis.VMComboId = getUid('combo');\n\t\tthis.clipboardData = null;\n\t\t\n\t\t// 处理历史暴露的API映射\n\t\tthis.create = this.add;\n\t\tthis.delete = this.remove;\n\t},\n\tdestroyed() {\n\t\tthis.$options.previewManager.destroy();\n\t},\n\tmethods: {\n\t\tsyncData() {\n\t\t\tthis.$emit('change', this.rebuildData);\n\t\t\tthis.$emit('update:data-source', this.rebuildData);\n\t\t},\n\n\t\t/**\n\t\t * draggable\n\t\t */\n\t\thandleActivated(e, it) {\n\t\t\tthis.store.resetCurrentEditor(it);\n\t\t},\n\n\t\thandleDeactivated(e, it) {\n\t\t\tthis.store.resetCurrentEditor();\n\t\t},\n\n\t\t/**\n\t\t * 用户处理widget出来的数据\n\t\t * TODO: 支持记忆片段\n\t\t */\n\t\thandleWidgetChange(module, ...rest) {\n\t\t\tthis.$emit('widget-change', module, ...rest);\n\t\t},\n\n\t\t/**\n\t\t * 数据变化\n\t\t */\n\t\thandleChange({ type, ...payload }) {\n\t\t\tconst { id, original, changed, revert } = payload; \n\t\t\tswitch (type) {\n\t\t\t\tcase 'CREATE':\n\t\t\t\tcase 'UPDATE': // eslint-disable-line\n\t\t\t\tcase 'DELETE':\n\t\t\t\t\tif (!id) {\n\t\t\t\t\t\tthrow new Error('[wya-vm/combo]: id 必传');\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'SORT':\n\t\t\t\t\tif (!original && !changed) {\n\t\t\t\t\t\tthrow new Error('[wya-vm/combo]: original/changed 必传');\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'DUMMY':\n\t\t\t\t\tif (typeof revert === 'undefined') {\n\t\t\t\t\t\tthrow new Error('[wya-vm/combo]: revert 不能为undefined');\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tthis.store.commit(type, payload);\n\t\t\tthis.syncData();\n\t\t},\n\n\t\t/**\n\t\t * 模拟添加\n\t\t */\n\t\tadd(module, index) {\n\t\t\tthis.$refs.frame.handleDrop({\n\t\t\t\tfake: true,\n\t\t\t\tdataTransfer: {\n\t\t\t\t\tgetData: () => {\n\t\t\t\t\t\treturn JSON.stringify({\n\t\t\t\t\t\t\tmodule,\n\t\t\t\t\t\t\tindex\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, true);\n\t\t\tthis.syncData();\n\t\t},\n\n\t\t/**\n\t\t * 删除\n\t\t * it: id | data, 可传id或者data\n\t\t * force: 默认是当前编辑的删除，除非强制删除id\n\t\t */\n\t\tremove(it, force = false) {\n\t\t\tlet isObj = typeof it === 'object';\n\t\t\tlet id = (isObj ? it.id : it) || (this.editor || {}).id;\n\t\t\tif (!id || (!force && this.editor.module === PAGE_MOULE)) {\n\t\t\t\tthis.$emit('error', { \n\t\t\t\t\ttype: 'id', \n\t\t\t\t\tmsg: \"请先选择操作对象\" \n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tit = isObj \n\t\t\t\t? it\n\t\t\t\t: this.rebuildData.findIndex(i => i.id === id);\n\n\t\t\tthis.store.commit('DELETE', { \n\t\t\t\tid,\n\t\t\t\trevert: it.selections && it.selections.length\n\t\t\t});\n\n\t\t\tif (it.module === SELECTION_MODULE) {\n\t\t\t\tit.selections.forEach(($id) => {\n\t\t\t\t\tthis.store.commit('DELETE', { \n\t\t\t\t\t\tid: $id,\n\t\t\t\t\t\trevert: it.selections && it.selections.length,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.syncData();\n\t\t},\n\n\t\t/**\n\t\t * 剪切一份\n\t\t */\n\t\tcut() {\n\t\t\tif (\n\t\t\t\t!this.editor \n\t\t\t\t|| this.editor.module === PAGE_MOULE \n\t\t\t\t|| this.editor.module === SELECTION_MODULE\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t} \n\n\t\t\t// 粘帖数据缓存\n\t\t\tthis.clipboardData = {\n\t\t\t\ttype: 'CUT',\n\t\t\t\tdata: cloneDeep(this.editor),\n\t\t\t\tselections: this.editor.module === SELECTION_MODULE \n\t\t\t\t\t? cloneDeep(this.rebuildData.filter(i => this.editor.selections.includes(i.id)))\n\t\t\t\t\t: []\n\t\t\t};\n\n\t\t\t// 删除剪切数据\n\t\t\tconst revert = this.clipboardData.selections.length;\n\t\t\tthis.store.commit('DELETE', { \n\t\t\t\tid: this.editor.id,\n\t\t\t\trevert\n\t\t\t});\n\t\t\tthis.clipboardData.selections.forEach((id) => {\n\t\t\t\tthis.store.commit('DELETE', { \n\t\t\t\t\tid,\n\t\t\t\t\trevert\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.syncData();\n\t\t},\n\n\t\t/**\n\t\t * 复制一份\n\t\t */\n\t\tcopy(it) {\n\t\t\tif (\n\t\t\t\t!it && (\n\t\t\t\t\t!this.editor \n\t\t\t\t\t|| this.editor.module === PAGE_MOULE \n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t} \n\n\t\t\tit = it || this.editor;\n\t\t\tthis.clipboardData = {\n\t\t\t\ttype: 'COPY',\n\t\t\t\tdata: cloneDeep(it),\n\t\t\t\tselections: this.editor.module === SELECTION_MODULE \n\t\t\t\t\t? cloneDeep(this.rebuildData.filter(i => it.selections.includes(i.id)))\n\t\t\t\t\t: []\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * 粘帖一份\n\t\t * 这里兼容了组合，其中包含x,y的偏移值\n\t\t */\n\t\tpaste(override = {}) {\n\t\t\tif (!this.clipboardData) return;\n\t\t\tlet { type, data, selections = [] } = this.clipboardData;\n\t\t\tconst rowIndex = this.rebuildData.length;\n\t\t\tconst revert = selections.length;\n\t\t\tconst id = getUid();\n\n\t\t\tlet changed = cloneDeep(data);\n\t\t\tchanged.x && (changed.x += 10);\n\t\t\tchanged.y && (changed.y += 10);\n\t\t\tObject.keys(override).forEach(key => (changed[key] = override[key]));\n\n\t\t\tchanged.id = id;\n\t\t\tif (changed.module === SELECTION_MODULE) {\n\t\t\t\tselections = selections.map(i => {\n\t\t\t\t\ti.id = getUid();\n\t\t\t\t\treturn i;\n\t\t\t\t});\n\t\t\t\tchanged.selections = selections.map(i => i.id);\n\n\t\t\t\tconst diffX = changed.x - data.x;\n\t\t\t\tconst diffY = changed.y - data.y;\n\n\t\t\t\tselections.forEach((it, index) => {\n\t\t\t\t\tthis.store.commit('CREATE', { \n\t\t\t\t\t\tindex: rowIndex + index,\n\t\t\t\t\t\tid: it.id,\n\t\t\t\t\t\trevert,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t...it,\n\t\t\t\t\t\t\tx: it.x + diffX,\n\t\t\t\t\t\t\ty: it.y + diffY\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.store.commit('CREATE', {\n\t\t\t\tindex: rowIndex + revert,\n\t\t\t\tid,\n\t\t\t\tdata: changed,\n\t\t\t\trevert\n\t\t\t});\n\t\t\tthis.syncData();\n\n\t\t\t// 激活\n\t\t\tthis.$refs.frame.setActivedById(id);\n\t\t},\n\n\t\t/**\n\t\t * 撤回\n\t\t */\n\t\tundo() {\n\t\t\tlet current = this.current - 1;\n\t\t\tif (current < 0) {\n\t\t\t\tthis.$emit('error', { \n\t\t\t\t\ttype: 'undo', \n\t\t\t\t\tmsg: \"目前已经是初始状态\" \n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// 需要连续回滚\n\t\t\tlet { revert } = this.store.historyData[current] || {};\n\n\t\t\tthis.store.commit('UNDO', { current });\n\n\t\t\tif (revert) {\n\t\t\t\tArray.from({ length: revert }).forEach(() => {\n\t\t\t\t\tthis.store.commit('UNDO', { current: this.current - 1 });\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tLogger.debug(`current: ${this.current}, total: ${this.total}`);\n\t\t\tthis.syncData();\n\t\t},\n\n\t\t/**\n\t\t * 取消撤回\n\t\t */\n\t\tredo() {\n\t\t\tlet current = this.current + 1;\n\t\t\tif (current > this.total) {\n\t\t\t\tthis.$emit('error', { \n\t\t\t\t\ttype: 'undo', \n\t\t\t\t\tmsg: \"目前已经是最终状态\" \n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// 需要连续回滚\n\t\t\tlet { revert } = this.store.historyData[current] || {};\n\n\t\t\tthis.store.commit('REDO', { current });\n\t\t\tif (revert) {\n\t\t\t\tArray.from({ length: revert }).forEach(() => {\n\t\t\t\t\tthis.store.commit('REDO', { current: this.current + 1 });\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tLogger.debug(`current: ${this.current}, total: ${this.total}`);\n\t\t\tthis.syncData();\n\t\t},\n\n\t\t/**\n\t\t * widget-save\n\t\t */\n\t\tsave() {\n\t\t\tconst data = cloneDeep(this.rebuildData) || [];\n\n\t\t\tif (data.length === 0) {\n\t\t\t\tthis.$emit('error', { \n\t\t\t\t\ttype: 'save', \n\t\t\t\t\tmsg: `保存对象不能为空` \n\t\t\t\t});\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst { modules } = this.$options;\n\t\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\t\tlet { module: mod } = data[i];\n\t\t\t\tif (modules[mod].dataValidity) {\n\t\t\t\t\tlet error = modules[mod].dataValidity(data[i]);\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tlet msg = error.msg || error.message || error.error || error; // 兼容验证器使用\n\t\t\t\t\t\tthis.$emit('error', { \n\t\t\t\t\t\t\ttype: 'save', \n\t\t\t\t\t\t\tmsg: `第${i + 1}个 - ${msg}`, \n\t\t\t\t\t\t\tindex: i \n\t\t\t\t\t\t});\n\t\t\t\t\t\t// 错误元素激活\n\t\t\t\t\t\tthis.$refs.frame.setActived(i);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t/**\n\t\t\t * 数据验证\n\t\t\t */\n\t\t\tthis.$emit('save', data);\n\t\t\treturn true;\n\t\t},\n\n\t\tgetImage(opts = {}) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis.$options.previewManager.popup({\n\t\t\t\t\tdataSource: cloneDeep(this.rebuildData),\n\t\t\t\t\tstyles: {\n\t\t\t\t\t\t...this.frameStyle,\n\t\t\t\t\t\twidth: this.rebuildFrameW === 0 ? 'auto' : `${this.rebuildFrameW}px`,\n\t\t\t\t\t\theight: this.rebuildFrameH === 0 ? 'auto' : `${this.rebuildFrameH}px`\n\t\t\t\t\t},\n\t\t\t\t\tclassName: 'vm-combo__frame',\n\n\t\t\t\t\texpect: 'image',\n\t\t\t\t\timageOpts: opts,\n\t\t\t\t\tonSure: resolve,\n\t\t\t\t\tonClose: reject,\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\tpreview() {\n\t\t\tif (this.rebuildData.length === 0) {\n\t\t\t\tthis.$emit('error', { \n\t\t\t\t\ttype: 'preview', \n\t\t\t\t\tmsg: `预览数据对象不能为空` \n\t\t\t\t});\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.$options.previewManager.popup({\n\t\t\t\tdataSource: cloneDeep(this.rebuildData),\n\t\t\t\tstyles: {\n\t\t\t\t\t...this.frameStyle,\n\t\t\t\t\twidth: this.rebuildFrameW === 0 ? 'auto' : `${this.rebuildFrameW}px`,\n\t\t\t\t\theight: this.rebuildFrameH === 0 ? 'auto' : `${this.rebuildFrameH}px`\n\t\t\t\t},\n\t\t\t\tclassName: 'vm-combo__frame'\n\t\t\t});\n\n\t\t\treturn true;\n\t\t},\n\n\t\tdownload() {\n\t\t\tconst content = JSON.stringify(this.dataSource, null, '\\t');\n\t\t\tconst blob = new Blob([content], {\n\t\t\t\ttype: 'application/json;charset=UTF-8'\n\t\t\t});\n\n\t\t\tconst url = URL.createObjectURL(blob);\n\t\t\tconst link = document.createElement('a');\n\t\t\tlink.textContent = 'download json';\n\t\t\tlink.href = url;\n\t\t\tlink.download = 'data'; // moment().format('YYYY-MM-DD')\n\t\t\tlink.click();\n\n\t\t\tURL.revokeObjectURL(url);\n\t\t},\n\n\t\tupload() {\n\t\t\tconst input = document.createElement('input');\n\t\t\tinput.type = 'file';\n\t\t\t// 限定文件类型\n\t\t\tinput.accept = '.json';\n\t\t\tinput.click();\n\n\t\t\tinput.onchange = () => {\n\t\t\t\tconst file = input.files[0];\n\n\t\t\t\t// FileReader实例\n\t\t\t\tconst reader = new FileReader();\n\t\t\t\treader.readAsText(file, 'UTF-8');\n\t\t\t\treader.onload = e => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlet v = JSON.parse(e.target.result);\n\t\t\t\t\t\tthis.store.commit('INIT', v);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t};\n\t\t}\n\t},\n};\n<\/script>\n\n<style lang=\"scss\">\n@import \"../style/index.scss\";\n\n.vm-combo {\n\tdisplay: flex;\n}\n</style>\n"]},media:void 0})}),bn,void 0,!1,void 0,!1,yt,void 0,void 0),En={name:"vm-grid-lines",components:{},props:{width:Number,height:Number,grid:{type:Array,default:function(){return[10,10]}}},data:function(){return{}},computed:{xArr:function(){var t=this,n=Math.floor(this.width/this.grid[0]);return Array.from({length:n},(function(n,e){return e*t.grid[0]}))},yArr:function(){var t=this,n=Math.floor(this.height/this.grid[1]);return Array.from({length:n},(function(n,e){return e*t.grid[1]}))}},watch:{},created:function(){},methods:{}},yn=function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"vm-grid-lines"},[this._l(this.yArr,(function(t){return n("div",{key:"y_"+t,staticClass:"vm-grid-lines__y",style:{top:t+"px"}})})),this._v(" "),this._l(this.xArr,(function(t){return n("div",{key:"x_"+t,staticClass:"vm-grid-lines__x",style:{left:t+"px"}})}))],2)};yn._withStripped=!0;var wn=vt({render:yn,staticRenderFns:[]},(function(t){t&&t("data-v-02acb640_0",{source:".vm-grid-lines {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  z-index: 0;\n}\n.vm-grid-lines__x {\n  position: absolute;\n  left: 0;\n  width: 1px;\n  height: 100%;\n  border-left-width: 1px;\n  border-left-style: dotted;\n  border-left-color: #d6d6d6;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.vm-grid-lines__y {\n  position: absolute;\n  top: 0;\n  width: 100%;\n  height: 1px;\n  border-top-width: 1px;\n  border-top-style: dotted;\n  border-top-color: #d6d6d6;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n\n/*# sourceMappingURL=grid-lines.vue.map */",map:{version:3,sources:["/Users/deot/Desktop/wya/github/wya-vm/src/combo/frame/draggable/grid-lines.vue","grid-lines.vue"],names:[],mappings:"AA4DA;EACA,kBAAA;EACA,MAAA;EACA,OAAA;EACA,WAAA;EACA,YAAA;EACA,gBAAA;EACA,UAAA;AC3DA;AD6DA;EACA,kBAAA;EACA,OAAA;EACA,UAAA;EACA,YAAA;EACA,sBAAA;EACA,yBAAA;EACA,0BAAA;EACA,8BAAA;UAAA,sBAAA;AC1DA;AD4DA;EACA,kBAAA;EACA,MAAA;EACA,WAAA;EACA,WAAA;EACA,qBAAA;EACA,wBAAA;EACA,yBAAA;EACA,8BAAA;UAAA,sBAAA;ACzDA;;AAEA,yCAAyC",file:"grid-lines.vue",sourcesContent:['<template>\n\t<div class="vm-grid-lines">\n\t\t<div \n\t\t\tv-for="item in yArr" \n\t\t\t:key="`y_${item}`" \n\t\t\t:style="{top: `${item}px`}"  \n\t\t\tclass="vm-grid-lines__y"\n\t\t/>\n\t\t<div \n\t\t\tv-for="item in xArr" \n\t\t\t:key="`x_${item}`" \n\t\t\t:style="{left: `${item}px`}"  \n\t\t\tclass="vm-grid-lines__x"\n\t\t/>\n\t</div>\n</template>\n\n<script>\nexport default {\n\tname: \'vm-grid-lines\',\n\tcomponents: {\n\n\t},\n\tprops: {\n\t\twidth: Number,\n\t\theight: Number,\n\t\tgrid: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => {\n\t\t\t\treturn [10, 10];\n\t\t\t}\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t};\n\t},\n\tcomputed: {\n\t\txArr() {\n\t\t\tlet length = Math.floor(this.width / this.grid[0]);\n\t\t\treturn Array.from({ length }, (v, i) => i * this.grid[0]);\n\t\t},\n\t\tyArr() {\n\t\t\tlet length = Math.floor(this.height / this.grid[1]);\n\t\t\treturn Array.from({ length }, (v, i) => i * this.grid[1]);\n\t\t}\n\t},\n\twatch: {\n\t\t\n\t},\n\tcreated() {\n\t\t\n\t},\n\tmethods: {\n\n\t},\n};\n<\/script>\n\n<style lang="scss">\n.vm-grid-lines {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\toverflow: hidden;\n\tz-index: 0;\n}\n.vm-grid-lines__x {\n\tposition: absolute;\n\tleft: 0;\n\twidth: 1px;\n\theight: 100%;\n\tborder-left-width: 1px;\n\tborder-left-style: dotted;\n\tborder-left-color: rgb(214, 214, 214);\n\tbox-sizing: border-box;\n}\n.vm-grid-lines__y {\n\tposition: absolute;\n\ttop: 0;\n\twidth: 100%;\n\theight: 1px;\n\tborder-top-width: 1px;\n\tborder-top-style: dotted;\n\tborder-top-color: rgb(214, 214, 214); \n\tbox-sizing: border-box;\n}\n</style>\n',".vm-grid-lines {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  z-index: 0;\n}\n\n.vm-grid-lines__x {\n  position: absolute;\n  left: 0;\n  width: 1px;\n  height: 100%;\n  border-left-width: 1px;\n  border-left-style: dotted;\n  border-left-color: #d6d6d6;\n  box-sizing: border-box;\n}\n\n.vm-grid-lines__y {\n  position: absolute;\n  top: 0;\n  width: 100%;\n  height: 1px;\n  border-top-width: 1px;\n  border-top-style: dotted;\n  border-top-color: #d6d6d6;\n  box-sizing: border-box;\n}\n\n/*# sourceMappingURL=grid-lines.vue.map */"]},media:void 0})}),En,void 0,!1,void 0,!1,yt,void 0,void 0),Cn={name:"vm-align-lines",components:{},props:{dataSource:{type:Array,default:function(){return[]}},editor:Object},data:function(){return{}},computed:{alignData:function(){var t=this;if(this.dataSource.length<=1||!this.editor)return{xArr:[],yArr:[]};var n=this.editor||{},e=n.x,i=n.y,r=n.w,o=n.h,a=[e,e+r/2,e+r],s=[i,i+o/2,i+o],l=this.dataSource.reduce((function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.x,r=e.y,o=e.w,a=e.h,s=e.id;if(s!==t.editor.id){var l=[i,i+o/2,i+o],d=[r,r+a/2,r+a];n.xArr=[].concat(J.default(n.xArr),l),n.yArr=[].concat(J.default(n.yArr),d)}return n}),{xArr:[],yArr:[]});return{xArr:a.filter((function(t){return l.xArr.includes(t)})),yArr:s.filter((function(t){return l.yArr.includes(t)}))}}},watch:{},created:function(){},methods:{}},_n=function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"vm-align-lines"},[this._l(this.alignData.yArr,(function(t){return n("div",{key:"y_"+t,staticClass:"vm-align-lines__y",style:{top:t+"px"}})})),this._v(" "),this._l(this.alignData.xArr,(function(t){return n("div",{key:"x_"+t,staticClass:"vm-align-lines__x",style:{left:t+"px"}})}))],2)};_n._withStripped=!0;var $n=vt({render:_n,staticRenderFns:[]},(function(t){t&&t("data-v-1c8b90fd_0",{source:".vm-align-lines {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  z-index: 0;\n}\n.vm-align-lines__x {\n  position: absolute;\n  left: 0;\n  width: 1px;\n  height: 100%;\n  border-left-width: 1px;\n  border-left-style: dotted;\n  border-left-color: #1fb6ff;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.vm-align-lines__y {\n  position: absolute;\n  top: 0;\n  width: 100%;\n  height: 1px;\n  border-top-width: 1px;\n  border-top-style: dotted;\n  border-top-color: #1fb6ff;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n\n/*# sourceMappingURL=align-lines.vue.map */",map:{version:3,sources:["/Users/deot/Desktop/wya/github/wya-vm/src/combo/frame/draggable/align-lines.vue","align-lines.vue"],names:[],mappings:"AA+EA;EACA,kBAAA;EACA,MAAA;EACA,OAAA;EACA,WAAA;EACA,YAAA;EACA,gBAAA;EACA,UAAA;AC9EA;ADgFA;EACA,kBAAA;EACA,OAAA;EACA,UAAA;EACA,YAAA;EACA,sBAAA;EACA,yBAAA;EACA,0BAAA;EACA,8BAAA;UAAA,sBAAA;AC7EA;AD+EA;EACA,kBAAA;EACA,MAAA;EACA,WAAA;EACA,WAAA;EACA,qBAAA;EACA,wBAAA;EACA,yBAAA;EACA,8BAAA;UAAA,sBAAA;AC5EA;;AAEA,0CAA0C",file:"align-lines.vue",sourcesContent:['<template>\n\t<div class="vm-align-lines">\n\t\t<div \n\t\t\tv-for="item in alignData.yArr" \n\t\t\t:key="`y_${item}`" \n\t\t\t:style="{top: `${item}px`}"  \n\t\t\tclass="vm-align-lines__y"\n\t\t/>\n\t\t<div \n\t\t\tv-for="item in alignData.xArr" \n\t\t\t:key="`x_${item}`" \n\t\t\t:style="{left: `${item}px`}"  \n\t\t\tclass="vm-align-lines__x"\n\t\t/>\n\t</div>\n</template>\n\n<script>\nexport default {\n\tname: \'vm-align-lines\',\n\tcomponents: {\n\n\t},\n\tprops: {\n\t\tdataSource: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => ([])\n\t\t},\n\t\teditor: Object\n\t},\n\tdata() {\n\t\treturn {\n\t\t};\n\t},\n\tcomputed: {\n\t\talignData() {\n\t\t\tif (this.dataSource.length <= 1 || !this.editor) {\n\t\t\t\treturn {\n\t\t\t\t\txArr: [],\n\t\t\t\t\tyArr: []\n\t\t\t\t};\n\t\t\t}\n\t\t\tconst { x, y, w, h } = this.editor || {};\n\t\t\tlet xArr = [x, x + w / 2, x + w];\n\t\t\tlet yArr = [y, y + h / 2, y + h];\n\n\t\t\tlet xyObj = this.dataSource.reduce((result, itemData = {}) => {\n\n\t\t\t\tconst { x, y, w, h, id } = itemData;\n\t\t\t\tif (id !== this.editor.id) {\n\t\t\t\t\tlet xArr = [x, x + w / 2, x + w];\n\t\t\t\t\tlet yArr = [y, y + h / 2, y + h];\n\t\t\t\t\tresult.xArr = [...result.xArr, ...xArr];\n\t\t\t\t\tresult.yArr = [...result.yArr, ...yArr];\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t}, {\n\t\t\t\txArr: [],\n\t\t\t\tyArr: []\n\t\t\t});\n\t\t\treturn {\n\t\t\t\txArr: xArr.filter(item => xyObj.xArr.includes(item)),\n\t\t\t\tyArr: yArr.filter(item => xyObj.yArr.includes(item))\n\t\t\t};\n\t\t}\n\t},\n\twatch: {\n\t\t\n\t},\n\tcreated() {\n\t\t\n\t},\n\tmethods: {\n\n\t},\n};\n<\/script>\n\n<style lang="scss">\n.vm-align-lines {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\toverflow: hidden;\n\tz-index: 0;\n}\n.vm-align-lines__x {\n\tposition: absolute;\n\tleft: 0;\n\twidth: 1px;\n\theight: 100%;\n\tborder-left-width: 1px;\n\tborder-left-style: dotted;\n\tborder-left-color: #1fb6ff;\n\tbox-sizing: border-box;\n}\n.vm-align-lines__y {\n\tposition: absolute;\n\ttop: 0;\n\twidth: 100%;\n\theight: 1px;\n\tborder-top-width: 1px;\n\tborder-top-style: dotted;\n\tborder-top-color: #1fb6ff; \n\tbox-sizing: border-box;\n}\n</style>\n',".vm-align-lines {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  z-index: 0;\n}\n\n.vm-align-lines__x {\n  position: absolute;\n  left: 0;\n  width: 1px;\n  height: 100%;\n  border-left-width: 1px;\n  border-left-style: dotted;\n  border-left-color: #1fb6ff;\n  box-sizing: border-box;\n}\n\n.vm-align-lines__y {\n  position: absolute;\n  top: 0;\n  width: 100%;\n  height: 1px;\n  border-top-width: 1px;\n  border-top-style: dotted;\n  border-top-color: #1fb6ff;\n  box-sizing: border-box;\n}\n\n/*# sourceMappingURL=align-lines.vue.map */"]},media:void 0})}),Cn,void 0,!1,void 0,!1,yt,void 0,void 0),kn={name:"vm-ruler",components:{},props:{scrollTop:{type:Number,default:0},scrollLeft:{type:Number,default:0},frameW:{type:Number,default:0},frameH:{type:Number,default:0},clientW:{type:Number,default:0},clientH:{type:Number,default:0},scale:{type:Number,default:1},guides:Array,theme:String,borderSize:{type:Object,default:function(){return{top:0,left:0,bottom:0,right:0}}},scrollerSize:{type:Number,default:0}},data:function(){return{guideSize:20,showGuide:!0,showGuideX:!1,showGuideY:!1,mouseX:0,mouseY:0,offsetX:0,offsetY:0,linesX:[],linesY:[],movingAxias:"",movingIndex:-1}},computed:{canvasW:function(){var t=this.frameW,n=this.frameH,e=this.scale,i=this.borderSize,r=this.guideSize,o=this.clientW,a=this.clientH;this.scrollTop,this.scrollLeft;var s=this.scrollerSize,l=i.left+i.right+r,d=i.top+i.bottom+r;return s+Math.max(5e3,t*e+l,n*e+d,o,a)},placeholderW:function(){return this.borderSize.left+this.guideSize},interval:function(){var t=this.scale,n=100;if(t<=0)return n;for(;n*t<60;)n+=50;for(;n*t>100;)n-=n-20>=0?20:10;return n*t},isDark:function(){return"dark"===this.theme}},watch:{linesX:{deep:!0,handler:function(){this.$emit("guides-change",[this.linesX,this.linesY])}},linesY:{deep:!0,handler:function(){this.$emit("guides-change",[this.linesX,this.linesY])}}},created:function(){var t=this,n=o.debounce(this.refreshCanvas,50);["frameW","frameH","scale","clientW","clientH","theme"].forEach((function(e){return t.$watch(e,n)}))},mounted:function(){var t=this;setTimeout((function(){t.canvas=[t.$refs.canvasX,t.$refs.canvasY],t.offsetX=t.$refs.x.getBoundingClientRect().x,t.offsetY=t.$refs.y.getBoundingClientRect().y,t.refreshCanvas()}),300)},destroyed:function(){this.operateDOMEvents("remove")},methods:{refreshCanvas:function(){var t=this;this.canvas&&this.canvas.forEach((function(n){return t.repaint(n)}))},repaint:function(t){if(this._isMounted&&t){var n=this.canvasW,e=this.guideSize,i=this.placeholderW,r=this.interval,o=this.isDark,a=t.getContext("2d");t.height=t.height,a.beginPath(),a.fillStyle=o?"#474747":"#FAFAFA",a.fillRect(0,0,n,e),a.translate(i,0),a.fillStyle=o?"#615E5B":"#000",a.save();for(var s=0;s<n/r;s++)a.fillStyle=o?"#615E5B":"#000",a.translate(s*r,0),a.fillRect(0,0,1,e),a.restore(),a.save(),a.fillStyle="#8C8D89",a.font="12px",a.fillText((s*r/this.scale).toFixed(0),s*r+4,e/5*3);a.restore(),a.translate(0,e-3),a.save();for(var l=0;l<n/r*10;l++)l%10!=0&&(a.translate(l*r/10,0),a.fillRect(0,0,1,3),a.restore(),a.save())}},handleShowGuideX:function(t){var n=this.offsetX,e=this.placeholderW,i=this.scrollLeft,r=this.scale;this.$refs.x.contains(t.target)&&!a.$(t.target).hasClass("is-solid")?(this.showGuideX=!0,this.mouseX=Math.floor((t.clientX-n-e+i)/r)):this.showGuideX=!1},handleShowGuideY:function(t){var n=this.offsetY,e=this.placeholderW,i=this.scrollTop,r=this.scale;this.$refs.y.contains(t.target)&&!a.$(t.target).hasClass("is-solid")?(this.showGuideY=!0,this.mouseY=Math.floor((t.clientY-n-e+i)/r)):this.showGuideY=!1},handleAddLineX:function(){!this.linesX.includes(this.mouseX)&&this.linesX.push(this.mouseX)},handleAddLineY:function(){!this.linesY.includes(this.mouseY)&&this.linesY.push(this.mouseY)},operateDOMEvents:function(t){var n="add"===t?document.documentElement.addEventListener:document.documentElement.removeEventListener;n("mouseup",this.handleMouseUp),n("mousemove",this.handleMouseMove)},handleMouseDown:function(t,n){G.default.clearSelection(),this.movingIndex=n,this.movingAxias=t,this.operateDOMEvents("add")},handleMouseUp:function(){G.default.clearSelection(),this.operateDOMEvents("remove")},handleMouseMove:function(t){var n=this.offsetX,e=this.offsetY,i=this.placeholderW,r=this.scrollLeft,o=this.scrollTop,a=this.scale;"x"!==this.movingAxias?"y"!==this.movingAxias||this.$set(this.linesY,this.movingIndex,Math.floor((t.clientY-e-i+o)/a)):this.$set(this.linesX,this.movingIndex,Math.floor((t.clientX-n-i+r)/a))}}},Bn=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"vm-ruler",class:{"is-dark":t.isDark}},[e("div",{staticClass:"vm-ruler__guide",style:{width:t.guideSize+"px",height:t.guideSize+"px"},attrs:{title:"单击"+(t.showGuide?"隐藏":"显示")+"辅助线"},on:{click:function(n){t.showGuide=!t.showGuide}}}),t._v(" "),e("div",{ref:"x",staticClass:"vm-ruler__x",style:{transform:"translateX("+-t.scrollLeft+"px)"},on:{mousemove:t.handleShowGuideX,mouseleave:function(n){t.showGuideX=!1}}},[e("canvas",{ref:"canvasX",staticClass:"vm-ruler__canvas",attrs:{width:t.canvasW,height:t.guideSize}}),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showGuideX,expression:"showGuideX"}],ref:"guideX",staticClass:"vm-ruler__guide-x",style:{left:t.mouseX*t.scale+t.placeholderW+"px"},on:{click:function(n){return n.stopPropagation(),t.handleAddLineX.apply(null,arguments)}}},[e("span",[t._v("\n\t\t\t\t"+t._s(t.mouseX)+"\n\t\t\t")])]),t._v(" "),t.showGuide?t._l(t.linesX,(function(n,i){return e("div",{key:i,staticClass:"vm-ruler__guide-x is-solid",style:{left:n*t.scale+t.placeholderW+"px"},attrs:{title:"双击删除参考线"},on:{mousedown:function(n){return n.stopPropagation(),t.handleMouseDown("x",i)},dblclick:function(n){return t.linesX.splice(i,1)}}},[e("span",[t._v("\n\t\t\t\t\t"+t._s(n)+"\n\t\t\t\t")])])})):t._e()],2),t._v(" "),e("div",{staticClass:"vm-ruler__wrapper",style:{height:"calc(100% - "+t.guideSize+"px)"}},[e("div",{staticClass:"vm-ruler__y"},[e("div",{ref:"y",staticClass:"vm-ruler__y-rotate",style:{transform:"rotate(90deg) translateX("+-t.scrollTop+"px)"},on:{mousemove:t.handleShowGuideY,mouseleave:function(n){t.showGuideY=!1}}},[e("canvas",{ref:"canvasY",staticClass:"vm-ruler__canvas",attrs:{width:t.canvasW,height:t.guideSize}}),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showGuideY,expression:"showGuideY"}],staticClass:"vm-ruler__guide-y",style:{left:t.mouseY*t.scale+t.placeholderW+"px"},on:{click:function(n){return n.stopPropagation(),t.handleAddLineY.apply(null,arguments)}}},[e("span",[t._v("\n\t\t\t\t\t\t"+t._s(t.mouseY)+"\n\t\t\t\t\t")])]),t._v(" "),t.showGuide?t._l(t.linesY,(function(n,i){return e("div",{key:i,staticClass:"vm-ruler__guide-y is-solid",style:{left:n*t.scale+t.placeholderW+"px"},attrs:{title:"双击删除参考线"},on:{mousedown:function(n){return n.stopPropagation(),t.handleMouseDown("y",i)},dblclick:function(n){return t.linesY.splice(i,1)}}},[e("span",[t._v("\n\t\t\t\t\t\t\t"+t._s(n)+"\n\t\t\t\t\t\t")])])})):t._e()],2)]),t._v(" "),t._t("default")],2)])};Bn._withStripped=!0;var Dn=vt({render:Bn,staticRenderFns:[]},(function(t){t&&t("data-v-2811ceba_0",{source:"@charset \"UTF-8\";\n/**\n * [commonDirectionFill 方向名词补充]\n * @param  {[string]} $key [l r b t]\n * @return {[string]}      [left right bottom top]\n */\n/**\n * [commonColumnWidth 平均分配百分比]\n * @param  {[number]} $col   [所占比]\n * @param  {[number]} $total [总]\n * @return {[number]}        [所占比/总 * 100%]\n */\n/**\n * [commonBorder 1px的兼容问题]\n * @param  {[string]} $border: ltbr          [border的方向缩写拼接]\n * @return {[type]}          [1px border]\n */\n/**\n * 1px\n * 已为父元素添加position: relative;\n * 其他只操作before和after;\n * 暂时不抽离公用\n */\n/**\n * [commonPadding padding]\n * @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonMargin margin]\n* @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonAbsolute absolute]\n * @param  {[list]} $direction-val... [top, right, bottom, left 的值]\n * @return {[type]}                   [description]\n */\n/**\n * 水平垂直居中\n */\n/**\n * 文字相关\n */\n/**\n * 一行文字\n */\n/* stylelint-disable */\n/**\n * [commonClearfix 清除浮动]\n * @return {[type]} [description]\n */\n/* Var\n -------------------------- */\n/* Func\n -------------------------- */\n/* Mix\n -------------------------- */\n/**\n * @param $root: 默认置顶\n */\n/**\n * 1. +, >, ~, ' '\n * 2. 同element\n * 3. 同modifier\n * 4. 同block\n */\n/**\n * -> [className].is_require \n * 与xxx:hover类似\n */\n/**\n * 用 @at-root 来重置 & 读取次数的计数\n * 如 [clsssName] [className]:hover\n */\n/**\n * 自定义规则\n */\n/**\n * TODO: 使用vc-scroller;\n */\n.vm-ruler {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n  -webkit-flex-direction: column;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  position: relative;\n}\n.vm-ruler__x {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  position: relative;\n  z-index: 2;\n}\n.vm-ruler__wrapper {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n}\n.vm-ruler__y {\n  height: 100%;\n  width: 20px;\n  z-index: 2;\n}\n.vm-ruler__y-rotate {\n  -webkit-transform-origin: 0 100% 0;\n      -ms-transform-origin: 0 100% 0;\n          transform-origin: 0 100% 0;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  position: relative;\n  margin-top: -39px;\n}\n.vm-ruler__guide {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 20px;\n  height: 20px;\n  background: #efefef;\n  cursor: pointer;\n  z-index: 3;\n}\n.vm-ruler__canvas {\n  background: #FAFAFA;\n}\n.vm-ruler.is-dark .vm-ruler__canvas {\n  background: #474747;\n}\n.vm-ruler.is-dark .vm-ruler__guide {\n  background: #535353;\n}\n.vm-ruler.is-dark .vm-ruler__guide {\n  background: #535353;\n}\n.vm-ruler__guide-x {\n  position: absolute;\n  height: 100vh;\n  top: 0;\n  border-left: 1px dashed rgba(0, 173, 255, 0.84);\n  padding-left: 5px;\n  cursor: ew-resize;\n}\n.vm-ruler__guide-x > span {\n  position: absolute;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  color: #fff;\n  padding: 0 4px;\n  line-height: 20px;\n  border-radius: 1px;\n  -webkit-box-shadow: 0 0 5px -3px #000;\n          box-shadow: 0 0 5px -3px #000;\n  background: rgba(64, 116, 180, 0.7);\n}\n.vm-ruler__guide-x.is-solid {\n  border-left: 1px solid rgba(0, 173, 255, 0.84);\n}\n.vm-ruler__guide-y {\n  -webkit-transform: rotate(-90deg);\n      -ms-transform: rotate(-90deg);\n          transform: rotate(-90deg);\n  -webkit-transform-origin: 0 100% 0;\n      -ms-transform-origin: 0 100% 0;\n          transform-origin: 0 100% 0;\n  position: absolute;\n  width: 100vw;\n  top: 20px;\n  border-bottom: 1px dashed rgba(0, 173, 255, 0.84);\n  padding-bottom: 5px;\n  cursor: ns-resize;\n}\n.vm-ruler__guide-y > span {\n  -webkit-transform: rotate(90deg);\n      -ms-transform: rotate(90deg);\n          transform: rotate(90deg);\n  -webkit-transform-origin: 0 0 0;\n      -ms-transform-origin: 0 0 0;\n          transform-origin: 0 0 0;\n  position: absolute;\n  left: 25px;\n  top: 5px;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  color: #fff;\n  padding: 0 4px;\n  line-height: 20px;\n  border-radius: 1px;\n  -webkit-box-shadow: 0 0 5px -3px #000;\n          box-shadow: 0 0 5px -3px #000;\n  background: rgba(64, 116, 180, 0.7);\n}\n.vm-ruler__guide-y.is-solid {\n  border-bottom: 1px solid rgba(0, 173, 255, 0.84);\n}\n\n/*# sourceMappingURL=ruler.vue.map */",map:{version:3,sources:["ruler.vue","/Users/deot/Desktop/wya/github/wya-vm/src/combo/frame/draggable/ruler.vue"],names:[],mappings:"AAAA,gBAAgB;AAChB;;;;EAIE;AACF;;;;;EAKE;AACF;;;;EAIE;AACF;;;;;EAKE;AACF;;;;;;;EAOE;AACF;;;;;;;EAOE;AACF;;;;EAIE;AACF;;EAEE;AACF;;EAEE;AACF;;EAEE;AACF,sBAAsB;AACtB;;;EAGE;AACF;6BAC6B;AAC7B;6BAC6B;AAC7B;6BAC6B;AAC7B;;EAEE;AACF;;;;;EAKE;AACF;;;EAGE;AACF;;;EAGE;AACF;;EAEE;AACF;;EAEE;AACF;EC6VA,oBAAA;EAAA,qBAAA;EAAA,oBAAA;EAAA,aAAA;EACA,4BAAA;EAAA,6BAAA;EAAA,8BAAA;MAAA,0BAAA;UAAA,sBAAA;EAEA,kBAAA;AD5VA;AACA;EC6VA,oBAAA;EAAA,qBAAA;EAAA,oBAAA;EAAA,aAAA;EACA,kBAAA;EACA,UAAA;AD3VA;AAEA;EC4VA,oBAAA;EAAA,qBAAA;EAAA,oBAAA;EAAA,aAAA;AD1VA;AAEA;EC4VA,YAAA;EACA,WAAA;EACA,UAAA;AD1VA;AAEA;EC2VA,kCAAA;MAAA,8BAAA;UAAA,0BAAA;EACA,oBAAA;EAAA,qBAAA;EAAA,oBAAA;EAAA,aAAA;EACA,kBAAA;EACA,iBAAA;ADzVA;AAEA;EC2VA,kBAAA;EACA,MAAA;EACA,OAAA;EACA,WAAA;EACA,YAAA;EACA,mBAAA;EACA,eAAA;EACA,UAAA;ADzVA;AAEA;EC0VA,mBAAA;ADxVA;AAEA;EC2VA,mBAAA;ADzVA;AAEA;EC0VA,mBAAA;ADxVA;AAEA;ECyVA,mBAAA;ADvVA;AAEA;EC2VA,kBAAA;EACA,aAAA;EACA,MAAA;EACA,+CAAA;EACA,iBAAA;EACA,iBAAA;ADzVA;AC0VA;EACA,kBAAA;EACA,oBAAA;EAAA,qBAAA;EAAA,oBAAA;EAAA,aAAA;EACA,wBAAA;EAAA,+BAAA;MAAA,qBAAA;UAAA,uBAAA;EACA,yBAAA;EAAA,2BAAA;MAAA,sBAAA;UAAA,mBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;EACA,WAAA;EACA,cAAA;EACA,iBAAA;EACA,kBAAA;EACA,qCAAA;UAAA,6BAAA;EACA,mCAzEA;AD/QA;AACA;EC0VA,8CAAA;ADxVA;AAEA;EC4VA,iCAAA;MAAA,6BAAA;UAAA,yBAAA;EACA,kCAAA;MAAA,8BAAA;UAAA,0BAAA;EACA,kBAAA;EACA,YAAA;EACA,SAAA;EACA,iDAAA;EACA,mBAAA;EACA,iBAAA;AD1VA;AC2VA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;EACA,+BAAA;MAAA,2BAAA;UAAA,uBAAA;EACA,kBAAA;EACA,UAAA;EACA,QAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;EACA,WAAA;EACA,cAAA;EACA,iBAAA;EACA,kBAAA;EACA,qCAAA;UAAA,6BAAA;EACA,mCAtGA;ADnPA;AACA;EC2VA,gDAAA;ADzVA;;AAEA,oCAAoC",file:"ruler.vue",sourcesContent:["@charset \"UTF-8\";\n/**\n * [commonDirectionFill 方向名词补充]\n * @param  {[string]} $key [l r b t]\n * @return {[string]}      [left right bottom top]\n */\n/**\n * [commonColumnWidth 平均分配百分比]\n * @param  {[number]} $col   [所占比]\n * @param  {[number]} $total [总]\n * @return {[number]}        [所占比/总 * 100%]\n */\n/**\n * [commonBorder 1px的兼容问题]\n * @param  {[string]} $border: ltbr          [border的方向缩写拼接]\n * @return {[type]}          [1px border]\n */\n/**\n * 1px\n * 已为父元素添加position: relative;\n * 其他只操作before和after;\n * 暂时不抽离公用\n */\n/**\n * [commonPadding padding]\n * @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonMargin margin]\n* @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonAbsolute absolute]\n * @param  {[list]} $direction-val... [top, right, bottom, left 的值]\n * @return {[type]}                   [description]\n */\n/**\n * 水平垂直居中\n */\n/**\n * 文字相关\n */\n/**\n * 一行文字\n */\n/* stylelint-disable */\n/**\n * [commonClearfix 清除浮动]\n * @return {[type]} [description]\n */\n/* Var\n -------------------------- */\n/* Func\n -------------------------- */\n/* Mix\n -------------------------- */\n/**\n * @param $root: 默认置顶\n */\n/**\n * 1. +, >, ~, ' '\n * 2. 同element\n * 3. 同modifier\n * 4. 同block\n */\n/**\n * -> [className].is_require \n * 与xxx:hover类似\n */\n/**\n * 用 @at-root 来重置 & 读取次数的计数\n * 如 [clsssName] [className]:hover\n */\n/**\n * 自定义规则\n */\n/**\n * TODO: 使用vc-scroller;\n */\n.vm-ruler {\n  display: flex;\n  flex-direction: column;\n  position: relative;\n}\n.vm-ruler__x {\n  display: flex;\n  position: relative;\n  z-index: 2;\n}\n\n.vm-ruler__wrapper {\n  display: flex;\n}\n\n.vm-ruler__y {\n  height: 100%;\n  width: 20px;\n  z-index: 2;\n}\n\n.vm-ruler__y-rotate {\n  transform-origin: 0 100% 0;\n  display: flex;\n  position: relative;\n  margin-top: -39px;\n}\n\n.vm-ruler__guide {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 20px;\n  height: 20px;\n  background: #efefef;\n  cursor: pointer;\n  z-index: 3;\n}\n\n.vm-ruler__canvas {\n  background: #FAFAFA;\n}\n\n.vm-ruler.is-dark .vm-ruler__canvas {\n  background: #474747;\n}\n\n.vm-ruler.is-dark .vm-ruler__guide {\n  background: #535353;\n}\n\n.vm-ruler.is-dark .vm-ruler__guide {\n  background: #535353;\n}\n\n.vm-ruler__guide-x {\n  position: absolute;\n  height: 100vh;\n  top: 0;\n  border-left: 1px dashed rgba(0, 173, 255, 0.84);\n  padding-left: 5px;\n  cursor: ew-resize;\n}\n.vm-ruler__guide-x > span {\n  position: absolute;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  user-select: none;\n  color: #fff;\n  padding: 0 4px;\n  line-height: 20px;\n  border-radius: 1px;\n  box-shadow: 0 0 5px -3px #000;\n  background: rgba(64, 116, 180, 0.7);\n}\n.vm-ruler__guide-x.is-solid {\n  border-left: 1px solid rgba(0, 173, 255, 0.84);\n}\n\n.vm-ruler__guide-y {\n  transform: rotate(-90deg);\n  transform-origin: 0 100% 0;\n  position: absolute;\n  width: 100vw;\n  top: 20px;\n  border-bottom: 1px dashed rgba(0, 173, 255, 0.84);\n  padding-bottom: 5px;\n  cursor: ns-resize;\n}\n.vm-ruler__guide-y > span {\n  transform: rotate(90deg);\n  transform-origin: 0 0 0;\n  position: absolute;\n  left: 25px;\n  top: 5px;\n  user-select: none;\n  color: #fff;\n  padding: 0 4px;\n  line-height: 20px;\n  border-radius: 1px;\n  box-shadow: 0 0 5px -3px #000;\n  background: rgba(64, 116, 180, 0.7);\n}\n.vm-ruler__guide-y.is-solid {\n  border-bottom: 1px solid rgba(0, 173, 255, 0.84);\n}\n\n/*# sourceMappingURL=ruler.vue.map */",'<template>\n\t<div :class="{ \'is-dark\': isDark }" class="vm-ruler">\n\t\t\x3c!-- 坐标原点，定位 --\x3e\n\t\t<div\n\t\t\t:style="{\n\t\t\t\twidth: `${guideSize}px`,\n\t\t\t\theight: `${guideSize}px`,\n\t\t\t}"\n\t\t\t:title="`单击${showGuide ? \'隐藏\' : \'显示\'}辅助线`"\n\t\t\tclass="vm-ruler__guide"\n\t\t\t@click="showGuide = !showGuide"\n\t\t/>\n\t\t\x3c!-- x轴 --\x3e\n\t\t<div\n\t\t\tref="x"\n\t\t\t:style="{ transform: `translateX(${-scrollLeft}px)` }"\n\t\t\tclass="vm-ruler__x"\n\t\t\t@mousemove="handleShowGuideX"\n\t\t\t@mouseleave="showGuideX = false"\n\t\t>\n\t\t\t<canvas\n\t\t\t\tref="canvasX"\n\t\t\t\t:width="canvasW"\n\t\t\t\t:height="guideSize"\n\t\t\t\tclass="vm-ruler__canvas"\n\t\t\t/>\n\t\t\t\x3c!-- X虚线 --\x3e\n\t\t\t<div\n\t\t\t\tv-show="showGuideX"\n\t\t\t\tref="guideX"\n\t\t\t\t:style="{ left: `${mouseX * scale + placeholderW}px`}"\n\t\t\t\tclass="vm-ruler__guide-x"\n\t\t\t\t@click.stop="handleAddLineX"\n\t\t\t>\n\t\t\t\t<span>\n\t\t\t\t\t{{ mouseX }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t\x3c!-- X实线 --\x3e\n\t\t\t<template v-if="showGuide">\n\t\t\t\t<div\n\t\t\t\t\tv-for="(item, index) in linesX"\n\t\t\t\t\t:key="index"\n\t\t\t\t\t:style="{\n\t\t\t\t\t\tleft: `${item * scale + placeholderW}px`,\n\t\t\t\t\t}"\n\t\t\t\t\ttitle="双击删除参考线"\n\t\t\t\t\tclass="vm-ruler__guide-x is-solid"\n\t\t\t\t\t@mousedown.stop="handleMouseDown(\'x\', index)"\n\t\t\t\t\t@dblclick="linesX.splice(index, 1)"\n\t\t\t\t>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t{{ item }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\n\t\t<div class="vm-ruler__wrapper" :style="{ height: `calc(100% - ${guideSize}px)` }">\n\t\t\t<div class="vm-ruler__y">\n\t\t\t\t<div\n\t\t\t\t\tref="y"\n\t\t\t\t\t:style="{\n\t\t\t\t\t\ttransform: `rotate(90deg) translateX(${-scrollTop}px)`,\n\t\t\t\t\t}"\n\t\t\t\t\tclass="vm-ruler__y-rotate"\n\t\t\t\t\t@mousemove="handleShowGuideY"\n\t\t\t\t\t@mouseleave="showGuideY = false"\n\t\t\t\t>\n\t\t\t\t\t<canvas\n\t\t\t\t\t\tref="canvasY"\n\t\t\t\t\t\t:width="canvasW"\n\t\t\t\t\t\t:height="guideSize"\n\t\t\t\t\t\tclass="vm-ruler__canvas"\n\t\t\t\t\t/>\n\n\t\t\t\t\t\x3c!-- Y虚线 --\x3e\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-show="showGuideY"\n\t\t\t\t\t\t:style="{\n\t\t\t\t\t\t\tleft: `${mouseY * scale + placeholderW}px`,\n\t\t\t\t\t\t}"\n\t\t\t\t\t\tclass="vm-ruler__guide-y"\n\t\t\t\t\t\t@click.stop="handleAddLineY"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t{{ mouseY }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t\x3c!-- Y实线 --\x3e\n\t\t\t\t\t<template v-if="showGuide">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-for="(item, index) in linesY"\n\t\t\t\t\t\t\t:key="index"\n\t\t\t\t\t\t\t:style="{\n\t\t\t\t\t\t\t\tleft: `${item * scale + placeholderW}px`,\n\t\t\t\t\t\t\t}"\n\t\t\t\t\t\t\tclass="vm-ruler__guide-y is-solid"\n\t\t\t\t\t\t\ttitle="双击删除参考线"\n\t\t\t\t\t\t\t@mousedown.stop="handleMouseDown(\'y\', index)"\n\t\t\t\t\t\t\t@dblclick="linesY.splice(index, 1)"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t{{ item }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<slot />\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport { Clipboard } from \'../../../vc\';\nimport { $, debounce } from \'../../../utils/helper\';\n\nexport default {\n\tname: \'vm-ruler\',\n\tcomponents: {\n\n\t},\n\tprops: {\n\t\tscrollTop: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\t\tscrollLeft: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\t\tframeW: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\t\tframeH: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\t\tclientW: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\t\tclientH: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\t\tscale: {\n\t\t\ttype: Number,\n\t\t\tdefault: 1\n\t\t},\n\t\tguides: Array,\n\t\ttheme: String,\n\t\tborderSize: {\n\t\t\ttype: Object,\n\t\t\tdefault() {\n\t\t\t\treturn {\n\t\t\t\t\ttop: 0,\n\t\t\t\t\tleft: 0,\n\t\t\t\t\tbottom: 0,\n\t\t\t\t\tright: 0\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\t\tscrollerSize: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t}\n\t},\n\tdata() {\n\t\treturn {\n\t\t\t// 辅助线开关区域宽高\n\t\t\tguideSize: 20,\n\n\t\t\t// 是否显示鼠标移动的X/Y轴辅助线 (虚线)\n\t\t\tshowGuide: true,\n\t\t\tshowGuideX: false,\n\t\t\tshowGuideY: false,\n\t\t\t// 鼠标在X/Y轴的坐标\n\t\t\tmouseX: 0,\n\t\t\tmouseY: 0,\n\t\t\t// 横轴起始X/Y位置\n\t\t\toffsetX: 0,\n\t\t\toffsetY: 0,\n\n\t\t\t// X/Y轴辅助线 (实线)\n\t\t\tlinesX: [],\n\t\t\tlinesY: [],\n\n\t\t\tmovingAxias: \'\',\n\t\t\tmovingIndex: -1,\n\t\t};\n\t},\n\tcomputed: {\n\t\t/**\n\t\t * 刻度的宽度\n\t\t */\n\t\tcanvasW() {\n\t\t\tconst { frameW, frameH, scale, borderSize, guideSize, clientW, clientH } = this;\n\t\t\tconst { scrollTop, scrollLeft, scrollerSize } = this;\n\n\t\t\tconst offsetW = borderSize.left + borderSize.right + guideSize;\n\t\t\tconst offsetH = borderSize.top + borderSize.bottom + guideSize;\n\n\t\t\t/**\n\t\t\t * TODO: 动态计算\n\t\t\t * 用于滚动距离避免重绘[动态计算canvasW时出现不绘制]，主要是元素拖动到画布以外，超过5000就不计算了\n\t\t\t */\n\t\t\tlet width = Math.max(\n\t\t\t\t5000,\n\t\t\t\tframeW * scale + offsetW,\n\t\t\t\tframeH * scale + offsetH,\n\t\t\t\tclientW,\n\t\t\t\tclientH\n\t\t\t);\n\t\t\treturn scrollerSize + width;\n\t\t},\n\t\t// 0刻度距离轴容器左边的距离\n\t\tplaceholderW() {\n\t\t\treturn this.borderSize.left + this.guideSize;\n\t\t},\n\n\t\t// 10刻度间隔(缩放后)\n\t\tinterval() {\n\t\t\tconst { scale } = this;\n\t\t\t// 10刻度所占像素初始值\n\t\t\tlet width = 100;\n\t\t\t\n\t\t\tif (scale <= 0) return width;\n\n\t\t\t// 目标： 缩放后十刻度占屏幕实际尺寸 60 - 100 像素\n\t\t\twhile (width * scale < 60) { // 缩小\n\t\t\t\twidth += 50;\n\t\t\t}\n\t\t\twhile (width * scale > 100) { // 放大\n\t\t\t\twidth - 20 >= 0 ? width -= 20 : width -= 10;\n\t\t\t}\n\t\t\treturn width * scale;\n\t\t},\n\n\t\tisDark() {\n\t\t\treturn this.theme === \'dark\';\n\t\t}\n\t},\n\twatch: {\n\t\tlinesX: {\n\t\t\tdeep: true,\n\t\t\thandler() {\n\t\t\t\tthis.$emit(\'guides-change\', [this.linesX, this.linesY]);\n\t\t\t}\n\t\t},\n\t\tlinesY: {\n\t\t\tdeep: true,\n\t\t\thandler() {\n\t\t\t\tthis.$emit(\'guides-change\', [this.linesX, this.linesY]);\n\t\t\t}\n\t\t}\n\t},\n\n\tcreated() {\n\t\tlet watchArr = [\n\t\t\t\'frameW\',\n\t\t\t\'frameH\',\n\t\t\t\'scale\',\n\t\t\t\'clientW\',\n\t\t\t\'clientH\',\n\t\t\t\'theme\'\n\t\t];\n\n\t\tlet hook = debounce(this.refreshCanvas, 50);\n\n\t\twatchArr.forEach(item => this.$watch(item, hook));\n\t},\n\tmounted() {\n\t\t// 兼容使用portal时，有300ms的动画延迟\n\t\tsetTimeout(() => {\n\t\t\tthis.canvas = [this.$refs.canvasX, this.$refs.canvasY];\n\t\t\tthis.offsetX = this.$refs.x.getBoundingClientRect().x;\n\t\t\tthis.offsetY = this.$refs.y.getBoundingClientRect().y;\n\t\t\tthis.refreshCanvas();\n\t\t}, 300);\n\t},\n\n\tdestroyed() {\n\t\tthis.operateDOMEvents(\'remove\');\n\t},\n\n\tmethods: {\n\t\trefreshCanvas() {\n\t\t\tthis.canvas && this.canvas.forEach(canvas => this.repaint(canvas));\n\t\t},\n\n\t\t/**\n\t\t * 轴距离容器左边有20px的间距和辅助线开关区域的宽度\n\t\t */\n\t\trepaint(canvas) {\n\t\t\tif (!this._isMounted || !canvas) return;\n\t\t\tlet { canvasW, guideSize, placeholderW, interval, isDark } = this;\n\t\t\tlet ctx = canvas.getContext(\'2d\');\n\t\t\t// 重置画布\n\t\t\tcanvas.height = canvas.height; // eslint-disable-line\n\n\t\t\tctx.beginPath();\n\t\t\tctx.fillStyle = isDark ? \'#474747\' : \'#FAFAFA\';\n\t\t\tctx.fillRect(0, 0, canvasW, guideSize);\n\t\t\tctx.translate(placeholderW, 0); // (20, 0)坐标开始画10刻度线\n\t\t\tctx.fillStyle = isDark ? "#615E5B" : \'#000\';\n\t\t\tctx.save();\n\t\t\tfor (let i = 0; i < canvasW / interval; i++) {\n\t\t\t\t// 画刻度线\n\t\t\t\tctx.fillStyle = isDark ? "#615E5B" : \'#000\';\n\t\t\t\tctx.translate(i * interval, 0);\n\t\t\t\tctx.fillRect(0, 0, 1, guideSize);\n\t\t\t\tctx.restore();\n\t\t\t\tctx.save();\n\t\t\t\t// 返回画刻度数字\n\t\t\t\tctx.fillStyle = "#8C8D89";\n\t\t\t\tctx.font = "12px";\n\t\t\t\t// 文字在轴内的 3/5 位置\n\t\t\t\tctx.fillText((i * interval / this.scale).toFixed(0), i * interval + 4, guideSize / 5 * 3);\n\t\t\t}\n\t\t\t// 还原到 (20, 0)坐标\n\t\t\tctx.restore();\n\t\t\t// 移到 (20, 17)坐标\n\t\t\tctx.translate(0, guideSize - 3);\n\t\t\tctx.save(); // (20, 17)坐标开始画1刻度线\n\t\t\tfor (let i = 0; i < canvasW / interval * 10; i++) {\n\t\t\t\tif (i % 10 !== 0) {\n\t\t\t\t\tctx.translate(i * interval / 10, 0);\n\t\t\t\t\tctx.fillRect(0, 0, 1, 3);\n\t\t\t\t\tctx.restore();\n\t\t\t\t\tctx.save();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * 参考X虚线显示\n\t\t */\n\t\thandleShowGuideX(e) {\n\t\t\tconst { offsetX, placeholderW, scrollLeft, scale } = this;\n\t\t\tif (\n\t\t\t\tthis.$refs.x.contains(e.target)\n\t\t\t\t&& !$(e.target).hasClass(\'is-solid\')\n\t\t\t) {\n\t\t\t\tthis.showGuideX = true;\n\t\t\t\tthis.mouseX = Math.floor((e.clientX - offsetX - placeholderW + scrollLeft) / scale);\n\t\t\t} else {\n\t\t\t\tthis.showGuideX = false;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * 参考Y虚线显示\n\t\t */\n\t\thandleShowGuideY(e) {\n\t\t\tconst { offsetY, placeholderW, scrollTop, scale } = this;\n\t\t\tif (\n\t\t\t\tthis.$refs.y.contains(e.target)\n\t\t\t\t&& !$(e.target).hasClass(\'is-solid\')\n\t\t\t) {\n\t\t\t\tthis.showGuideY = true;\n\t\t\t\tthis.mouseY = Math.floor((e.clientY - offsetY - placeholderW + scrollTop) / scale);\n\t\t\t} else {\n\t\t\t\tthis.showGuideY = false;\n\t\t\t}\n\t\t},\n\n\t\thandleAddLineX() {\n\t\t\t!this.linesX.includes(this.mouseX) && this.linesX.push(this.mouseX);\n\t\t},\n\n\t\thandleAddLineY() {\n\t\t\t!this.linesY.includes(this.mouseY) && this.linesY.push(this.mouseY);\n\t\t},\n\n\t\toperateDOMEvents(type) {\n\t\t\tlet fn = type === \'add\'\n\t\t\t\t? document.documentElement.addEventListener\n\t\t\t\t: document.documentElement.removeEventListener;\n\n\t\t\tfn(\'mouseup\', this.handleMouseUp);\n\t\t\tfn(\'mousemove\', this.handleMouseMove);\n\t\t},\n\n\t\t// 鼠标按下事件\n\t\thandleMouseDown(axias, index) {\n\t\t\tClipboard.clearSelection();\n\n\t\t\tthis.movingIndex = index;\n\t\t\tthis.movingAxias = axias;\n\n\t\t\tthis.operateDOMEvents(\'add\');\n\t\t},\n\n\t\t// 鼠标放手事件\n\t\thandleMouseUp() {\n\t\t\tClipboard.clearSelection();\n\t\t\tthis.operateDOMEvents(\'remove\');\n\t\t},\n\n\t\thandleMouseMove(e) {\n\t\t\tconst { offsetX, offsetY, placeholderW, scrollLeft, scrollTop, scale } = this;\n\t\t\tif (this.movingAxias === \'x\') {\n\t\t\t\tthis.$set(\n\t\t\t\t\tthis.linesX,\n\t\t\t\t\tthis.movingIndex,\n\t\t\t\t\tMath.floor((e.clientX - offsetX - placeholderW + scrollLeft) / scale),\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.movingAxias === \'y\') {\n\t\t\t\tthis.$set(\n\t\t\t\t\tthis.linesY,\n\t\t\t\t\tthis.movingIndex,\n\t\t\t\t\tMath.floor((e.clientY - offsetY - placeholderW + scrollTop) / scale),\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t},\n\t},\n};\n<\/script>\n\n<style lang="scss">\n@import "../../../style/index.scss";\n\n$block: vm-ruler;\n$blue-guide: rgba(0, 173, 255, .84);\n$blue-label: rgba(64, 116, 180, .7);\n\n@include block($block) {\n\tdisplay: flex;\n\tflex-direction: column;\n\t// height: 100%; // 动态计算\n\tposition: relative;\n\t@include element(x) {\n\t\tdisplay: flex;\n\t\tposition: relative;\n\t\tz-index: 2;\n\t}\n\t@include element(wrapper) {\n\t\tdisplay: flex;\n\t\t// height: 100% // 动态计算\n\t}\n\t@include element(y) {\n\t\theight: 100%;\n\t\twidth: 20px;\n\t\tz-index: 2;\n\t}\n\t@include element(y-rotate) {\n\t\ttransform-origin: 0 100% 0;\n\t\tdisplay: flex;\n\t\tposition: relative;\n\t\tmargin-top: -39px;\n\t}\n\n\t@include element(guide) {\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\twidth: 20px;\n\t\theight: 20px;\n\t\tbackground: $theme-light-bg;\n\t\tcursor: pointer;\n\t\tz-index: 3;\n\t}\n\t@include element(canvas) {\n\t\tbackground: $theme-light-ruler-bg;\n\t}\n\n\t@include when(dark) {\n\t\t@include element(canvas) {\n\t\t\tbackground: $theme-dark-ruler-bg;\n\t\t}\n\t\t@include element(guide) {\n\t\t\tbackground: $theme-dark-guide-bg;\n\t\t}\n\t\t@include element(guide) {\n\t\t\tbackground: $theme-dark-guide-bg;\n\t\t}\n\t}\n}\n\n@include block(vm-ruler__guide-x) {\n\tposition: absolute;\n\theight: 100vh;\n\ttop: 0;\n\tborder-left: 1px dashed $blue-guide;\n\tpadding-left: 5px;\n\tcursor: ew-resize;\n\t> span {\n\t\tposition: absolute;\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\tuser-select: none;\n\t\tcolor: #fff;\n\t\tpadding: 0 4px;\n\t\tline-height: 20px;\n\t\tborder-radius: 1px;\n\t\tbox-shadow: 0 0 5px -3px #000;\n\t\tbackground: $blue-label;\n\t}\n\t@include when(solid) {\n\t\tborder-left: 1px solid $blue-guide;\n\t}\n}\n\n\n@include block(vm-ruler__guide-y) {\n\ttransform: rotate(-90deg);\n\ttransform-origin: 0 100% 0;\n\tposition: absolute;\n\twidth: 100vw;\n\ttop: 20px;\n\tborder-bottom: 1px dashed $blue-guide;\n\tpadding-bottom: 5px;\n\tcursor: ns-resize;\n\t> span {\n\t\ttransform: rotate(90deg);\n\t\ttransform-origin: 0 0 0;\n\t\tposition: absolute;\n\t\tleft: 25px;\n\t\ttop: 5px;\n\t\tuser-select: none;\n\t\tcolor: #fff;\n\t\tpadding: 0 4px;\n\t\tline-height: 20px;\n\t\tborder-radius: 1px;\n\t\tbox-shadow: 0 0 5px -3px #000;\n\t\tbackground: $blue-label;\n\t}\n\t@include when(solid) {\n\t\tborder-bottom: 1px solid $blue-guide;\n\t}\n}\n\n</style>\n']},media:void 0})}),kn,void 0,!1,void 0,!1,yt,void 0,void 0);function Sn(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,i)}return e}var On={name:"vm-frame-inner",components:{"vm-ruler":Dn},props:function(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?Sn(Object(e),!0).forEach((function(n){S.default(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Sn(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}({showRuler:Boolean,showZoomBar:Boolean,zoomBarH:Number,scrollerSize:Number},Dn.props),mounted:function(){_.Resize.on(this.$el,this.handleResize)},destroyed:function(){_.Resize.off(this.$el,this.handleResize)},methods:{handleResize:o.throttle((function(t){if(this.$el){var n=+(this.$refs.ruler&&this.$refs.ruler.guideSize),e=this.$el.offsetWidth-n-this.scrollerSize,i=this.$el.offsetHeight-n-this.zoomBarH-this.scrollerSize;e&&i&&this.$emit("client-resize",e,i)}}),50)}},Mn=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"vm-frame-draggable--inner",class:{"is-hide-border":!t.showRuler}},[t.showRuler?e("vm-ruler",{ref:"ruler",style:{height:"calc(100% - "+t.zoomBarH+"px)"},attrs:{"scroll-left":t.scrollLeft,"scroll-top":t.scrollTop,"frame-w":t.frameW,"frame-h":t.frameH,"client-w":t.clientW,"client-h":t.clientH,scale:t.scale,guides:t.guides,theme:t.theme,"border-size":t.borderSize,"scroller-size":t.scrollerSize},on:{"guides-change":function(n){return t.$emit("update:guides",arguments[0])}}},[t._t("content")],2):t._t("content"),t._v(" "),t._t("content-extra"),t._v(" "),t._t("footer")],2)};Mn._withStripped=!0;var zn=vt({render:Mn,staticRenderFns:[]},(function(t){t&&t("data-v-06ae84c5_0",{source:"@charset \"UTF-8\";\n/**\n * [commonDirectionFill 方向名词补充]\n * @param  {[string]} $key [l r b t]\n * @return {[string]}      [left right bottom top]\n */\n/**\n * [commonColumnWidth 平均分配百分比]\n * @param  {[number]} $col   [所占比]\n * @param  {[number]} $total [总]\n * @return {[number]}        [所占比/总 * 100%]\n */\n/**\n * [commonBorder 1px的兼容问题]\n * @param  {[string]} $border: ltbr          [border的方向缩写拼接]\n * @return {[type]}          [1px border]\n */\n/**\n * 1px\n * 已为父元素添加position: relative;\n * 其他只操作before和after;\n * 暂时不抽离公用\n */\n/**\n * [commonPadding padding]\n * @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonMargin margin]\n* @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonAbsolute absolute]\n * @param  {[list]} $direction-val... [top, right, bottom, left 的值]\n * @return {[type]}                   [description]\n */\n/**\n * 水平垂直居中\n */\n/**\n * 文字相关\n */\n/**\n * 一行文字\n */\n/* stylelint-disable */\n/**\n * [commonClearfix 清除浮动]\n * @return {[type]} [description]\n */\n/* Var\n -------------------------- */\n/* Func\n -------------------------- */\n/* Mix\n -------------------------- */\n/**\n * @param $root: 默认置顶\n */\n/**\n * 1. +, >, ~, ' '\n * 2. 同element\n * 3. 同modifier\n * 4. 同block\n */\n/**\n * -> [className].is_require \n * 与xxx:hover类似\n */\n/**\n * 用 @at-root 来重置 & 读取次数的计数\n * 如 [clsssName] [className]:hover\n */\n/**\n * 自定义规则\n */\n/**\n * TODO: 使用vc-scroller;\n */\n.vm-frame-draggable--inner {\n  -webkit-box-flex: 1;\n  -webkit-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n  overflow: hidden;\n  background: #d9d9d9;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n  -webkit-flex-direction: column;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  position: relative;\n  border-left: 1px solid #BDBDBD;\n}\n.vm-frame-draggable--inner.is-hide-border {\n  border-left: none;\n  border-right: none;\n}\n\n/*# sourceMappingURL=inner.vue.map */",map:{version:3,sources:["inner.vue","/Users/deot/Desktop/wya/github/wya-vm/src/combo/frame/draggable/inner.vue"],names:[],mappings:"AAAA,gBAAgB;AAChB;;;;EAIE;AACF;;;;;EAKE;AACF;;;;EAIE;AACF;;;;;EAKE;AACF;;;;;;;EAOE;AACF;;;;;;;EAOE;AACF;;;;EAIE;AACF;;EAEE;AACF;;EAEE;AACF;;EAEE;AACF,sBAAsB;AACtB;;;EAGE;AACF;6BAC6B;AAC7B;6BAC6B;AAC7B;6BAC6B;AAC7B;;EAEE;AACF;;;;;EAKE;AACF;;;EAGE;AACF;;;EAGE;AACF;;EAEE;AACF;;EAEE;AACF;ECJA,mBAAA;EAAA,eAAA;MAAA,WAAA;UAAA,OAAA;EACA,gBAAA;EACA,mBAAA;EAEA,oBAAA;EAAA,qBAAA;EAAA,oBAAA;EAAA,aAAA;EACA,4BAAA;EAAA,6BAAA;EAAA,8BAAA;MAAA,0BAAA;UAAA,sBAAA;EACA,kBAAA;EAEA,8BAAA;ADIA;AACA;ECHA,iBAAA;EACA,kBAAA;ADKA;;AAEA,oCAAoC",file:"inner.vue",sourcesContent:["@charset \"UTF-8\";\n/**\n * [commonDirectionFill 方向名词补充]\n * @param  {[string]} $key [l r b t]\n * @return {[string]}      [left right bottom top]\n */\n/**\n * [commonColumnWidth 平均分配百分比]\n * @param  {[number]} $col   [所占比]\n * @param  {[number]} $total [总]\n * @return {[number]}        [所占比/总 * 100%]\n */\n/**\n * [commonBorder 1px的兼容问题]\n * @param  {[string]} $border: ltbr          [border的方向缩写拼接]\n * @return {[type]}          [1px border]\n */\n/**\n * 1px\n * 已为父元素添加position: relative;\n * 其他只操作before和after;\n * 暂时不抽离公用\n */\n/**\n * [commonPadding padding]\n * @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonMargin margin]\n* @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonAbsolute absolute]\n * @param  {[list]} $direction-val... [top, right, bottom, left 的值]\n * @return {[type]}                   [description]\n */\n/**\n * 水平垂直居中\n */\n/**\n * 文字相关\n */\n/**\n * 一行文字\n */\n/* stylelint-disable */\n/**\n * [commonClearfix 清除浮动]\n * @return {[type]} [description]\n */\n/* Var\n -------------------------- */\n/* Func\n -------------------------- */\n/* Mix\n -------------------------- */\n/**\n * @param $root: 默认置顶\n */\n/**\n * 1. +, >, ~, ' '\n * 2. 同element\n * 3. 同modifier\n * 4. 同block\n */\n/**\n * -> [className].is_require \n * 与xxx:hover类似\n */\n/**\n * 用 @at-root 来重置 & 读取次数的计数\n * 如 [clsssName] [className]:hover\n */\n/**\n * 自定义规则\n */\n/**\n * TODO: 使用vc-scroller;\n */\n.vm-frame-draggable--inner {\n  flex: 1;\n  overflow: hidden;\n  background: #d9d9d9;\n  display: flex;\n  flex-direction: column;\n  position: relative;\n  border-left: 1px solid #BDBDBD;\n}\n.vm-frame-draggable--inner.is-hide-border {\n  border-left: none;\n  border-right: none;\n}\n\n/*# sourceMappingURL=inner.vue.map */",'<template>\n\t<div :class="{ \'is-hide-border\': !showRuler }" class="vm-frame-draggable--inner">\n\t\t<vm-ruler\n\t\t\tv-if="showRuler"\n\t\t\tref="ruler"\n\t\t\t:scroll-left="scrollLeft"\n\t\t\t:scroll-top="scrollTop"\n\t\t\t:frame-w="frameW"\n\t\t\t:frame-h="frameH"\n\t\t\t:client-w="clientW"\n\t\t\t:client-h="clientH"\n\t\t\t:scale="scale"\n\t\t\t:guides="guides"\n\t\t\t:theme="theme"\n\t\t\t:border-size="borderSize"\n\t\t\t:scroller-size="scrollerSize"\n\t\t\t:style="{ height: `calc(100% - ${zoomBarH}px)` }"\n\t\t\t@guides-change="$emit(\'update:guides\', arguments[0])"\n\t\t>\n\t\t\t<slot name="content" />\n\t\t</vm-ruler>\n\t\t<slot v-else name="content" />\n\t\t<slot name="content-extra" />\n\t\t<slot name="footer" />\n\t</div>\n</template>\n\n<script>\nimport Ruler from \'./ruler.vue\';\nimport { Resize } from \'../../../vc\';\nimport { throttle } from \'../../../utils/helper\';\n\nexport default {\n\tname: \'vm-frame-inner\',\n\tcomponents: {\n\t\t\'vm-ruler\': Ruler\n\t},\n\tprops: {\n\t\tshowRuler: Boolean,\n\t\tshowZoomBar: Boolean,\n\t\tzoomBarH: Number,\n\t\tscrollerSize: Number,\n\t\t...Ruler.props,\n\t},\n\tmounted() {\n\t\tResize.on(this.$el, this.handleResize);\n\t},\n\tdestroyed() {\n\t\tResize.off(this.$el, this.handleResize);\n\t},\n\tmethods: {\n\t\thandleResize: throttle(function (e) {\n\t\t\tif (!this.$el) return;\n\n\t\t\tlet offset = +(this.$refs.ruler && (this.$refs.ruler.guideSize));\n\n\t\t\t/**\n\t\t\t * TDOO: 判断是否有滚动条\n\t\t\t * offsetWidth包含滚动条\n\t\t\t * clientWidth不包含滚动条;\n\t\t\t * offsetWidth === clientWidth 时不含滚动条，不需要减去scrollerSize（合理些，未测试）\n\t\t\t */\n\t\t\tlet w = this.$el.offsetWidth - offset - this.scrollerSize;\n\t\t\tlet h = this.$el.offsetHeight - offset - this.zoomBarH - this.scrollerSize;\n\n\t\t\tif (!w || !h) return;\n\n\t\t\t// 获得除rule内，zoom-bar上的控制操作空间\n\t\t\tthis.$emit(\n\t\t\t\t\'client-resize\', \n\t\t\t\tw, \n\t\t\t\th,\n\t\t\t);\n\t\t}, 50),\n\t}\n};\n<\/script>\n\n<style lang="scss">\n@import "../../../style/index.scss";\n\n$block: vm-frame-draggable--inner;\n@include block($block) {\n\tflex: 1;\n\toverflow: hidden;\n\tbackground: $theme-light-frame-bg;\n\t\n\tdisplay: flex; \n\tflex-direction: column;\n\tposition: relative;\n\t\n\tborder-left: 1px solid #BDBDBD;\n\t@include when(hide-border) {\n\t\tborder-left: none; \n\t\tborder-right: none; \n\t}\n}\n</style>']},media:void 0})}),On,void 0,!1,void 0,!1,yt,void 0,void 0),Tn=[{label:"10%",value:.1},{label:"50%",value:.5},{label:"100%",value:1},{label:"150%",value:1.5},{label:"200%",value:2}],Fn={name:"vm-zoom-bar",components:{"vc-slider":j.default,"vc-select":H.default,"vc-option":q.default},props:{scale:{type:Number,default:1},theme:String,h:{type:Number,default:0},frameW:{type:Number,default:0},frameH:{type:Number,default:0},clientW:{type:Number,default:0},clientH:{type:Number,default:0},borderSize:{type:Object,default:function(){return{top:0,left:0,bottom:0,right:0}}}},data:function(){return{zoomBarH:40,currentScale:1,currentSelect:1}},computed:{combo:function(){for(var t=this.$parent;t&&!t.VMComboId;)t=t.$parent;return t},autoScale:function(){var t=this.frameW,n=this.frameH,e=this.clientW,i=this.clientH,r=this.borderSize;return t&&n&&e&&i?Math.min((e-r.left-r.right)/t,(i-r.top-r.bottom)/n,1):1},options:function(){var t=this;return!this.autoScale||Tn.some((function(n){return n.value===t.autoScale}))?Tn:Tn.concat([{label:"自适应",value:this.autoScale}])}},watch:{scale:{immediate:!0,handler:function(t){this.currentScale=t,this.currentPlaceholder=(100*t).toFixed(0)+"%"}}},mounted:function(){this.resetScale(0),this.combo&&(this.combo.resetScale=this.resetScale)},methods:{handleChangeSlider:function(t){this.$emit("update:scale",this.currentScale)},handleChangeSelect:function(t){this.$emit("update:scale",this.currentScale)},resetScale:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;setTimeout((function(){t.currentScale=t.autoScale,t.$emit("update:scale",t.currentScale)}),n)}}},Nn=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"vm-zoom-bar vm-hack-editor",style:{height:t.h+"px"}},[e("div",{staticClass:"vm-zoom-bar__wrapper"},[e("vc-select",{staticStyle:{width:"75px"},attrs:{placeholder:t.currentPlaceholder,"portal-class-name":["vm-zoom-bar__select",{"is-dark":"dark"===t.theme}]},on:{change:t.handleChangeSelect},model:{value:t.currentScale,callback:function(n){t.currentScale=n},expression:"currentScale"}},t._l(t.options,(function(n,i){return e("vc-option",{key:i,attrs:{value:n.value}},[t._v("\n\t\t\t\t"+t._s(n.label)+"\n\t\t\t")])})),1),t._v(" "),e("vc-slider",{staticStyle:{width:"160px","margin-left":"16px","margin-right":"15px"},attrs:{step:.01,min:.5,max:2,formatter:function(t){return(100*t).toFixed(0)+"%"}},on:{change:t.handleChangeSlider},model:{value:t.currentScale,callback:function(n){t.currentScale=n},expression:"currentScale"}})],1)])};Nn._withStripped=!0;var Un=vt({render:Nn,staticRenderFns:[]},(function(t){t&&t("data-v-56a03c3e_0",{source:"@charset \"UTF-8\";\n/**\n * [commonDirectionFill 方向名词补充]\n * @param  {[string]} $key [l r b t]\n * @return {[string]}      [left right bottom top]\n */\n/**\n * [commonColumnWidth 平均分配百分比]\n * @param  {[number]} $col   [所占比]\n * @param  {[number]} $total [总]\n * @return {[number]}        [所占比/总 * 100%]\n */\n/**\n * [commonBorder 1px的兼容问题]\n * @param  {[string]} $border: ltbr          [border的方向缩写拼接]\n * @return {[type]}          [1px border]\n */\n/**\n * 1px\n * 已为父元素添加position: relative;\n * 其他只操作before和after;\n * 暂时不抽离公用\n */\n/**\n * [commonPadding padding]\n * @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonMargin margin]\n* @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonAbsolute absolute]\n * @param  {[list]} $direction-val... [top, right, bottom, left 的值]\n * @return {[type]}                   [description]\n */\n/**\n * 水平垂直居中\n */\n/**\n * 文字相关\n */\n/**\n * 一行文字\n */\n/* stylelint-disable */\n/**\n * [commonClearfix 清除浮动]\n * @return {[type]} [description]\n */\n/* Var\n -------------------------- */\n/* Func\n -------------------------- */\n/* Mix\n -------------------------- */\n/**\n * @param $root: 默认置顶\n */\n/**\n * 1. +, >, ~, ' '\n * 2. 同element\n * 3. 同modifier\n * 4. 同block\n */\n/**\n * -> [className].is_require \n * 与xxx:hover类似\n */\n/**\n * 用 @at-root 来重置 & 读取次数的计数\n * 如 [clsssName] [className]:hover\n */\n/**\n * 自定义规则\n */\n/**\n * TODO: 使用vc-scroller;\n */\n.vm-zoom-bar {\n  z-index: 2;\n  background: #efefef;\n  -webkit-box-shadow: 0px -2px 10px 0px rgba(0, 0, 0, 0.08);\n          box-shadow: 0px -2px 10px 0px rgba(0, 0, 0, 0.08);\n}\n.vm-zoom-bar__wrapper {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: end;\n  -webkit-justify-content: flex-end;\n      -ms-flex-pack: end;\n          justify-content: flex-end;\n}\n\n/*# sourceMappingURL=zoom-bar.vue.map */",map:{version:3,sources:["zoom-bar.vue","/Users/deot/Desktop/wya/github/wya-vm/src/combo/frame/draggable/zoom-bar.vue"],names:[],mappings:"AAAA,gBAAgB;AAChB;;;;EAIE;AACF;;;;;EAKE;AACF;;;;EAIE;AACF;;;;;EAKE;AACF;;;;;;;EAOE;AACF;;;;;;;EAOE;AC8KF;;;;EAAA;ADxKA;;EAEE;AACF;;EAEE;AACF;;EAEE;AACF,sBAAsB;AACtB;;;EAGE;AACF;6BAC6B;AAC7B;6BAC6B;AAC7B;6BAC6B;AAC7B;;EAEE;AACF;;;;;EAKE;AACF;;;EAGE;AACF;;;EAGE;ACmIF;;EAAA;AD/HA;;EAEE;AACF;ECqHA,UAAA;EACA,mBAAA;EACA,yDAAA;UAAA,iDAAA;ADnHA;AACA;ECoHA,oBAAA;EAAA,qBAAA;EAAA,oBAAA;EAAA,aAAA;EACA,yBAAA;EAAA,2BAAA;MAAA,sBAAA;UAAA,mBAAA;EACA,qBAAA;EAAA,iCAAA;MAAA,kBAAA;UAAA,yBAAA;ADlHA;;AAEA,uCAAuC",file:"zoom-bar.vue",sourcesContent:["@charset \"UTF-8\";\n/**\n * [commonDirectionFill 方向名词补充]\n * @param  {[string]} $key [l r b t]\n * @return {[string]}      [left right bottom top]\n */\n/**\n * [commonColumnWidth 平均分配百分比]\n * @param  {[number]} $col   [所占比]\n * @param  {[number]} $total [总]\n * @return {[number]}        [所占比/总 * 100%]\n */\n/**\n * [commonBorder 1px的兼容问题]\n * @param  {[string]} $border: ltbr          [border的方向缩写拼接]\n * @return {[type]}          [1px border]\n */\n/**\n * 1px\n * 已为父元素添加position: relative;\n * 其他只操作before和after;\n * 暂时不抽离公用\n */\n/**\n * [commonPadding padding]\n * @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonMargin margin]\n* @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonAbsolute absolute]\n * @param  {[list]} $direction-val... [top, right, bottom, left 的值]\n * @return {[type]}                   [description]\n */\n/**\n * 水平垂直居中\n */\n/**\n * 文字相关\n */\n/**\n * 一行文字\n */\n/* stylelint-disable */\n/**\n * [commonClearfix 清除浮动]\n * @return {[type]} [description]\n */\n/* Var\n -------------------------- */\n/* Func\n -------------------------- */\n/* Mix\n -------------------------- */\n/**\n * @param $root: 默认置顶\n */\n/**\n * 1. +, >, ~, ' '\n * 2. 同element\n * 3. 同modifier\n * 4. 同block\n */\n/**\n * -> [className].is_require \n * 与xxx:hover类似\n */\n/**\n * 用 @at-root 来重置 & 读取次数的计数\n * 如 [clsssName] [className]:hover\n */\n/**\n * 自定义规则\n */\n/**\n * TODO: 使用vc-scroller;\n */\n.vm-zoom-bar {\n  z-index: 2;\n  background: #efefef;\n  box-shadow: 0px -2px 10px 0px rgba(0, 0, 0, 0.08);\n}\n.vm-zoom-bar__wrapper {\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n}\n\n/*# sourceMappingURL=zoom-bar.vue.map */",'<template>\n\t<div class="vm-zoom-bar vm-hack-editor" :style="{ height: `${h}px` }">\n\t\t<div class="vm-zoom-bar__wrapper">\n\t\t\t<vc-select\n\t\t\t\tv-model="currentScale"\n\t\t\t\t:placeholder="currentPlaceholder"\n\t\t\t\t:portal-class-name="[\'vm-zoom-bar__select\', { \'is-dark\': theme === \'dark\' }]"\n\t\t\t\tstyle="width: 75px"\n\t\t\t\t@change="handleChangeSelect"\n\t\t\t>\n\t\t\t\t<vc-option\n\t\t\t\t\tv-for="(item, index) in options"\n\t\t\t\t\t:key="index"\n\t\t\t\t\t:value="item.value"\n\t\t\t\t>\n\t\t\t\t\t{{ item.label }}\n\t\t\t\t</vc-option>\n\t\t\t</vc-select>\n\t\t\t<vc-slider\n\t\t\t\tv-model="currentScale"\n\t\t\t\t:step="0.01"\n\t\t\t\t:min="0.5"\n\t\t\t\t:max="2"\n\t\t\t\t:formatter="v => (v * 100).toFixed(0) + \'%\'"\n\t\t\t\tstyle="width: 160px; margin-left: 16px; margin-right: 15px;"\n\t\t\t\t@change="handleChangeSlider"\n\t\t\t/>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport { Slider, Select, Option } from \'../../../vc\';\n\nconst OPTIONS = [\n\t{\n\t\tlabel: \'10%\',\n\t\tvalue: 0.1\n\t},\n\t{\n\t\tlabel: \'50%\',\n\t\tvalue: 0.5\n\t},\n\t{\n\t\tlabel: \'100%\',\n\t\tvalue: 1\n\t},\n\t{\n\t\tlabel: \'150%\',\n\t\tvalue: 1.5\n\t},\n\t{\n\t\tlabel: \'200%\',\n\t\tvalue: 2\n\t}\n];\n\nexport default {\n\tname: \'vm-zoom-bar\',\n\tcomponents: {\n\t\t\'vc-slider\': Slider,\n\t\t\'vc-select\': Select,\n\t\t\'vc-option\': Option\n\t},\n\tprops: {\n\t\tscale: {\n\t\t\ttype: Number,\n\t\t\tdefault: 1\n\t\t},\n\t\ttheme: String,\n\n\t\th: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\n\t\tframeW: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\n\t\tframeH: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\n\t\tclientW: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\n\t\tclientH: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\n\t\tborderSize: {\n\t\t\ttype: Object,\n\t\t\tdefault() {\n\t\t\t\treturn {\n\t\t\t\t\ttop: 0,\n\t\t\t\t\tleft: 0,\n\t\t\t\t\tbottom: 0,\n\t\t\t\t\tright: 0\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tzoomBarH: 40,\n\t\t\tcurrentScale: 1,\n\t\t\tcurrentSelect: 1,\n\t\t};\n\t},\n\tcomputed: {\n\t\tcombo() {\n\t\t\tlet parent = this.$parent;\n\t\t\twhile (parent && !parent.VMComboId) {\n\t\t\t\tparent = parent.$parent;\n\t\t\t}\n\t\t\treturn parent;\n\t\t},\n\n\t\tautoScale() {\n\t\t\tlet { frameW, frameH, clientW, clientH, borderSize } = this;\n\t\t\t\n\t\t\tif (!frameW \n\t\t\t\t|| !frameH \n\t\t\t\t|| !clientW \n\t\t\t\t|| !clientH\n\t\t\t) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\treturn Math.min(\n\t\t\t\t(clientW - borderSize.left - borderSize.right) / frameW, \n\t\t\t\t(clientH - borderSize.top - borderSize.bottom) / frameH, \n\t\t\t\t1\n\t\t\t);\n\t\t},\n\n\t\toptions() {\n\t\t\tif (!this.autoScale \n\t\t\t\t|| OPTIONS.some(i => i.value === this.autoScale)\n\t\t\t) {\n\t\t\t\treturn OPTIONS;\n\t\t\t}\n\n\t\t\treturn OPTIONS.concat([\n\t\t\t\t{\n\t\t\t\t\tlabel: \'自适应\',\n\t\t\t\t\tvalue: this.autoScale\n\t\t\t\t}\n\t\t\t]);\n\t\t}\n\t},\n\twatch: {\n\t\tscale: {\n\t\t\timmediate: true,\n\t\t\thandler(v) {\n\t\t\t\tthis.currentScale = v;\n\t\t\t\tthis.currentPlaceholder = (v * 100).toFixed(0) + \'%\';\n\t\t\t}\n\t\t},\n\t\t// 被吐槽， 变化太频繁（宽度变化会影响）\n\t\t// clientW() {\n\t\t// \tthis.resetScale()\n\t\t// }\n\t},\n\tmounted() {\n\t\tthis.resetScale(0);\n\n\t\t// 特殊API\n\t\tthis.combo && (this.combo.resetScale = this.resetScale);\n\t},\n\tmethods: {\n\t\thandleChangeSlider(v) {\n\t\t\tthis.$emit(\'update:scale\', this.currentScale);\n\t\t},\n\t\thandleChangeSelect(v) {\n\t\t\tthis.$emit(\'update:scale\', this.currentScale);\n\t\t},\n\n\t\t/**\n\t\t * pageEditor变化在store中有被调用\n\t\t * TODO: 去掉延迟\n\t\t * TODO: showRuler为false时，无效\n\t\t */\n\t\tresetScale(delay = 0) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.currentScale = this.autoScale;\n\t\t\t\tthis.$emit(\'update:scale\', this.currentScale);\n\t\t\t}, delay);\n\t\t}\n\t},\n};\n<\/script>\n\n<style lang="scss">\n@import "../../../style/index.scss";\n\n$block: vm-zoom-bar;\n@include block($block) { \n\tz-index: 2;\n\tbackground: $theme-light-zoom-bg;\n\tbox-shadow: 0px -2px 10px 0px rgba(0, 0, 0, 0.08);\n\t@include element(wrapper) {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: flex-end;\n\t}\n}\n</style>\n']},media:void 0})}),Fn,void 0,!1,void 0,!1,yt,void 0,void 0),Yn={name:"vm-thumbnail",components:{},props:{dataSource:{type:Array,default:function(){return[]}},scale:{type:Number,default:1},frameW:{type:Number,default:0},frameH:{type:Number,default:0},clientW:{type:Number,default:0},clientH:{type:Number,default:0},scrollTop:{type:Number,default:0},scrollLeft:{type:Number,default:0},theme:String,borderSize:{type:Object,default:function(){return{top:0,left:0,bottom:0,right:0}}},scrollerSize:{type:Number,default:0}},data:function(){return{width:192,height:108}},computed:{shrink:function(){var t=this.width,n=this.height,e=this.frameW,i=this.frameH,r=this.borderSize;return this.scale,Math.max((e+r.left+r.right)/t,(i+r.top+r.bottom)/n)},visibleStyle:function(){var t=this.width,n=this.height,e=this.clientW,i=this.clientH,r=this.scale,o=this.shrink,a=this.scrollLeft,s=this.scrollTop,l=Math.min(e/o/r,t),d=Math.min(i/o/r,n),A=a/o/r,c=s/o/r;return{width:"".concat(l,"px"),height:"".concat(d,"px"),left:"".concat(A+l>t?t-l:A,"px"),top:"".concat(c+d>n?n-d:c,"px")}},maxScrollLeft:function(){var t=this.frameW,n=this.clientW,e=this.borderSize,i=this.scale,r=this.scrollerSize;return t*i-n+e.left+e.right+r},maxScrollTop:function(){var t=this.frameH,n=this.clientH,e=this.borderSize,i=this.scale,r=this.scrollerSize;return t*i-n+e.top+e.bottom+r}},created:function(){var t=this,n=o.debounce(this.repaint,50);["dataSource","frameW","frameH","scale","clientW","clientH","theme"].forEach((function(e){return t.$watch(e,n,{deep:!0})}))},mounted:function(){this.repaint()},destroyed:function(){this.operateDOMEvents("remove")},methods:{repaint:function(){var t=this.$refs.canvas;if(this._isMounted&&t){var n=this.dataSource,e=this.shrink,i=t.getContext("2d");t.height=t.height,i.beginPath(),i.translate(40/e,40/e),i.save(),n.forEach((function(t){if("page"!==t.module&&t.module!==Z){var n=t.x,r=t.y,o=t.w,a=t.h,s=t.r;i.translate((n+o/2)/e,(r+a/2)/e),i.fillStyle="#DBDBDB",i.rotate(s*Math.PI/180),i.fillRect(-o/2/e,-a/2/e,o/e,a/e),i.restore(),i.save()}}))}},operateDOMEvents:function(t){var n="add"===t?document.documentElement.addEventListener:document.documentElement.removeEventListener;n("mouseup",this.handleMouseUp),n("mousemove",this.handleMouseMove)},handleMouseDown:function(t){G.default.clearSelection(),this.lastMouseX=t.clientX,this.lastMouseY=t.clientY,this.operateDOMEvents("add")},handleMouseMove:function(t){var n=this.scrollLeft,e=this.scrollTop,i=this.shrink,r=this.scale,o=this.maxScrollLeft,a=this.maxScrollTop,s=t.clientX,l=t.clientY,d=s-this.lastMouseX,A=l-this.lastMouseY;this.lastMouseX=s,this.lastMouseY=l;var c=n+d*i*r,m=e+A*i*r;c>o&&(c=o),m>a&&(m=a),c<0&&(c=0),m<0&&(m=0),this.$emit("scroll",c,m)},handleMouseUp:function(){G.default.clearSelection(),this.operateDOMEvents("remove")}}},Ln=function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"vm-thumbnail vm-hack-editor"},[n("div",{staticStyle:{position:"relative"}},[n("canvas",{ref:"canvas",attrs:{width:this.width,height:this.height}}),this._v(" "),n("div",{staticClass:"vm-thumbnail__visible",style:this.visibleStyle,on:{mousedown:this.handleMouseDown}})])])};Ln._withStripped=!0;var In=vt({render:Ln,staticRenderFns:[]},(function(t){t&&t("data-v-431afab2_0",{source:"@charset \"UTF-8\";\n/**\n * [commonDirectionFill 方向名词补充]\n * @param  {[string]} $key [l r b t]\n * @return {[string]}      [left right bottom top]\n */\n/**\n * [commonColumnWidth 平均分配百分比]\n * @param  {[number]} $col   [所占比]\n * @param  {[number]} $total [总]\n * @return {[number]}        [所占比/总 * 100%]\n */\n/**\n * [commonBorder 1px的兼容问题]\n * @param  {[string]} $border: ltbr          [border的方向缩写拼接]\n * @return {[type]}          [1px border]\n */\n/**\n * 1px\n * 已为父元素添加position: relative;\n * 其他只操作before和after;\n * 暂时不抽离公用\n */\n/**\n * [commonPadding padding]\n * @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonMargin margin]\n* @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonAbsolute absolute]\n * @param  {[list]} $direction-val... [top, right, bottom, left 的值]\n * @return {[type]}                   [description]\n */\n/**\n * 水平垂直居中\n */\n/**\n * 文字相关\n */\n/**\n * 一行文字\n */\n/* stylelint-disable */\n/**\n * [commonClearfix 清除浮动]\n * @return {[type]} [description]\n */\n/* Var\n -------------------------- */\n/* Func\n -------------------------- */\n/* Mix\n -------------------------- */\n/**\n * @param $root: 默认置顶\n */\n/**\n * 1. +, >, ~, ' '\n * 2. 同element\n * 3. 同modifier\n * 4. 同block\n */\n/**\n * -> [className].is_require \n * 与xxx:hover类似\n */\n/**\n * 用 @at-root 来重置 & 读取次数的计数\n * 如 [clsssName] [className]:hover\n */\n/**\n * 自定义规则\n */\n/**\n * TODO: 使用vc-scroller;\n */\n.vm-thumbnail {\n  position: absolute;\n  bottom: 50px;\n  right: 10px;\n  background: #efefef;\n  border: 1px solid #5495f6;\n  z-index: 2;\n}\n.vm-thumbnail__visible {\n  position: absolute;\n  z-index: 2;\n  border: 1px solid #DBDBDB;\n  background: rgba(68, 68, 68, 0.5);\n  cursor: move;\n}\n\n/*# sourceMappingURL=thumbnail.vue.map */",map:{version:3,sources:["thumbnail.vue","/Users/deot/Desktop/wya/github/wya-vm/src/combo/frame/draggable/thumbnail.vue"],names:[],mappings:"AAAA,gBAAgB;AAChB;;;;EAIE;AACF;;;;;EAKE;AACF;;;;EAIE;AACF;;;;;EAKE;AACF;;;;;;;EAOE;AACF;;;;;;;EAOE;AACF;;;;EAIE;AACF;;EAEE;ACoMF;;EAAA;AAIA;;EAAA;ADjMA,sBAAsB;AACtB;;;EAGE;AACF;6BAC6B;AAC7B;6BAC6B;AAC7B;6BAC6B;AAC7B;;EAEE;AACF;;;;;EAKE;AACF;;;EAGE;AACF;;;EAGE;AACF;;EAEE;AACF;;EAEE;AACF;ECwJA,kBAAA;EACA,YAAA;EACA,WAAA;EACA,mBAAA;EACA,yBAAA;EACA,UAAA;ADtJA;AACA;ECuJA,kBAAA;EACA,UAAA;EACA,yBAAA;EACA,iCAAA;EACA,YAAA;ADrJA;;AAEA,wCAAwC",file:"thumbnail.vue",sourcesContent:["@charset \"UTF-8\";\n/**\n * [commonDirectionFill 方向名词补充]\n * @param  {[string]} $key [l r b t]\n * @return {[string]}      [left right bottom top]\n */\n/**\n * [commonColumnWidth 平均分配百分比]\n * @param  {[number]} $col   [所占比]\n * @param  {[number]} $total [总]\n * @return {[number]}        [所占比/总 * 100%]\n */\n/**\n * [commonBorder 1px的兼容问题]\n * @param  {[string]} $border: ltbr          [border的方向缩写拼接]\n * @return {[type]}          [1px border]\n */\n/**\n * 1px\n * 已为父元素添加position: relative;\n * 其他只操作before和after;\n * 暂时不抽离公用\n */\n/**\n * [commonPadding padding]\n * @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonMargin margin]\n* @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonAbsolute absolute]\n * @param  {[list]} $direction-val... [top, right, bottom, left 的值]\n * @return {[type]}                   [description]\n */\n/**\n * 水平垂直居中\n */\n/**\n * 文字相关\n */\n/**\n * 一行文字\n */\n/* stylelint-disable */\n/**\n * [commonClearfix 清除浮动]\n * @return {[type]} [description]\n */\n/* Var\n -------------------------- */\n/* Func\n -------------------------- */\n/* Mix\n -------------------------- */\n/**\n * @param $root: 默认置顶\n */\n/**\n * 1. +, >, ~, ' '\n * 2. 同element\n * 3. 同modifier\n * 4. 同block\n */\n/**\n * -> [className].is_require \n * 与xxx:hover类似\n */\n/**\n * 用 @at-root 来重置 & 读取次数的计数\n * 如 [clsssName] [className]:hover\n */\n/**\n * 自定义规则\n */\n/**\n * TODO: 使用vc-scroller;\n */\n.vm-thumbnail {\n  position: absolute;\n  bottom: 50px;\n  right: 10px;\n  background: #efefef;\n  border: 1px solid #5495f6;\n  z-index: 2;\n}\n.vm-thumbnail__visible {\n  position: absolute;\n  z-index: 2;\n  border: 1px solid #DBDBDB;\n  background: rgba(68, 68, 68, 0.5);\n  cursor: move;\n}\n\n/*# sourceMappingURL=thumbnail.vue.map */","<template>\n\t<div class=\"vm-thumbnail vm-hack-editor\">\n\t\t<div style=\"position: relative;\">\n\t\t\t<canvas\n\t\t\t\tref=\"canvas\"\n\t\t\t\t:width=\"width\"\n\t\t\t\t:height=\"height\"\n\t\t\t/>\n\t\t\t<div\n\t\t\t\t:style=\"visibleStyle\"\n\t\t\t\tclass=\"vm-thumbnail__visible\"\n\t\t\t\t@mousedown=\"handleMouseDown\"\n\t\t\t/>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport { Clipboard } from '../../../vc';\nimport { debounce } from '../../../utils/helper';\nimport { SELECTION_MODULE, PAGE_MOULE } from '../../../utils/constants';\n\nexport default {\n\tname: 'vm-thumbnail',\n\tcomponents: {\n\n\t},\n\tprops: {\n\t\tdataSource: {\n\t\t\ttype: Array,\n\t\t\tdefault() {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t},\n\n\t\tscale: {\n\t\t\ttype: Number,\n\t\t\tdefault: 1\n\t\t},\n\n\t\tframeW: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\n\t\tframeH: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\n\t\tclientW: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\n\t\tclientH: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\n\t\tscrollTop: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\n\t\tscrollLeft: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\t\ttheme: String,\n\t\tborderSize: {\n\t\t\ttype: Object,\n\t\t\tdefault() {\n\t\t\t\treturn {\n\t\t\t\t\ttop: 0,\n\t\t\t\t\tleft: 0,\n\t\t\t\t\tbottom: 0,\n\t\t\t\t\tright: 0\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\t\tscrollerSize: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t}\n\t},\n\tdata() {\n\t\treturn {\n\t\t\twidth: 192,\n\t\t\theight: 108\n\t\t};\n\t},\n\tcomputed: {\n\t\tshrink() {\n\t\t\tconst { width, height, frameW, frameH, borderSize, scale } = this;\n\t\t\treturn Math.max(\n\t\t\t\t(frameW + borderSize.left + borderSize.right) / width,\n\t\t\t\t(frameH + borderSize.top + borderSize.bottom) / height\n\t\t\t);\n\t\t},\n\t\tvisibleStyle() {\n\t\t\tconst { width, height, clientW, clientH, scale, shrink, scrollLeft, scrollTop } = this;\n\n\t\t\tlet visibleW = Math.min(clientW / shrink / scale, width);\n\t\t\tlet visibleH = Math.min(clientH / shrink / scale, height);\n\t\t\tlet left = scrollLeft / shrink / scale;\n\t\t\tlet top = scrollTop / shrink / scale;\n\n\t\t\treturn {\n\t\t\t\twidth: `${visibleW}px`,\n\t\t\t\theight: `${visibleH}px`,\n\t\t\t\tleft: `${left + visibleW > width ? width - visibleW : left}px`,\n\t\t\t\ttop: `${top + visibleH > height ? height - visibleH : top}px`\n\t\t\t};\n\t\t},\n\t\tmaxScrollLeft() {\n\t\t\tconst { frameW, clientW, borderSize, scale, scrollerSize } = this;\n\t\t\treturn frameW * scale - clientW + borderSize.left + borderSize.right + scrollerSize;\n\t\t},\n\t\tmaxScrollTop() {\n\t\t\tconst { frameH, clientH, borderSize, scale, scrollerSize } = this;\n\t\t\treturn frameH * scale - clientH + borderSize.top + borderSize.bottom + scrollerSize;\n\t\t}\n\t},\n\n\tcreated() {\n\t\tlet watchArr = [\n\t\t\t'dataSource',\n\t\t\t'frameW', \n\t\t\t'frameH', \n\t\t\t'scale', \n\t\t\t'clientW', \n\t\t\t'clientH',\n\t\t\t'theme'\n\t\t];\n\t\tlet hook = debounce(this.repaint, 50);\n\t\t\n\t\twatchArr.forEach(item => this.$watch(item, hook, { deep: true }));\n\t},\n\n\tmounted() {\n\t\tthis.repaint();\n\t},\n\n\tdestroyed() {\n\t\tthis.operateDOMEvents('remove');\n\t},\n\n\tmethods: {\n\t\trepaint() {\n\t\t\tlet canvas = this.$refs.canvas;\n\n\t\t\tif (!this._isMounted || !canvas) return;\n\n\t\t\tlet { dataSource, shrink } = this;\n\t\t\tlet ctx = canvas.getContext('2d');\n\n\t\t\t// 重设高度，清空画布\n\t\t\tcanvas.height = canvas.height; // eslint-disable-line\n\n\t\t\tctx.beginPath();\n\t\t\tctx.translate(40 / shrink, 40 / shrink);\n\t\t\tctx.save();\n\t\t\tdataSource.forEach(item => {\n\t\t\t\tif (item.module === PAGE_MOULE || item.module === SELECTION_MODULE) return;\n\n\t\t\t\tlet { x, y, w, h, r } = item;\n\t\t\t\tctx.translate(\n\t\t\t\t\t(x + w / 2) / shrink,\n\t\t\t\t\t(y + h / 2) / shrink\n\t\t\t\t);\n\t\t\t\tctx.fillStyle = '#DBDBDB';\n\t\t\t\tctx.rotate(r * Math.PI / 180);\n\t\t\t\tctx.fillRect(\n\t\t\t\t\t-w / 2 / shrink,\n\t\t\t\t\t-h / 2 / shrink,\n\t\t\t\t\tw / shrink,\n\t\t\t\t\th / shrink\n\t\t\t\t);\n\t\t\t\tctx.restore();\n\t\t\t\tctx.save();\n\t\t\t});\n\t\t},\n\n\t\toperateDOMEvents(type) {\n\t\t\tlet fn = type === 'add' \n\t\t\t\t? document.documentElement.addEventListener \n\t\t\t\t: document.documentElement.removeEventListener;\n\n\t\t\tfn('mouseup', this.handleMouseUp);\n\t\t\tfn('mousemove', this.handleMouseMove);\n\t\t},\n\t\thandleMouseDown(e) {\n\t\t\tClipboard.clearSelection();\n\t\t\t\n\t\t\tthis.lastMouseX = e.clientX;\n\t\t\tthis.lastMouseY = e.clientY;\n\n\t\t\tthis.operateDOMEvents('add');\n\t\t},\n\n\t\thandleMouseMove(e) {\n\t\t\tconst { scrollLeft, scrollTop, shrink, scale, maxScrollLeft, maxScrollTop } = this;\n\n\t\t\tlet mouseX = e.clientX;\n\t\t\tlet mouseY = e.clientY;\n\t\t\tlet diffX = mouseX - this.lastMouseX;\n\t\t\tlet diffY = mouseY - this.lastMouseY;\n\n\t\t\tthis.lastMouseX = mouseX;\n\t\t\tthis.lastMouseY = mouseY;\n\n\t\t\tlet x = scrollLeft + diffX * shrink * scale;\n\t\t\tlet y = scrollTop + diffY * shrink * scale;\n\n\t\t\tx > maxScrollLeft && (x = maxScrollLeft);\n\t\t\ty > maxScrollTop && (y = maxScrollTop);\n\n\t\t\t// maxScrollLeft / maxScrollTop 自适应下宽度不够, 计算为零\n\t\t\tx < 0 && (x = 0);\n\t\t\ty < 0 && (y = 0);\n\n\t\t\tthis.$emit('scroll', x, y);\n\t\t},\n\n\t\thandleMouseUp() {\n\t\t\tClipboard.clearSelection();\n\t\t\tthis.operateDOMEvents('remove');\n\t\t}\n\n\t},\n};\n<\/script>\n\n<style lang=\"scss\">\n@import \"../../../style/index.scss\";\n\n$block: vm-thumbnail;\n@include block($block) {\n\tposition: absolute;\n\tbottom: 50px;\n\tright: 10px;\n\tbackground: $theme-light-bg;\n\tborder: 1px solid $primary;\n\tz-index: 2;\n\t@include element(visible) {\n\t\tposition: absolute;\n\t\tz-index: 2;\n\t\tborder: 1px solid #DBDBDB;\n\t\tbackground: rgba(68, 68, 68, 0.5);\n\t\tcursor: move;\n\t}\n}\n</style>\n"]},media:void 0})}),Yn,void 0,!1,void 0,!1,yt,void 0,void 0),Rn={name:"vm-right-menu",components:{"vc-icon":V.default},props:{event:MouseEvent,dataSource:{type:Object,default:function(){return{}}},filter:{type:Function,default:function(){return function(){return!0}}},icons:{type:Object,default:function(){return nt}}},data:function(){return{visible:!1,wrapHeight:175,menuName:tt,menu:Object.keys(Q).map((function(t){return Q[t]})).filter(this.filter)}},computed:{top:function(){return window.innerHeight-this.event.clientY<this.wrapHeight?this.event.clientY-this.wrapHeight:this.event.clientY}},mounted:function(){this.visible=!0,this.operateDOMEvents("add")},destroyed:function(){this.operateDOMEvents("remove")},methods:{handleClick:function(t){this.visible=!1,this.$emit("sure",t)},operateDOMEvents:function(t){("add"===t?document.documentElement.addEventListener:document.documentElement.removeEventListener)("click",this.handleDeselect)},handleDeselect:function(t){var n=this;(t.path||t.composedPath()||[]).some((function(t){return t===n.$el||t===n.event.target}))||(this.visible=!1,this.$emit("close"))}}},Wn=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],ref:"vm-right-menu",staticClass:"vm-right-menu",style:{left:t.event.clientX+"px",top:t.top+"px"}},[e("div",{staticClass:"vm-right-menu__content"},t._l(t.menu,(function(n){return e("div",{key:n,staticClass:"vm-right-menu__item",on:{click:function(e){return t.handleClick(n)},mousedown:function(t){t.stopPropagation()}}},[e("vc-icon",{staticClass:"vm-right-menu__icon",attrs:{type:t.icons[n]}}),t._v(" "),e("span",[t._v("\n\t\t\t\t"+t._s("function"==typeof t.menuName[n]?t.menuName[n](t.dataSource):t.menuName[n])+"\n\t\t\t")])],1)})),0)])};Wn._withStripped=!0;var Pn=vt({render:Wn,staticRenderFns:[]},(function(t){t&&t("data-v-5ab9fc75_0",{source:".vm-right-menu {\n  position: fixed;\n  z-index: 1999;\n  width: 104px;\n  background: #444;\n  padding: 6px 0px;\n  border: 1px solid #47DAFF;\n  border-radius: 4px;\n}\n.vm-right-menu .vm-right-menu__content {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n  -webkit-flex-direction: column;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n}\n.vm-right-menu .vm-right-menu__content .vm-right-menu__item {\n  height: 32px;\n  width: 100%;\n  line-height: 32px;\n  display: block;\n  color: #fff;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: start;\n  -webkit-justify-content: flex-start;\n      -ms-flex-pack: start;\n          justify-content: flex-start;\n  padding-left: 14px;\n  cursor: pointer;\n}\n.vm-right-menu .vm-right-menu__content .vm-right-menu__item:hover {\n  background: #343434;\n  color: #16F2F6;\n}\n.vm-right-menu .vm-right-menu__content .vm-right-menu__icon {\n  font-size: 12px;\n  margin-right: 8px;\n}\n\n/*# sourceMappingURL=right-menu.vue.map */",map:{version:3,sources:["/Users/deot/Desktop/wya/github/wya-vm/src/combo/frame/draggable/right-menu/right-menu.vue","right-menu.vue"],names:[],mappings:"AA6GA;EACA,eAAA;EACA,aAAA;EACA,YAAA;EACA,gBAAA;EACA,gBAAA;EACA,yBAAA;EACA,kBAAA;AC5GA;AD6GA;EACA,oBAAA;EAAA,qBAAA;EAAA,oBAAA;EAAA,aAAA;EACA,4BAAA;EAAA,6BAAA;EAAA,8BAAA;MAAA,0BAAA;UAAA,sBAAA;EACA,yBAAA;EAAA,2BAAA;MAAA,sBAAA;UAAA,mBAAA;AC3GA;AD4GA;EACA,YAAA;EACA,WAAA;EACA,iBAAA;EACA,cAAA;EACA,WAAA;EACA,oBAAA;EAAA,qBAAA;EAAA,oBAAA;EAAA,aAAA;EACA,yBAAA;EAAA,2BAAA;MAAA,sBAAA;UAAA,mBAAA;EACA,uBAAA;EAAA,mCAAA;MAAA,oBAAA;UAAA,2BAAA;EACA,kBAAA;EACA,eAAA;AC1GA;AD2GA;EACA,mBAAA;EACA,cAAA;ACzGA;AD4GA;EACA,eAAA;EACA,iBAAA;AC1GA;;AAEA,yCAAyC",file:"right-menu.vue",sourcesContent:["<template>\n\t<div\n\t\tv-show=\"visible\"\n\t\tref=\"vm-right-menu\"\n\t\t:style=\"{\n\t\t\tleft: `${event.clientX}px`,\n\t\t\ttop: `${top}px`\n\t\t}\"\n\t\tclass=\"vm-right-menu\"\n\t>\n\t\t<div class=\"vm-right-menu__content\">\n\t\t\t<div\n\t\t\t\tv-for=\"item in menu\"\n\t\t\t\t:key=\"item\"\n\t\t\t\tclass=\"vm-right-menu__item\"\n\t\t\t\t@click=\"handleClick(item)\"\n\t\t\t\t@mousedown.stop\n\t\t\t>\n\t\t\t\t<vc-icon\n\t\t\t\t\t:type=\"icons[item]\"\n\t\t\t\t\tclass=\"vm-right-menu__icon\"\n\t\t\t\t/>\n\t\t\t\t<span>\n\t\t\t\t\t{{ typeof menuName[item] === 'function' ? menuName[item](dataSource) : menuName[item] }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n<script>\nimport { Portal, Icon } from '../../../../vc';\nimport { RIGHT_MENU_MAP, RIGHT_MENU_NAME_MAP, RIGHT_MENU_ICON_MAP } from '../../../../utils/constants';\nimport { $ } from '../../../../utils/helper';\n\nexport default {\n\tname: 'vm-right-menu',\n\tcomponents: {\n\t\t'vc-icon': Icon\n\t},\n\tprops: {\n\t\tevent: MouseEvent,\n\t\tdataSource: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => ({})\n\t\t},\n\t\t// 用于右键过滤显示元素\n\t\tfilter: {\n\t\t\ttype: Function,\n\t\t\tdefault() {\n\t\t\t\treturn () => true;\n\t\t\t}\n\t\t},\n\t\ticons: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => {\n\t\t\t\treturn RIGHT_MENU_ICON_MAP;\n\t\t\t}\n\t\t}\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tvisible: false,\n\t\t\twrapHeight: 175,\n\t\t\tmenuName: RIGHT_MENU_NAME_MAP,\n\t\t\tmenu: Object.keys(RIGHT_MENU_MAP).map((key) => RIGHT_MENU_MAP[key]).filter(this.filter)\n\t\t};\n\t},\n\tcomputed: {\n\t\ttop() {\n\t\t\treturn (window.innerHeight - this.event.clientY) < this.wrapHeight\n\t\t\t\t? (this.event.clientY - this.wrapHeight) : this.event.clientY;\n\t\t}\n\t},\n\tmounted() {\n\t\tthis.visible = true;\n\t\tthis.operateDOMEvents('add');\n\t},\n\n\tdestroyed() {\n\t\tthis.operateDOMEvents('remove');\n\t},\n\tmethods: {\n\t\thandleClick(item) {\n\t\t\tthis.visible = false;\n\t\t\tthis.$emit('sure', item);\n\t\t},\n\n\t\toperateDOMEvents(type) {\n\t\t\tlet fn = type === 'add'\n\t\t\t\t? document.documentElement.addEventListener\n\t\t\t\t: document.documentElement.removeEventListener;\n\n\t\t\tfn('click', this.handleDeselect);\n\t\t},\n\n\t\thandleDeselect(e) {\n\t\t\tlet path = e.path || e.composedPath() || [];\n\t\t\tlet inArea = path.some(el => el === this.$el || el === this.event.target);\n\n\t\t\tif (!inArea) {\n\t\t\t\tthis.visible = false;\n\t\t\t\tthis.$emit('close');\n\t\t\t}\n\t\t}\n\t},\n};\n\n<\/script>\n<style lang=\"scss\">\n.vm-right-menu {\n\tposition: fixed;\n\tz-index: 1999;\n\twidth: 104px;\n\tbackground: #444;\n\tpadding: 6px 0px;\n\tborder: 1px solid #47DAFF;\n\tborder-radius:4px;\n\t.vm-right-menu__content {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\t.vm-right-menu__item {\n\t\t\theight: 32px;\n\t\t\twidth: 100%;\n\t\t\tline-height: 32px;\n\t\t\tdisplay: block;\n\t\t\tcolor: #fff;\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tjustify-content: flex-start;\n\t\t\tpadding-left: 14px;\n\t\t\tcursor: pointer;\n\t\t\t&:hover {\n\t\t\t\tbackground: #343434;\n\t\t\t\tcolor: #16F2F6;\n\t\t\t}\n\t\t}\n\t\t.vm-right-menu__icon {\n\t\t\tfont-size: 12px;\n\t\t\tmargin-right: 8px;\n\t\t}\n\n\t}\n}\n</style>\n",".vm-right-menu {\n  position: fixed;\n  z-index: 1999;\n  width: 104px;\n  background: #444;\n  padding: 6px 0px;\n  border: 1px solid #47DAFF;\n  border-radius: 4px;\n}\n.vm-right-menu .vm-right-menu__content {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n.vm-right-menu .vm-right-menu__content .vm-right-menu__item {\n  height: 32px;\n  width: 100%;\n  line-height: 32px;\n  display: block;\n  color: #fff;\n  display: flex;\n  align-items: center;\n  justify-content: flex-start;\n  padding-left: 14px;\n  cursor: pointer;\n}\n.vm-right-menu .vm-right-menu__content .vm-right-menu__item:hover {\n  background: #343434;\n  color: #16F2F6;\n}\n.vm-right-menu .vm-right-menu__content .vm-right-menu__icon {\n  font-size: 12px;\n  margin-right: 8px;\n}\n\n/*# sourceMappingURL=right-menu.vue.map */"]},media:void 0})}),Rn,void 0,!1,void 0,!1,yt,void 0,void 0),Xn=new X.default(Pn),jn={name:"vm-selection",props:{clientW:{type:Number,default:0},clientH:{type:Number,default:0},borderSize:{type:Object,default:function(){return{top:0,left:0}}}},data:function(){return{startX:0,startY:0,moveX:0,moveY:0,dragging:!1}},computed:{wrapperStyle:function(){var t=this.clientW,n=this.clientH,e=this.borderSize;return{width:"".concat(t,"px"),height:"".concat(n,"px"),top:"".concat(e.top,"px"),left:"".concat(e.left,"px")}},zIndexStyle:function(){return{zIndex:this.dragging?2:1}},d:function(){var t=this.startX,n=this.startY,e=this.moveX,i=this.moveY;return"M ".concat(t,",").concat(n," L ").concat(t,",").concat(i," L ").concat(e,",").concat(i," L ").concat(e,",").concat(n," z")}},mounted:function(){this.offsetX=this.$el.getBoundingClientRect().x,this.offsetY=this.$el.getBoundingClientRect().y},methods:{operateDOMEvents:function(t){var n="add"===t?document.documentElement.addEventListener:document.documentElement.removeEventListener;n("mouseup",this.handleMouseUp),n("mousemove",this.handleMouseMove)},handleMouseDown:function(t){G.default.clearSelection(),this.dragging=!0,this.startX=t.clientX-this.offsetX,this.startY=t.clientY-this.offsetY,this.moveX=this.startX,this.moveY=this.startY,this.operateDOMEvents("add")},handleMouseMove:function(t){this.moveX=t.clientX-this.offsetX,this.moveY=t.clientY-this.offsetY},handleMouseUp:function(){G.default.clearSelection(),this.dragging=!1,this.operateDOMEvents("remove");var t=this.startX>this.moveX?this.moveX:this.startX,n=this.startY>this.moveY?this.moveY:this.startY,e=Math.abs(this.startX-this.moveX),i=Math.abs(this.startY-this.moveY);this.$emit("selection",{x:t,y:n,w:e,h:i}),this.startX=0,this.startY=0,this.moveX=0,this.moveY=0}}},Hn=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("svg",{staticClass:"vm-selection",style:[t.wrapperStyle,t.zIndexStyle],attrs:{xmlns:"http://www.w3.org/2000/svg"},on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.handleMouseDown.apply(null,arguments)}}},[e("path",{attrs:{fill:"none",stroke:"#5495F6",d:t.d,"stroke-dasharray":"5, 2","stroke-width":"1","shape-rendering":"crispEdges"}})])};Hn._withStripped=!0;var qn=["id","history"];function Gn(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,i)}return e}function Vn(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?Gn(Object(e),!0).forEach((function(n){S.default(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Gn(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}var Kn=Q.TOP,Jn=Q.BOTTOM,Zn=Q.UP,Qn=Q.DOWN,te=Q.DELETE,ne=Q.SELECTION,ee=Q.LOCK,ie=Q.COPY,re=Q.PASTE,oe={name:"vm-frame",components:{"vm-draggable":$t,"vm-grid-lines":wn,"vm-align-lines":$n,"vm-inner":zn,"vm-zoom-bar":Un,"vm-thumbnail":In,"vm-selection":vt({render:Hn,staticRenderFns:[]},(function(t){t&&t("data-v-df483874_0",{source:"@charset \"UTF-8\";\n/**\n * [commonDirectionFill 方向名词补充]\n * @param  {[string]} $key [l r b t]\n * @return {[string]}      [left right bottom top]\n */\n/**\n * [commonColumnWidth 平均分配百分比]\n * @param  {[number]} $col   [所占比]\n * @param  {[number]} $total [总]\n * @return {[number]}        [所占比/总 * 100%]\n */\n/**\n * [commonBorder 1px的兼容问题]\n * @param  {[string]} $border: ltbr          [border的方向缩写拼接]\n * @return {[type]}          [1px border]\n */\n/**\n * 1px\n * 已为父元素添加position: relative;\n * 其他只操作before和after;\n * 暂时不抽离公用\n */\n/**\n * [commonPadding padding]\n * @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonMargin margin]\n* @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonAbsolute absolute]\n * @param  {[list]} $direction-val... [top, right, bottom, left 的值]\n * @return {[type]}                   [description]\n */\n/**\n * 水平垂直居中\n */\n/**\n * 文字相关\n */\n/**\n * 一行文字\n */\n/* stylelint-disable */\n/**\n * [commonClearfix 清除浮动]\n * @return {[type]} [description]\n */\n/* Var\n -------------------------- */\n/* Func\n -------------------------- */\n/* Mix\n -------------------------- */\n/**\n * @param $root: 默认置顶\n */\n/**\n * 1. +, >, ~, ' '\n * 2. 同element\n * 3. 同modifier\n * 4. 同block\n */\n/**\n * -> [className].is_require \n * 与xxx:hover类似\n */\n/**\n * 用 @at-root 来重置 & 读取次数的计数\n * 如 [clsssName] [className]:hover\n */\n/**\n * 自定义规则\n */\n/**\n * TODO: 使用vc-scroller;\n */\n.vm-selection {\n  position: absolute;\n}\n\n/*# sourceMappingURL=selection.vue.map */",map:{version:3,sources:["selection.vue","/Users/deot/Desktop/wya/github/wya-vm/src/combo/frame/draggable/selection.vue"],names:[],mappings:"AAAA,gBAAgB;AAChB;;;;EAIE;AACF;;;;;EAKE;AACF;;;;EAIE;AACF;;;;;EAKE;AACF;;;;;;;EAOE;AACF;;;;;;;EAOE;AACF;;;;EAIE;AACF;;EAEE;AACF;;EAEE;AACF;;EAEE;AACF,sBAAsB;AACtB;;;EAGE;AACF;6BAC6B;AAC7B;6BAC6B;AAC7B;6BAC6B;AAC7B;;EAEE;AACF;;;;;EAKE;AACF;;;EAGE;AACF;;;EAGE;AACF;;EAEE;AACF;;EAEE;ACyDF;EACA,kBAAA;ADvDA;;AAEA,wCAAwC",file:"selection.vue",sourcesContent:["@charset \"UTF-8\";\n/**\n * [commonDirectionFill 方向名词补充]\n * @param  {[string]} $key [l r b t]\n * @return {[string]}      [left right bottom top]\n */\n/**\n * [commonColumnWidth 平均分配百分比]\n * @param  {[number]} $col   [所占比]\n * @param  {[number]} $total [总]\n * @return {[number]}        [所占比/总 * 100%]\n */\n/**\n * [commonBorder 1px的兼容问题]\n * @param  {[string]} $border: ltbr          [border的方向缩写拼接]\n * @return {[type]}          [1px border]\n */\n/**\n * 1px\n * 已为父元素添加position: relative;\n * 其他只操作before和after;\n * 暂时不抽离公用\n */\n/**\n * [commonPadding padding]\n * @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonMargin margin]\n* @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonAbsolute absolute]\n * @param  {[list]} $direction-val... [top, right, bottom, left 的值]\n * @return {[type]}                   [description]\n */\n/**\n * 水平垂直居中\n */\n/**\n * 文字相关\n */\n/**\n * 一行文字\n */\n/* stylelint-disable */\n/**\n * [commonClearfix 清除浮动]\n * @return {[type]} [description]\n */\n/* Var\n -------------------------- */\n/* Func\n -------------------------- */\n/* Mix\n -------------------------- */\n/**\n * @param $root: 默认置顶\n */\n/**\n * 1. +, >, ~, ' '\n * 2. 同element\n * 3. 同modifier\n * 4. 同block\n */\n/**\n * -> [className].is_require \n * 与xxx:hover类似\n */\n/**\n * 用 @at-root 来重置 & 读取次数的计数\n * 如 [clsssName] [className]:hover\n */\n/**\n * 自定义规则\n */\n/**\n * TODO: 使用vc-scroller;\n */\n.vm-selection {\n  position: absolute;\n}\n\n/*# sourceMappingURL=selection.vue.map */",'<template>\n\t<svg \n\t\tclass="vm-selection" \n\t\txmlns="http://www.w3.org/2000/svg"\n\t\t:style="[wrapperStyle, zIndexStyle]" \n\t\t@mousedown.left="handleMouseDown"\n\t>\n\t\t<path \n\t\t\tfill="none" \n\t\t\tstroke="#5495F6"\n\t\t\t:d="d" \n\t\t\tstroke-dasharray="5, 2"\n\t\t\tstroke-width="1"\n\t\t\tshape-rendering="crispEdges"\n\t\t/>\n\t</svg>\n</template>\n<script>\nimport { Clipboard } from \'../../../vc\';\n\n/**\n * https://www.w3school.com.cn/svg/svg_path.asp\n * 它开始于位置 M 坐标，到达位置 L，然后从那里开始到 L，最后在 L 关闭路径。\n */\nexport default {\n\tname: "vm-selection",\n\tprops: {\n\t\tclientW: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\t\tclientH: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0\n\t\t},\n\t\tborderSize: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => ({\n\t\t\t\ttop: 0,\n\t\t\t\tleft: 0\n\t\t\t})\n\t\t}\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tstartX: 0,\n\t\t\tstartY: 0,\n\t\t\tmoveX: 0,\n\t\t\tmoveY: 0,\n\t\t\tdragging: false\n\t\t};\n\t},\n\tcomputed: {\n\t\t/**\n\t\t * 刻度的宽度\n\t\t */\n\t\twrapperStyle() {\n\t\t\tconst { clientW, clientH, borderSize } = this;\n\t\t\treturn {\n\t\t\t\twidth: `${clientW}px`,\n\t\t\t\theight: `${clientH}px`,\n\t\t\t\ttop: `${borderSize.top}px`,\n\t\t\t\tleft: `${borderSize.left}px`,\n\t\t\t};\n\t\t},\n\t\tzIndexStyle() {\n\t\t\treturn {\n\t\t\t\tzIndex: this.dragging ? 2 : 1\n\t\t\t};\n\t\t},\n\t\t/**\n\t\t * https://www.w3school.com.cn/svg/svg_path.asp\n\t\t * 它开始于位置 M 坐标，到达位置 L，然后从那里开始到 L，最后在 L 关闭路径。\n\t\t */\n\t\td() {\n\t\t\tconst { startX, startY, moveX, moveY } = this;\n\t\t\treturn `M ${startX},${startY} L ${startX},${moveY} L ${moveX},${moveY} L ${moveX},${startY} z`;\n\t\t}\n\t},\n\tmounted() { \n\t\tthis.offsetX = this.$el.getBoundingClientRect().x;\n\t\tthis.offsetY = this.$el.getBoundingClientRect().y;\n\t},\n\tmethods: {\n\t\toperateDOMEvents(type) {\n\t\t\tlet fn = type === \'add\'\n\t\t\t\t? document.documentElement.addEventListener\n\t\t\t\t: document.documentElement.removeEventListener;\n\n\t\t\tfn(\'mouseup\', this.handleMouseUp);\n\t\t\tfn(\'mousemove\', this.handleMouseMove);\n\t\t},\n\n\t\t/**\n\t\t * 外部可以模拟实现选区: 如page模块的viewer的空白区域\n\t\t * document\n\t\t * \t.querySelector(\'.vm-selection\')\n\t\t * \t.dispatchEvent(new MouseEvent(\'mousedown\', e));\n\t\t */\n\t\thandleMouseDown(e) {\n\t\t\tClipboard.clearSelection();\n\t\t\tthis.dragging = true;\n\t\t\tthis.startX = e.clientX - this.offsetX;\n\t\t\tthis.startY = e.clientY - this.offsetY;\n\n\t\t\tthis.moveX = this.startX;\n\t\t\tthis.moveY = this.startY;\n\n\t\t\tthis.operateDOMEvents(\'add\');\n\t\t},\n\n\t\thandleMouseMove(e) {\n\t\t\tthis.moveX = e.clientX - this.offsetX;\n\t\t\tthis.moveY = e.clientY - this.offsetY;\n\t\t},\n\n\t\thandleMouseUp() {\n\t\t\tClipboard.clearSelection();\n\t\t\tthis.dragging = false;\n\t\t\tthis.operateDOMEvents(\'remove\');\n\n\t\t\tlet x = this.startX > this.moveX ? this.moveX : this.startX;\n\t\t\tlet y = this.startY > this.moveY ? this.moveY : this.startY;\n\t\t\tlet w = Math.abs(this.startX - this.moveX);\n\t\t\tlet h = Math.abs(this.startY - this.moveY);\n\t\t\t// 初始位置，宽高\n\t\t\tthis.$emit(\'selection\', {\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t\tw,\n\t\t\t\th\n\t\t\t});\n\t\t\tthis.startX = 0;\n\t\t\tthis.startY = 0;\n\t\t\tthis.moveX = 0;\n\t\t\tthis.moveY = 0;\n\t\t}\n\t}\n};\n<\/script>\n<style lang="scss">\n@import "../../../style/index.scss";\n\n.vm-selection {\n\tposition: absolute;\n}\n</style>']},media:void 0})}),jn,void 0,!1,void 0,!1,yt,void 0,void 0)},props:{width:{type:Number,validator:function(t){return t>0}},height:{type:Number,validator:function(t){return t>0}},dataSource:Array,editor:Object,frameStyle:Object,showLines:{type:Boolean,default:!0},showRuler:{type:Boolean,default:!0},showZoomBar:{type:Boolean,default:!0},showThumbnail:{type:Boolean,default:!0},theme:String},data:function(){return{SELECTION_MODULE:Z,vm:{type:"frame"},scrollLeft:0,scrollTop:0,scale:1,xRuleLines:[],yRuleLines:[],clientW:0,clientH:0,guides:[[],[]],scrollerSize:4}},computed:{borderSize:function(){var t=this.showRuler?20:0;return{top:t,left:t,bottom:t,right:t}},zoomBarH:function(){return this.showZoomBar?40:0},wrapperStyle:function(){var t=this.borderSize,n=t.top,e=t.left;return t.bottom,t.right,{paddingTop:"".concat(n,"px"),paddingLeft:"".concat(e,"px")}},scrollStyle:function(){var t=this.borderSize;t.top,t.left;var n=t.bottom,e=t.right;return{width:"".concat(Math.max(this.clientW-e,this.width*this.scale+e),"px"),height:"".concat(this.height*this.scale+n,"px")}},contentStyle:function(){return{width:"".concat(this.width,"px"),height:"".concat(this.height,"px"),transform:"scale(".concat(this.scale,")"),transformOrigin:"0 0"}},scaleStyle:function(){return{zoom:this.scale}},footerStyle:function(){return{marginTop:"".concat((this.scale-1)*this.height/this.scale,"px")}},classes:function(){return{"is-dark":"dark"===this.theme}},selections:function(){var t=this.dataSource;return t.reduce((function(n,e){return e.module===Z&&e.selections.forEach((function(e){n[e]=t.find((function(t){return t.id===e}))})),n}),{})}},created:function(){this.dragOriginal={}},methods:{handleClientResize:function(t,n){this.$refs.wrapper&&(this.clientW=t,this.clientH=n)},handleScroll:function(t){this.scrollLeft=t.target.scrollLeft,this.scrollTop=t.target.scrollTop},handleScrollThumbnail:function(t,n){this.scrollLeft=t,this.$refs.wrapper.scrollLeft=t,this.scrollTop=n,this.$refs.wrapper.scrollTop=n},handleDrop:function(t){var n,e;try{e=JSON.parse(t.dataTransfer.getData("@wya/vm")||"")}catch(t){}var i=e||{},r=i.module,a=i.index;if(n=this.$parent.$options.modules[r])if(n.max&&n.max<=this.dataSource.filter((function(t){return t.module===r})).length)this.$emit("error",{type:"create",msg:"当前模块最多只能创建".concat(n.max,"个")});else{var s=this.$refs.content.getBoundingClientRect(),l=s.x,d=s.y,A=t.pageX||t.clientX+document.documentElement.scrollLeft||0,c=t.pageY||t.clientY+document.documentElement.scrollTop||0,m=lt(),u=this.dataSource.length,h=Vn(Vn({},o.cloneDeep("function"==typeof n.data?n.data(a,this.dataSource):n.data)),{},{module:r,id:m});t.fake||!h.draggable&&void 0!==h.draggable?(h.x=0,h.y=0):(h.x=Math.round((A-l)/this.scale),h.y=Math.round((c-d)/this.scale));var p={type:"CREATE",index:u,id:m,data:h};this.$emit("change",p),this.setActived(u)}},setActived:function(t){var n=this;this.$nextTick((function(){try{n.$refs.deactivated.dispatchEvent(new Event("mousedown")),n.$refs.draggable[t].setActived()}catch(t){console.error(t)}}))},setActivedById:function(t){this.setActived(this.dataSource.findIndex((function(n){return n.id===t})))},handleShowMenu:function(t,n){var e=this;return R.default(W.default.mark((function i(){var r,o,a,s,l;return W.default.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if((r=e.$parent.clipboardData)||"page"!==n.module){i.next=3;break}return i.abrupt("return");case 3:return i.prev=3,i.next=6,Xn.popup({event:t,dataSource:n,filter:function(t){return"page"===n.module?[re].includes(t):n.module===Z?[Kn,Jn,te,ne,ee,ie,re].includes(t):t!==ne&&(t!==re||r)}});case 6:if(o=i.sent,n.module!==Z||o!==Kn&&o!==Jn){i.next=16;break}return a=e.dataSource.map((function(t){return t.id})),s=function(){var t=e.selectMenu(o,n,!1)||{type:"DUMMY"};e.$emit("change",Vn(Vn({},t),{},{revert:n.selections.length}))},o===Jn&&s(),l=e.dataSource.slice().filter((function(t){return n.selections.includes(t.id)})).reverse().sort((function(t,n){return n.z-t.z})),(o===Kn?l.reverse():l).forEach((function(i){var r=e.selectMenu(t,o,i,!1)||{type:"DUMMY"};e.$emit("change",Vn(Vn({},r),{},{revert:n.selections.length}))})),o===Kn&&s(),a.every((function(t,n){return e.dataSource[n].id===t}))&&(e.$parent.store.removeHistory(n.selections.length+1),e.$emit("error",{type:"menu",msg:"您已经".concat(o===Kn?"置顶":"置底",", 无需操作")})),i.abrupt("return");case 16:e.selectMenu(t,o,n),i.next=22;break;case 19:i.prev=19,i.t0=i.catch(3),i.t0&&i.t0.message&&console.log(i.t0);case 22:case"end":return i.stop()}}),i,null,[[3,19]])})))()},selectMenu:function(t,n,e){var i,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=this.dataSource.slice().filter((function(t){return"page"!==t.module})).reverse().sort((function(t,n){return n.z-t.z})),a=o.findIndex((function(t){return t.id===e.id}));if(n!==te||!1!==e.closeable){var s;switch(n){case Kn:if(0===a)return;i=o[0];break;case Jn:if(a===o.length-1)return;i=o[o.length-1];break;case Zn:if(0===a)return;i=o[a-1];break;case Qn:if(a===o.length-1)return;i=o[a+1];break;case te:return s={type:"DELETE",id:e.id},r?void this.$parent.remove(e,!0):s;case ne:return s={type:"DELETE",id:e.id},r?void this.$emit("change",s):s;case ee:return s={type:"UPDATE",id:e.id,changed:{disabled:!e.disabled}},r?void this.$emit("change",s):s;case ie:return void this.$parent.copy(e);case re:var l=this.$refs.content.getBoundingClientRect(),d=l.x,A=l.y,c=t.pageX||t.clientX+document.documentElement.scrollLeft||0,m=t.pageY||t.clientY+document.documentElement.scrollTop||0;return d=Math.round((c-d)/this.scale),A=Math.round((m-A)/this.scale),void this.$parent.paste({x:d,y:A});default:return}var u=this.dataSource.findIndex((function(t){return t.id===e.id})),h=this.dataSource.findIndex((function(t){return t.id===i.id}));if(s={type:"SORT",changed:[u,h],history:!0},!r)return s;this.$emit("change",s)}},handleAttrChange:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if("object"===M.default(t)){var e=t.id,i=t.history,r=z.default(t,qn),o={};for(var a in r){var s=r[a];["x","y","z","r","w","h"].includes(a)&&(s=Number(s)),ot(r,a)&&!dt(s)&&(o[a]=s)}this.$emit("change",{type:"UPDATE",id:e||n.id,changed:o,history:i})}},handleSelection:function(t){for(var n=this,e=this.dataSource,i=this.scale,r=this.borderSize,o=this.$refs.header?this.$refs.header.clientHeight:0,a={x:this.scrollLeft+(t.x-r.left)/i,y:this.scrollTop+(t.y-r.top)/i-o,w:t.w/i,h:t.h/i},s=e.reduce((function(t,n){if(e=a,i=ct(n),r=ct(e),i.right<r.left||i.bottom<r.top||r.right<i.left||r.bottom<i.top||"page"===n.module)return t;var e,i,r,o;n.disabled&&n.module===Z&&(o=t.disabledIds).push.apply(o,J.default(n.selections));return n.disabled||(n.module===Z?t.selectionModules.push(n):t.selections.push(n)),t}),{selections:[],disabledIds:[],selectionModules:[]}),l=s.selections,d=s.selectionModules,A=s.disabledIds,c=(l=l.filter((function(t){return!A.includes(t.id)}))).map((function(t){return t.id})),m=function(t){if(c.every((function(n){return d[t].selections.includes(n)})))return n.setActivedById(d[t].id),{v:void 0}},u=0;u<d.length;u++){var h=m(u);if("object"===M.default(h))return h.v}if(l.length<=1){var p=0;return l.length&&(p=e.findIndex((function(t){return t.id===l[0].id}))),d.length&&(p=Math.max.apply(Math,[p].concat(J.default(d.map((function(t){return e.findIndex((function(n){return n.id===t.id}))})))))),void(p&&this.setActived(p))}var g=e.reduce((function(t,n){return n.module===Z&&c.some((function(t){return n.selections.includes(t)}))?(t.push({type:"DELETE",id:n.id}),t):t}),[]),f=lt(),b=l.reduce((function(t,n){return t.xs.push(n.x),t.xws.push(n.x+n.w),t.ys.push(n.y),t.yhs.push(n.y+n.h),t.zs.push(n.z),t.parent&&(t.parent=n.parent),t}),{xs:[],xws:[],ys:[],yhs:[],zs:[],parent:!0}),v=Math.min.apply(Math,J.default(b.xs)),x=Math.max.apply(Math,J.default(b.xws)),E=Math.min.apply(Math,J.default(b.ys)),y=Math.max.apply(Math,J.default(b.yhs));g.forEach((function(t){t.revert=g.length,n.$emit("change",t)}));var w=e.length,C={type:"CREATE",index:w,id:f,data:{x:v,y:E,w:x-v,h:y-E,z:Math.max.apply(Math,J.default(b.zs)),r:0,parent:b.parent,rotatable:!1,resizable:!1,closeable:!0,disabled:!1,active:!1,selections:c,module:Z,id:f},revert:g.length};this.$emit("change",C),this.setActived(w)},handleActivated:function(t,n){mt.debug("activated",n.module),this.$emit("activated",t,n),n.module===Z&&(this.dragOriginal[n.id]={x:n.x,y:n.y})},handleDeactivated:function(t,n){mt.debug("deactivated",n.module),this.$emit("deactivated",t,n)},handleDragging:function(t){var n=this;if(this.$emit("dragging",t),t.module===Z){var e=t.x-this.dragOriginal[t.id].x,i=t.y-this.dragOriginal[t.id].y;(e||i)&&t.selections&&t.selections.forEach((function(t){var r=n.selections[t],o=r.x,a=r.y;r.module,n.dragOriginal[t]||(n.dragOriginal[t]={x:o,y:a}),o=n.dragOriginal[t].x+e,a=n.dragOriginal[t].y+i,n.$emit("change",{type:"UPDATE",id:t,changed:{x:o,y:a},history:!1})}))}},handleDragEnd:function(t){mt.debug("drag-end",t.module),this.$emit("drag-end",t),t.module===Z&&(this.dragOriginal={},this.dragOriginal[t.id]={x:t.x,y:t.y})},handleEnd:function(t,n,e){var i=this;mt.debug("end",n.module);var r={type:"UPDATE",id:n.id,index:e,original:t,revert:n.selections&&n.selections.length};if(this.$emit("change",r),n.module===Z){var o=n.x-t.x,a=n.y-t.y;(o||a)&&n.selections&&n.selections.forEach((function(t){var e=i.selections[t],r=e.x,s=e.y;e.module,i.$emit("change",{type:"UPDATE",id:t,revert:n.selections&&n.selections.length,original:{x:r-o,y:s-a}})}))}}}},ae=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("vm-inner",{ref:"inner",staticClass:"vm-frame-draggable",class:t.classes,attrs:{"show-ruler":t.showRuler,"show-zoom-bar":t.showZoomBar,"scroll-left":t.scrollLeft,"scroll-top":t.scrollTop,"frame-w":t.width,"frame-h":t.height,"client-w":t.clientW,"client-h":t.clientH,"zoom-bar-h":t.zoomBarH,scale:t.scale,"border-size":t.borderSize,"scroller-size":t.scrollerSize,guides:t.guides,theme:t.theme},on:{"update:guides":function(n){t.guides=n},"client-resize":t.handleClientResize},scopedSlots:t._u([{key:"content",fn:function(){return[e("div",{ref:"wrapper",staticClass:"vm-frame-draggable__wrapper",style:t.wrapperStyle,on:{scroll:t.handleScroll}},[e("div",{ref:"deactivated"}),t._v(" "),e("vm-selection",{attrs:{"client-w":t.clientW,"client-h":t.clientH,"border-size":t.borderSize},on:{selection:t.handleSelection}}),t._v(" "),e("div",{style:t.scrollStyle},[e("div",{ref:"header",style:t.scaleStyle},[t._t("frame-header")],2),t._v(" "),e("div",{ref:"content",staticClass:"vm-frame-draggable__content",staticStyle:{position:"relative"},style:[t.contentStyle,t.frameStyle],on:{dragover:function(t){t.preventDefault()},drop:t.handleDrop}},[t.showLines?e("vm-grid-lines",{attrs:{width:t.width,height:t.height,grid:[10,10]}}):t._e(),t._v(" "),t.showLines?e("vm-align-lines",{attrs:{"data-source":t.dataSource,editor:t.editor}}):t._e(),t._v(" "),t._l(t.dataSource,(function(n,i){return e("vm-draggable",{key:n.id,ref:"draggable",refInFor:!0,attrs:{x:n.x,y:n.y,z:n.z,w:n.w,h:n.h,r:n.r,module:n.module,parent:n.parent,disabled:n.disabled||!!t.selections[n.id],handles:n.handles,"min-w":n.minW,"min-h":n.minH,scale:t.scale,grid:n.grid,guides:t.guides,offset:[t.scrollLeft||0,t.scrollTop||0],active:n.active,restrain:n.restrain,closeable:n.closeable||void 0===n.closeable,draggable:n.draggable||void 0===n.draggable,rotatable:n.rotatable||void 0===n.rotatable,resizable:n.resizable||void 0===n.resizable,prevent:!1},on:{"update:x":function(e){return t.$set(n,"x",e)},"update:y":function(e){return t.$set(n,"y",e)},"update:z":function(e){return t.$set(n,"z",e)},"update:w":function(e){return t.$set(n,"w",e)},"update:h":function(e){return t.$set(n,"h",e)},"update:r":function(e){return t.$set(n,"r",e)},delete:function(e){return t.$parent.remove(n,!0)},activated:function(e){return t.handleActivated(arguments[0],n)},deactivated:function(e){return t.handleDeactivated(arguments[0],n)},dragging:function(e){return t.handleDragging(n)},resizing:function(e){return t.$emit("resizing",n)},rotating:function(e){return t.$emit("rotating",n)},"resize-end":function(e){return t.$emit("resize-end",n)},"drag-end":function(e){return t.handleDragEnd(n)},end:function(e){return t.handleEnd(arguments[0],n,i)}},nativeOn:{contextmenu:function(e){return e.preventDefault(),t.handleShowMenu(e,n)}}},[n.module!==t.SELECTION_MODULE?[e("vm-"+n.module+"-viewer",t._b({tag:"component",attrs:{index:i,vm:t.vm,scale:t.scale},on:{change:function(e){return t.handleAttrChange(arguments[0],n)}}},"component",n,!1))]:[e("div",{staticStyle:{width:"100%",height:"100%"}})]],2)}))],2),t._v(" "),e("div",{style:[t.scaleStyle,t.footerStyle]},[t._t("frame-footer")],2)])],1)]},proxy:!0},{key:"content-extra",fn:function(){return[t.showThumbnail?e("vm-thumbnail",{class:t.classes,attrs:{"data-source":t.dataSource,scale:t.scale,"frame-w":t.width,"frame-h":t.height,"client-w":t.clientW,"client-h":t.clientH,"scroll-left":t.scrollLeft,"scroll-top":t.scrollTop,"scroller-size":t.scrollerSize,"border-size":t.borderSize,theme:t.theme},on:{scroll:t.handleScrollThumbnail}}):t._e()]},proxy:!0},{key:"footer",fn:function(){return[t.showZoomBar?e("vm-zoom-bar",{class:t.classes,attrs:{scale:t.scale,"border-size":t.borderSize,h:t.zoomBarH,"frame-w":t.width,"frame-h":t.height,"client-w":t.clientW,"client-h":t.clientH,theme:t.theme},on:{"update:scale":function(n){t.scale=n}}}):t._e()]},proxy:!0}],null,!0)})};ae._withStripped=!0;var se=vt({render:ae,staticRenderFns:[]},(function(t){t&&t("data-v-234b85be_0",{source:"@charset \"UTF-8\";\n/**\n * [commonDirectionFill 方向名词补充]\n * @param  {[string]} $key [l r b t]\n * @return {[string]}      [left right bottom top]\n */\n/**\n * [commonColumnWidth 平均分配百分比]\n * @param  {[number]} $col   [所占比]\n * @param  {[number]} $total [总]\n * @return {[number]}        [所占比/总 * 100%]\n */\n/**\n * [commonBorder 1px的兼容问题]\n * @param  {[string]} $border: ltbr          [border的方向缩写拼接]\n * @return {[type]}          [1px border]\n */\n/**\n * 1px\n * 已为父元素添加position: relative;\n * 其他只操作before和after;\n * 暂时不抽离公用\n */\n/**\n * [commonPadding padding]\n * @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonMargin margin]\n* @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonAbsolute absolute]\n * @param  {[list]} $direction-val... [top, right, bottom, left 的值]\n * @return {[type]}                   [description]\n */\n/**\n * 水平垂直居中\n */\n/**\n * 文字相关\n */\n/**\n * 一行文字\n */\n/* stylelint-disable */\n/**\n * [commonClearfix 清除浮动]\n * @return {[type]} [description]\n */\n/* Var\n -------------------------- */\n/* Func\n -------------------------- */\n/* Mix\n -------------------------- */\n/**\n * @param $root: 默认置顶\n */\n/**\n * 1. +, >, ~, ' '\n * 2. 同element\n * 3. 同modifier\n * 4. 同block\n */\n/**\n * -> [className].is_require \n * 与xxx:hover类似\n */\n/**\n * 用 @at-root 来重置 & 读取次数的计数\n * 如 [clsssName] [className]:hover\n */\n/**\n * 自定义规则\n */\n/**\n * TODO: 使用vc-scroller;\n */\n.vm-frame-draggable__wrapper {\n  overflow: auto;\n  height: 100%;\n  /**\n   * scrollbar width\n   */\n  /**\n   * scrollbar bg\n   */\n  /**\n   * Handle\n   */\n}\n.vm-frame-draggable__wrapper::-webkit-scrollbar {\n  width: 4px;\n}\n.vm-frame-draggable__wrapper::-webkit-scrollbar:horizontal {\n  height: 4px;\n}\n.vm-frame-draggable__wrapper::-webkit-scrollbar-track {\n  background: rgba(0, 0, 0, 0);\n  z-index: 0;\n}\n.vm-frame-draggable__wrapper::-webkit-scrollbar-thumb {\n  background: rgba(0, 0, 0, 0.2);\n  border: 1px solid rgba(0, 0, 0, 0.2);\n}\n.vm-frame-draggable__wrapper::-webkit-scrollbar-corner {\n  background: rgba(0, 0, 0, 0.2);\n}\n.vm-frame-draggable__content {\n  -webkit-flex-shrink: 0;\n      -ms-flex-negative: 0;\n          flex-shrink: 0;\n  border: 1px solid #d9d9d9;\n  position: relative;\n  z-index: 1;\n}\n\n/*# sourceMappingURL=frame.vue.map */",map:{version:3,sources:["frame.vue","/Users/deot/Desktop/wya/github/wya-vm/src/combo/frame/draggable/frame.vue"],names:[],mappings:"AAAA,gBAAgB;AAChB;;;;EAIE;AACF;;;;;EAKE;AACF;;;;EAIE;AACF;;;;;EAKE;AACF;;;;;;;EAOE;AACF;;;;;;;EAOE;AACF;;;;EAIE;AACF;;EAEE;AACF;;EAEE;AACF;;EAEE;AACF,sBAAsB;AACtB;;;EAGE;AACF;6BAC6B;AAC7B;6BAC6B;AAC7B;6BAC6B;AAC7B;;EAEE;AACF;;;;;EAKE;AACF;;;EAGE;AACF;;;EAGE;AACF;;EAEE;AACF;;EAEE;AACF;EC0xBA,cAAA;EACA,YAAA;EDxxBE;;IAEE;EACF;;IAEE;EACF;;IAEE;AACJ;AACA;EACE,UAAU;AACZ;AACA;EACE,WAAW;AACb;AACA;EACE,4BAA4B;EAC5B,UAAU;AACZ;AACA;EACE,8BAA8B;EAC9B,oCAAoC;AACtC;AACA;EACE,8BAA8B;AAChC;AAEA;ECiwBA,sBAAA;MAAA,oBAAA;UAAA,cAAA;EACA,yBAAA;EACA,kBAAA;EAEA,UAAA;ADhwBA;;AAEA,oCAAoC",file:"frame.vue",sourcesContent:["@charset \"UTF-8\";\n/**\n * [commonDirectionFill 方向名词补充]\n * @param  {[string]} $key [l r b t]\n * @return {[string]}      [left right bottom top]\n */\n/**\n * [commonColumnWidth 平均分配百分比]\n * @param  {[number]} $col   [所占比]\n * @param  {[number]} $total [总]\n * @return {[number]}        [所占比/总 * 100%]\n */\n/**\n * [commonBorder 1px的兼容问题]\n * @param  {[string]} $border: ltbr          [border的方向缩写拼接]\n * @return {[type]}          [1px border]\n */\n/**\n * 1px\n * 已为父元素添加position: relative;\n * 其他只操作before和after;\n * 暂时不抽离公用\n */\n/**\n * [commonPadding padding]\n * @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonMargin margin]\n* @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonAbsolute absolute]\n * @param  {[list]} $direction-val... [top, right, bottom, left 的值]\n * @return {[type]}                   [description]\n */\n/**\n * 水平垂直居中\n */\n/**\n * 文字相关\n */\n/**\n * 一行文字\n */\n/* stylelint-disable */\n/**\n * [commonClearfix 清除浮动]\n * @return {[type]} [description]\n */\n/* Var\n -------------------------- */\n/* Func\n -------------------------- */\n/* Mix\n -------------------------- */\n/**\n * @param $root: 默认置顶\n */\n/**\n * 1. +, >, ~, ' '\n * 2. 同element\n * 3. 同modifier\n * 4. 同block\n */\n/**\n * -> [className].is_require \n * 与xxx:hover类似\n */\n/**\n * 用 @at-root 来重置 & 读取次数的计数\n * 如 [clsssName] [className]:hover\n */\n/**\n * 自定义规则\n */\n/**\n * TODO: 使用vc-scroller;\n */\n.vm-frame-draggable__wrapper {\n  overflow: auto;\n  height: 100%;\n  /**\n   * scrollbar width\n   */\n  /**\n   * scrollbar bg\n   */\n  /**\n   * Handle\n   */\n}\n.vm-frame-draggable__wrapper::-webkit-scrollbar {\n  width: 4px;\n}\n.vm-frame-draggable__wrapper::-webkit-scrollbar:horizontal {\n  height: 4px;\n}\n.vm-frame-draggable__wrapper::-webkit-scrollbar-track {\n  background: rgba(0, 0, 0, 0);\n  z-index: 0;\n}\n.vm-frame-draggable__wrapper::-webkit-scrollbar-thumb {\n  background: rgba(0, 0, 0, 0.2);\n  border: 1px solid rgba(0, 0, 0, 0.2);\n}\n.vm-frame-draggable__wrapper::-webkit-scrollbar-corner {\n  background: rgba(0, 0, 0, 0.2);\n}\n\n.vm-frame-draggable__content {\n  flex-shrink: 0;\n  border: 1px solid #d9d9d9;\n  position: relative;\n  z-index: 1;\n}\n\n/*# sourceMappingURL=frame.vue.map */",'<template>\n\t<vm-inner\n\t\tref="inner"\n\t\t:show-ruler="showRuler"\n\t\t:show-zoom-bar="showZoomBar"\n\t\t:scroll-left="scrollLeft"\n\t\t:scroll-top="scrollTop"\n\t\t:frame-w="width"\n\t\t:frame-h="height"\n\t\t:client-w="clientW"\n\t\t:client-h="clientH"\n\t\t:zoom-bar-h="zoomBarH"\n\t\t:scale="scale"\n\t\t:border-size="borderSize"\n\t\t:scroller-size="scrollerSize"\n\t\t:guides.sync="guides"\n\t\t:theme="theme"\n\t\t:class="classes"\n\t\tclass="vm-frame-draggable" \n\t\t@client-resize="handleClientResize" \n\t>\n\t\t<template #content>\n\t\t\t<div \n\t\t\t\tref="wrapper" \n\t\t\t\tclass="vm-frame-draggable__wrapper" \n\t\t\t\t:style="wrapperStyle"\n\t\t\t\t@scroll="handleScroll"\n\t\t\t>\n\t\t\t\t\x3c!-- 用于失焦用 --\x3e\n\t\t\t\t<div ref="deactivated" />\n\t\t\t\t<vm-selection \n\t\t\t\t\t:client-w="clientW" \n\t\t\t\t\t:client-h="clientH" \n\t\t\t\t\t:border-size="borderSize"\n\t\t\t\t\t@selection="handleSelection" \n\t\t\t\t/>\n\t\t\t\t<div :style="scrollStyle">\n\t\t\t\t\t\x3c!-- 以上仅辅助Frame，所以frameStyle作用在content上 --\x3e\n\t\t\t\t\t<div ref="header" :style="scaleStyle">\n\t\t\t\t\t\t<slot name="frame-header" />\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t<div\n\t\t\t\t\t\tref="content"\n\t\t\t\t\t\t:style="[contentStyle, frameStyle]"\n\t\t\t\t\t\tclass="vm-frame-draggable__content"\n\t\t\t\t\t\tstyle="position: relative;"\n\t\t\t\t\t\t@dragover.prevent\n\t\t\t\t\t\t@drop="handleDrop"\n\t\t\t\t\t>\n\t\t\t\t\t\t<vm-grid-lines v-if="showLines" :width="width" :height="height" :grid="[10, 10]" />\n\t\t\t\t\t\t<vm-align-lines v-if="showLines" :data-source="dataSource" :editor="editor" />\n\t\t\t\t\t\t\x3c!-- prevent为true用于点击时可以触发输入框的失焦 --\x3e\n\t\t\t\t\t\t<vm-draggable\n\t\t\t\t\t\t\tv-for="(it, index) in dataSource"\n\t\t\t\t\t\t\tref="draggable"\n\t\t\t\t\t\t\t:key="it.id"\n\t\t\t\t\t\t\t:x.sync="it.x"\n\t\t\t\t\t\t\t:y.sync="it.y"\n\t\t\t\t\t\t\t:z.sync="it.z"\n\t\t\t\t\t\t\t:w.sync="it.w"\n\t\t\t\t\t\t\t:h.sync="it.h"\n\t\t\t\t\t\t\t:r.sync="it.r"\n\t\t\t\t\t\t\t:module="it.module"\n\t\t\t\t\t\t\t:parent="it.parent"\n\t\t\t\t\t\t\t:disabled="it.disabled || !!selections[it.id]"\n\t\t\t\t\t\t\t:handles="it.handles"\n\t\t\t\t\t\t\t:min-w="it.minW"\n\t\t\t\t\t\t\t:min-h="it.minH"\n\t\t\t\t\t\t\t:scale="scale"\n\t\t\t\t\t\t\t:grid="it.grid"\n\t\t\t\t\t\t\t:guides="guides"\n\t\t\t\t\t\t\t:offset="[scrollLeft || 0, scrollTop || 0]"\n\t\t\t\t\t\t\t:active="it.active"\n\t\t\t\t\t\t\t:restrain="it.restrain"\n\t\t\t\t\t\t\t:closeable="it.closeable || typeof it.closeable === \'undefined\'"\n\t\t\t\t\t\t\t:draggable="it.draggable || typeof it.draggable === \'undefined\'"\n\t\t\t\t\t\t\t:rotatable="it.rotatable || typeof it.rotatable === \'undefined\'"\n\t\t\t\t\t\t\t:resizable="it.resizable || typeof it.resizable === \'undefined\'"\n\t\t\t\t\t\t\t:prevent="false"\n\t\t\t\t\t\t\t@delete="$parent.remove(it, true)"\n\t\t\t\t\t\t\t@activated="handleActivated(arguments[0], it)"\n\t\t\t\t\t\t\t@deactivated="handleDeactivated(arguments[0], it)"\n\t\t\t\t\t\t\t@dragging="handleDragging(it)"\n\t\t\t\t\t\t\t@resizing="$emit(\'resizing\', it)"\n\t\t\t\t\t\t\t@rotating="$emit(\'rotating\', it)"\n\t\t\t\t\t\t\t@resize-end="$emit(\'resize-end\', it)"\n\t\t\t\t\t\t\t@drag-end="handleDragEnd(it)"\n\t\t\t\t\t\t\t@end="handleEnd(arguments[0], it, index)"\n\t\t\t\t\t\t\t@contextmenu.prevent.native="handleShowMenu($event, it)"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<template v-if="it.module !== SELECTION_MODULE">\n\t\t\t\t\t\t\t\t\x3c!-- vm-type让组件内部处理如何渲染或其他操作 --\x3e\n\t\t\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t\t\t:is="`vm-${it.module}-viewer`"\n\t\t\t\t\t\t\t\t\t:index="index"\n\t\t\t\t\t\t\t\t\t:vm="vm"\n\t\t\t\t\t\t\t\t\tv-bind="it"\n\t\t\t\t\t\t\t\t\t:scale="scale"\n\t\t\t\t\t\t\t\t\t@change="handleAttrChange(arguments[0], it)"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\x3c!-- 组合拖拽 --\x3e\n\t\t\t\t\t\t\t\t<div style="width: 100%; height: 100%" />\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</vm-draggable>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div :style="[scaleStyle, footerStyle]">\n\t\t\t\t\t\t<slot name="frame-footer" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</template>\n\t\t<template #content-extra>\n\t\t\t<vm-thumbnail\n\t\t\t\tv-if="showThumbnail"\n\t\t\t\t:data-source="dataSource"\n\t\t\t\t:scale="scale"\n\t\t\t\t:frame-w="width"\n\t\t\t\t:frame-h="height"\n\t\t\t\t:client-w="clientW"\n\t\t\t\t:client-h="clientH"\n\t\t\t\t:scroll-left="scrollLeft"\n\t\t\t\t:scroll-top="scrollTop"\n\t\t\t\t:scroller-size="scrollerSize"\n\t\t\t\t:border-size="borderSize"\n\t\t\t\t:class="classes"\n\t\t\t\t:theme="theme"\n\t\t\t\t@scroll="handleScrollThumbnail"\n\t\t\t/>\n\t\t</template>\t\n\t\t<template #footer>\n\t\t\t<vm-zoom-bar\n\t\t\t\tv-if="showZoomBar"\n\t\t\t\t:scale.sync="scale"\n\t\t\t\t:border-size="borderSize"\n\t\t\t\t:h="zoomBarH"\n\t\t\t\t:frame-w="width"\n\t\t\t\t:frame-h="height"\n\t\t\t\t:client-w="clientW"\n\t\t\t\t:client-h="clientH"\n\t\t\t\t:class="classes"\n\t\t\t\t:theme="theme"\n\t\t\t/>\n\t\t</template>\n\t</vm-inner>\n</template>\n\n<script>\nimport Draggable from \'../../../base/draggable.vue\';\nimport GridLines from \'./grid-lines.vue\';\nimport AlignLines from \'./align-lines.vue\';\nimport Inner from \'./inner.vue\';\nimport ZoomBar from \'./zoom-bar.vue\';\nimport Thumbnail from \'./thumbnail.vue\';\nimport RightMenu from \'./right-menu\';\nimport Selection from \'./selection.vue\';\nimport { getUid, cloneDeep, throttle, valueIsNaN, hasOwn, allowSelection, Logger } from \'../../../utils/helper\';\nimport { WIDGET_TO_FRAME, PAGE_MOULE, RIGHT_MENU_MAP, SELECTION_MODULE } from \'../../../utils/constants\';\n\nconst { TOP, BOTTOM, UP, DOWN, DELETE, SELECTION, LOCK, COPY, PASTE } = RIGHT_MENU_MAP;\n\nexport default {\n\tname: \'vm-frame\',\n\tcomponents: {\n\t\t\'vm-draggable\': Draggable,\n\t\t\'vm-grid-lines\': GridLines,\n\t\t\'vm-align-lines\': AlignLines,\n\t\t\'vm-inner\': Inner,\n\t\t\'vm-zoom-bar\': ZoomBar,\n\t\t\'vm-thumbnail\': Thumbnail,\n\t\t\'vm-selection\': Selection,\n\t},\n\tprops: {\n\t\twidth: {\n\t\t\ttype: Number,\n\t\t\tvalidator: v => v > 0,\n\t\t},\n\t\theight: {\n\t\t\ttype: Number,\n\t\t\tvalidator: v => v > 0,\n\t\t},\n\t\tdataSource: Array,\n\t\teditor: Object,\n\t\tframeStyle: Object,\n\t\tshowLines: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t},\n\t\tshowRuler: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t},\n\t\tshowZoomBar: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t},\n\t\tshowThumbnail: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t},\n\t\ttheme: String,\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tSELECTION_MODULE,\n\t\t\tvm: {\n\t\t\t\ttype: \'frame\'\n\t\t\t},\n\t\t\tscrollLeft: 0,\n\t\t\tscrollTop: 0,\n\t\t\tscale: 1,\n\t\t\txRuleLines: [],\n\t\t\tyRuleLines: [],\n\n\t\t\t// 容器的宽高\n\t\t\tclientW: 0,\n\t\t\tclientH: 0,\n\n\t\t\t// 参考线\n\t\t\tguides: [[], []],\n\n\t\t\t// 悬浮的滚动条为0\n\t\t\tscrollerSize: 4\n\t\t};\n\t},\n\tcomputed: {\n\t\t// 四周留白\n\t\tborderSize() {\n\t\t\tlet size = this.showRuler ? 20 : 0;\n\t\t\treturn {\n\t\t\t\ttop: size,\n\t\t\t\tleft: size,\n\t\t\t\tbottom: size,\n\t\t\t\tright: size\n\t\t\t};\n\t\t},\n\n\t\t// zoomBarH的高度\n\t\tzoomBarH() {\n\t\t\treturn this.showZoomBar ? 40 : 0;\n\t\t},\n\n\t\t/**\n\t\t * 确保宽度不够时，滚动条的位置始终靠最右边与底部\n\t\t */\n\t\twrapperStyle() {\n\t\t\tconst { top, left, bottom, right } = this.borderSize;\n\t\t\treturn {\n\t\t\t\tpaddingTop: `${top}px`,\n\t\t\t\tpaddingLeft: `${left}px`,\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * 滚动区域大小，要加入最右边的宽度和底部的高度\n\t\t */\n\t\tscrollStyle() {\n\t\t\tconst { top, left, bottom, right } = this.borderSize;\n\t\t\treturn {\n\t\t\t\twidth: `${Math.max(this.clientW - right, this.width * this.scale + right)}px`,\n\t\t\t\theight: `${this.height * this.scale + bottom}px`\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * 内容区域\n\t\t */\n\t\tcontentStyle() {\n\t\t\treturn {\n\t\t\t\twidth: `${this.width}px`,\n\t\t\t\theight: `${this.height}px`,\n\t\t\t\ttransform: `scale(${this.scale})`,\n\t\t\t\ttransformOrigin: `0 0`,\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * header / footer 缩放\n\t\t *\n\t\t * zoom:，原来的h是一同缩放的\n\t\t * transform占位依旧是原来的width和height, 需要 originSize * this.scale\n\t\t */\n\t\tscaleStyle() {\n\t\t\treturn {\n\t\t\t\tzoom: this.scale,\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * 因为中间区域用了transform, 但没有改变height * scale, 所以footer用margin-top控制\n\t\t */\n\t\tfooterStyle() {\n\t\t\treturn {\n\t\t\t\tmarginTop: `${(this.scale - 1) * this.height / this.scale}px`\n\t\t\t};\n\t\t},\n\n\t\tclasses() {\n\t\t\treturn {\n\t\t\t\t\'is-dark\': this.theme === \'dark\'\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * 被选择的ids\n\t\t */\n\t\tselections() {\n\t\t\tconst { dataSource } = this;\n\t\t\treturn dataSource.reduce((pre, cur) => {\n\t\t\t\tif (cur.module === SELECTION_MODULE) {\n\t\t\t\t\tcur.selections.forEach((id) => {\n\t\t\t\t\t\tpre[id] = dataSource.find(i => i.id === id);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn pre;\n\t\t\t}, {});\n\t\t}\n\t},\n\n\tcreated() {\n\t\tthis.dragOriginal = {};\n\t},\n\n\tmethods: {\n\t\t/**\n\t\t * 1. 自适应布局\n\t\t * 2. 滚动条最右侧显示（hackStyle）, 容易导致无限计划\n\t\t * tips: vm-combo, width 为auto时，会出现一直计算，直到width小于最大的width\n\t\t */\n\t\thandleClientResize(w, h) {\n\t\t\tif (!this.$refs.wrapper) return;\n\n\t\t\tthis.clientW = w; \n\t\t\tthis.clientH = h; \n\t\t},\n\n\t\t// 不添加throttle，如：容易导致计算丢失（快速滚动下影响ruler）\n\t\thandleScroll(e) {\n\t\t\tthis.scrollLeft = e.target.scrollLeft;\n\t\t\tthis.scrollTop = e.target.scrollTop;\n\t\t},\n\n\t\thandleScrollThumbnail(x, y) {\n\n\t\t\tthis.scrollLeft = x;\n\t\t\tthis.$refs.wrapper.scrollLeft = x;\n\n\t\t\tthis.scrollTop = y;\n\t\t\tthis.$refs.wrapper.scrollTop = y;\n\t\t},\n\n\t\thandleDrop(e) {\n\t\t\tlet result;\n\t\t\tlet moduleData;\n\t\t\ttry { moduleData = JSON.parse(e.dataTransfer.getData(WIDGET_TO_FRAME) || \'\'); } catch {}; // eslint-disable-line\n\n\t\t\tlet { module, index } = moduleData || {};\n\t\t\tresult = this.$parent.$options.modules[module];\n\n\t\t\t// 不存在的模块\n\t\t\tif (!result) return;\n\t\t\tif (result.max && result.max <= this.dataSource.filter(i => i.module === module).length) {\n\t\t\t\tthis.$emit(\'error\', {\n\t\t\t\t\ttype: \'create\',\n\t\t\t\t\tmsg: `当前模块最多只能创建${result.max}个`\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet { x, y } = this.$refs.content.getBoundingClientRect();\n\n\t\t\tlet mouseX = e.pageX || e.clientX + document.documentElement.scrollLeft || 0;\n\t\t\tlet mouseY = e.pageY || e.clientY + document.documentElement.scrollTop || 0;\n\n\t\t\tlet id = getUid();\n\t\t\tlet rowIndex = this.dataSource.length;\n\n\t\t\tlet data = {\n\t\t\t\t...cloneDeep(\n\t\t\t\t\ttypeof result.data === \'function\'\n\t\t\t\t\t\t? result.data(index, this.dataSource)\n\t\t\t\t\t\t: result.data\n\t\t\t\t),\n\t\t\t\tmodule,\n\t\t\t\tid\n\t\t\t};\n\n\t\t\t// 不可拖拽的情况下\n\t\t\tif (!e.fake && (data.draggable || typeof data.draggable === \'undefined\')) {\n\t\t\t\tdata.x = Math.round((mouseX - x) / this.scale);\n\t\t\t\tdata.y = Math.round((mouseY - y) / this.scale);\n\t\t\t} else {\n\t\t\t\tdata.x = 0;\n\t\t\t\tdata.y = 0;\n\t\t\t}\n\n\t\t\tlet action = {\n\t\t\t\ttype: \'CREATE\',\n\t\t\t\tindex: rowIndex,\n\t\t\t\tid,\n\t\t\t\tdata\n\t\t\t};\n\t\t\tthis.$emit(\'change\', action);\n\n\t\t\t// 新元素处于激活状态\n\t\t\tthis.setActived(rowIndex);\n\t\t},\n\n\t\t/**\n\t\t * index因为都是最后一个插入\n\t\t * 所以不用像sortable/frame.vue一样做判断\n\t\t */\n\t\tsetActived(index) {\n\t\t\tthis.$nextTick(() => {\n\t\t\t\ttry {\n\t\t\t\t\t// 让当前编辑的元素触发`deactivated`，再选中actived\n\t\t\t\t\tthis.$refs.deactivated.dispatchEvent(new Event(\'mousedown\')); \n\t\t\t\t\tthis.$refs.draggable[index].setActived();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tsetActivedById(id) {\n\t\t\tthis.setActived(this.dataSource.findIndex(i => i.id === id));\n\t\t},\n\n\t\t/**\n\t\t * 显示菜单\n\t\t */\n\t\tasync handleShowMenu(e, it) { \n\t\t\t const { clipboardData } = this.$parent;\n\t\t\tif (!clipboardData && it.module === PAGE_MOULE) return;\n\n\t\t\ttry {\n\t\t\t\tconst type = await RightMenu.popup({ \n\t\t\t\t\tevent: e, \n\t\t\t\t\tdataSource: it, \n\t\t\t\t\tfilter: (i) => {\n\t\t\t\t\t\tif (it.module === PAGE_MOULE) {\n\t\t\t\t\t\t\treturn [PASTE].includes(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (it.module === SELECTION_MODULE) {\n\t\t\t\t\t\t\treturn [TOP, BOTTOM, DELETE, SELECTION, LOCK, COPY, PASTE].includes(i);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn i !== SELECTION && (i !== PASTE || clipboardData);\n\t\t\t\t\t\t}\n\t\t\t\t\t} \n\t\t\t\t});\n\n\t\t\t\t// 置底和置顶要额外处理\n\t\t\t\tif (it.module === SELECTION_MODULE && (type === TOP || type === BOTTOM)) {\n\t\t\t\t\tconst oldSortIds = this.dataSource.map(i => i.id);\n\t\t\t\t\tconst selfActionInvoke = () => {\n\t\t\t\t\t\tlet action = this.selectMenu(type, it, false) || { type: \'DUMMY\' };\n\t\t\t\t\t\tthis.$emit(\'change\', {\n\t\t\t\t\t\t\t...action,\n\t\t\t\t\t\t\trevert: it.selections.length\n\t\t\t\t\t\t});\n\t\t\t\t\t};\n\n\t\t\t\t\t// 自己再置底，元素再置底\n\t\t\t\t\ttype === BOTTOM && selfActionInvoke();\n\t\t\t\t\t\n\t\t\t\t\t// 根据z降序，相等则后面的z放在前面\n\t\t\t\t\tlet selections = this.dataSource\n\t\t\t\t\t\t.slice()\n\t\t\t\t\t\t.filter(v => it.selections.includes(v.id))\n\t\t\t\t\t\t.reverse()\n\t\t\t\t\t\t.sort((a, b) => b.z - a.z);\n\n\t\t\t\t\t(type === TOP ? selections.reverse() : selections).forEach(data => {\n\t\t\t\t\t\tlet action = this.selectMenu(e, type, data, false) || { type: \'DUMMY\' };\n\t\t\t\t\t\tthis.$emit(\'change\', {\n\t\t\t\t\t\t\t...action,\n\t\t\t\t\t\t\trevert: it.selections.length\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\t// 元素先置顶，自己再置顶\n\t\t\t\t\ttype === TOP && selfActionInvoke();\n\n\t\t\t\t\t// 置顶置底未发生变化\n\t\t\t\t\tif (\n\t\t\t\t\t\toldSortIds.every((id, index) => this.dataSource[index].id === id)\n\t\t\t\t\t) {\n\t\t\t\t\t\tthis.$parent.store.removeHistory(it.selections.length + 1);\n\n\t\t\t\t\t\tthis.$emit(\'error\', {\n\t\t\t\t\t\t\ttype: \'menu\',\n\t\t\t\t\t\t\tmsg: `您已经${type === TOP ? \'置顶\' : \'置底\'}, 无需操作`\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.selectMenu(e, type, it);\n\t\t\t} catch (e) {\n\t\t\t\te && e.message && console.log(e);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * 右键查单选项\n\t\t * e: 使用粘帖时的位置\n\t\t * type: 要选择的操作\n\t\t * it: 数据源\n\t\t * invoke: 表示是否需要emit执行, 否者返回action（目前只有涉及排序的返回action）\n\t\t *\n\t\t * TODO: 抽离 or 优化代码\n\t\t */\n\t\tselectMenu(e, type, it, invoke = true) {\n\t\t\tlet changed;\n\t\t\tlet temp;\n\t\t\t// 根据z降序，相等则后面的z放在前面\n\t\t\tlet data = this.dataSource\n\t\t\t\t.slice()\n\t\t\t\t.filter(v => v.module !== PAGE_MOULE)\n\t\t\t\t.reverse()\n\t\t\t\t.sort((a, b) => b.z - a.z);\n\t\t\tlet index = data.findIndex(v => v.id === it.id);\n\n\t\t\tif (type === DELETE && it.closeable === false) return;\n\t\t\tlet action;\n\t\t\tswitch (type) {\n\t\t\t\tcase TOP:\n\t\t\t\t\tif (index === 0) return;\n\t\t\t\t\tchanged = data[0];\n\t\t\t\t\tbreak;\n\t\t\t\tcase BOTTOM:\n\t\t\t\t\tif (index === data.length - 1) return;\n\t\t\t\t\tchanged = data[data.length - 1];\n\t\t\t\t\tbreak;\n\t\t\t\tcase UP:\n\t\t\t\t\tif (index === 0) return;\n\t\t\t\t\tchanged = data[index - 1];\n\t\t\t\t\tbreak;\n\t\t\t\tcase DOWN:\n\t\t\t\t\tif (index === data.length - 1) return;\n\t\t\t\t\tchanged = data[index + 1];\n\t\t\t\t\tbreak;\n\t\t\t\t// 删除：由其他执行\n\t\t\t\tcase DELETE:\n\t\t\t\t\taction = { type: \'DELETE\', id: it.id };\n\t\t\t\t\tif (!invoke) return action;\n\t\t\t\t\tthis.$parent.remove(it, true);\n\t\t\t\t\treturn;\n\t\t\t\t// 取消选择：直接删除元素\n\t\t\t\tcase SELECTION:\n\t\t\t\t\taction = { type: \'DELETE\', id: it.id };\n\t\t\t\t\tif (!invoke) return action;\n\t\t\t\t\tthis.$emit(\'change\', action);\n\t\t\t\t\treturn;\n\t\t\t\tcase LOCK: \n\t\t\t\t\taction = { type: \'UPDATE\', id: it.id, changed: { disabled: !it.disabled } };\n\t\t\t\t\tif (!invoke) return action;\n\t\t\t\t\tthis.$emit(\'change\', action);\n\t\t\t\t\treturn;\n\t\t\t\tcase COPY: \n\t\t\t\t\tthis.$parent.copy(it);\n\t\t\t\t\treturn;\n\t\t\t\tcase PASTE: {\n\t\t\t\t\tlet { x, y } = this.$refs.content.getBoundingClientRect();\n\n\t\t\t\t\tlet mouseX = e.pageX || e.clientX + document.documentElement.scrollLeft || 0;\n\t\t\t\t\tlet mouseY = e.pageY || e.clientY + document.documentElement.scrollTop || 0;\n\n\t\t\t\t\tx = Math.round((mouseX - x) / this.scale);\n\t\t\t\t\ty = Math.round((mouseY - y) / this.scale);\n\t\t\t\t\tthis.$parent.paste({\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tdefault:\n\t\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet current = this.dataSource.findIndex(v => v.id === it.id);\n\t\t\tlet target = this.dataSource.findIndex(v => v.id === changed.id);\n\n\t\t\taction = {\n\t\t\t\ttype: \'SORT\',\n\t\t\t\tchanged: [current, target],\n\t\t\t\thistory: true,\n\t\t\t};\n\n\t\t\tif (!invoke) return action;\n\t\t\tthis.$emit(\'change\', action);\n\t\t},\n\n\t\t/**\n\t\t * 从Viewer传递出来\n\t\t * id, history 这是内部字段\n\t\t */\n\t\thandleAttrChange(opts = {}, it) {\n\t\t\tif (typeof opts !== \'object\') return;\n\t\t\tconst { id, history, ...rest } = opts;\n\n\t\t\tconst changed = {};\n\t\t\tfor (let key in rest) {\n\t\t\t\tlet val = rest[key];\n\n\t\t\t\t[\'x\', \'y\', \'z\', \'r\', \'w\', \'h\'].includes(key) && (val = Number(val));\n\n\t\t\t\tif (hasOwn(rest, key) && !valueIsNaN(val)) {\n\t\t\t\t\tchanged[key] = val;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.$emit(\'change\', {\n\t\t\t\ttype: \'UPDATE\',\n\t\t\t\tid: id || it.id,\n\t\t\t\tchanged,\n\t\t\t\t// 是否记录历史\n\t\t\t\thistory\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * 多选选中\n\t\t */\n\t\thandleSelection(rect) {\n\t\t\tconst { dataSource, scale, borderSize } = this;\n\t\t\tconst headerH = this.$refs.header ? this.$refs.header.clientHeight : 0;\n\t\t\tconst $rect = {\n\t\t\t\tx: this.scrollLeft + (rect.x - borderSize.left) / scale,\n\t\t\t\ty: this.scrollTop + (rect.y - borderSize.top) / scale - headerH,\n\t\t\t\tw: rect.w / scale,\n\t\t\t\th: rect.h / scale,\n\t\t\t};\n\n\t\t\tlet { selections, selectionModules, disabledIds } = dataSource.reduce((pre, cur) => {\n\t\t\t\tif (\n\t\t\t\t\t!allowSelection(cur, $rect) \n\t\t\t\t\t|| cur.module === PAGE_MOULE\n\t\t\t\t) return pre;\n\t\t\t\t\t\n\t\t\t\tif (cur.disabled && cur.module === SELECTION_MODULE) {\n\t\t\t\t\tpre.disabledIds.push(...cur.selections);\n\t\t\t\t} \n\n\t\t\t\tif (cur.disabled) return pre;\n\t\t\t\tif (cur.module === SELECTION_MODULE) {\n\t\t\t\t\tpre.selectionModules.push(cur);\n\t\t\t\t} else {\n\t\t\t\t\tpre.selections.push(cur);\n\t\t\t\t}\n\t\t\t\treturn pre;\n\t\t\t}, {\n\t\t\t\tselections: [],\n\t\t\t\tdisabledIds: [],\n\t\t\t\tselectionModules: []\n\t\t\t});\n\t\t\t// 过滤不能选的ids\n\t\t\tselections = selections.filter(i => !disabledIds.includes(i.id));\n\n\t\t\tconst selectionIds = selections.map(i => i.id);\n\n\t\t\t// 如果选区内selectionIds已存在在selectionModules;直接选中\n\t\t\tfor (let i = 0; i < selectionModules.length; i++) {\n\t\t\t\tif (selectionIds.every(id => selectionModules[i].selections.includes(id))) {\n\t\t\t\t\tthis.setActivedById(selectionModules[i].id);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// 当且只有一个元素未选中或有selectionModules在这个区域内\n\t\t\tif (selections.length <= 1) {\n\t\t\t\tlet rowIndex = 0;\n\n\t\t\t\tif (selections.length) {\n\t\t\t\t\trowIndex = dataSource.findIndex(i => i.id === selections[0].id);\n\t\t\t\t}\n\n\t\t\t\t// 找到最上面一层\n\t\t\t\tif (selectionModules.length) {\n\t\t\t\t\trowIndex = Math.max(\n\t\t\t\t\t\trowIndex, \n\t\t\t\t\t\t...selectionModules.map(i => dataSource.findIndex(j => j.id === i.id))\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// 激活状态\n\t\t\t\trowIndex && this.setActived(rowIndex);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// 移除之前选区\n\t\t\tconst actions = dataSource.reduce((pre, cur) => {\n\t\t\t\tif (cur.module !== SELECTION_MODULE || !selectionIds.some(id => cur.selections.includes(id))) return pre;\n\t\t\t\tpre.push({\n\t\t\t\t\ttype: \'DELETE\',\n\t\t\t\t\tid: cur.id\n\t\t\t\t});\n\t\t\t\treturn pre;\n\t\t\t}, []);\n\n\n\t\t\tlet id = getUid();\n\t\t\tconst info = selections.reduce((pre, cur) => {\n\t\t\t\tpre.xs.push(cur.x);\n\t\t\t\tpre.xws.push(cur.x + cur.w);\n\t\t\t\tpre.ys.push(cur.y);\n\t\t\t\tpre.yhs.push(cur.y + cur.h);\n\t\t\t\tpre.zs.push(cur.z);\n\t\t\t\tpre.parent && (pre.parent = cur.parent);\n\t\t\t\treturn pre;\n\t\t\t}, {\n\t\t\t\txs: [],\n\t\t\t\txws: [],\n\t\t\t\tys: [],\n\t\t\t\tyhs: [],\n\t\t\t\tzs: [],\n\t\t\t\tparent: true\n\t\t\t});\n\t\t\tlet minX = Math.min(...info.xs);\n\t\t\tlet maxX = Math.max(...info.xws);\n\n\t\t\tlet minY = Math.min(...info.ys);\n\t\t\tlet maxY = Math.max(...info.yhs);\n\n\t\t\t// 删除之前组合的\n\t\t\tactions.forEach(i => { i.revert = actions.length; this.$emit(\'change\', i); });\n\n\t\t\tlet rowIndex = dataSource.length;\n\t\t\tlet action = {\n\t\t\t\ttype: \'CREATE\',\n\t\t\t\tindex: rowIndex,\n\t\t\t\tid,\n\t\t\t\tdata: {\n\t\t\t\t\tx: minX,\n\t\t\t\t\ty: minY,\n\t\t\t\t\tw: maxX - minX,\n\t\t\t\t\th: maxY - minY,\n\t\t\t\t\tz: Math.max(...info.zs),\n\t\t\t\t\tr: 0,\n\n\t\t\t\t\tparent: info.parent,\n\t\t\t\t\trotatable: false,\n\t\t\t\t\tresizable: false,\n\t\t\t\t\tcloseable: true,\n\n\t\t\t\t\t// 用于表示锁定\n\t\t\t\t\tdisabled: false,\n\t\t\t\t\tactive: false,\n\n\t\t\t\t\t// 内部分配字段\n\t\t\t\t\tselections: selectionIds,\n\t\t\t\t\tmodule: SELECTION_MODULE,\n\t\t\t\t\tid\n\t\t\t\t},\n\t\t\t\trevert: actions.length\n\t\t\t};\n\n\t\t\tthis.$emit(\'change\', action);\n\t\t\t// 新元素处于激活状态\n\t\t\tthis.setActived(rowIndex);\n\t\t},\n\n\t\t/**\n\t\t * 目标被激活\n\t\t */\n\t\thandleActivated(e, it) {\n\t\t\tLogger.debug(\'activated\', it.module);\n\t\t\tthis.$emit(\'activated\', e, it);\n\t\t\tif (it.module === SELECTION_MODULE) {\n\t\t\t\tthis.dragOriginal[it.id] = {\n\t\t\t\t\tx: it.x,\n\t\t\t\t\ty: it.y\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * 目标失活\n\t\t */\n\t\thandleDeactivated(e, it) {\n\t\t\tLogger.debug(\'deactivated\', it.module);\n\t\t\tthis.$emit(\'deactivated\', e, it);\n\t\t},\n\n\t\t/**\n\t\t * 目标被拖动\n\t\t */\n\t\thandleDragging(it) {\n\t\t\tthis.$emit(\'dragging\', it);\n\t\t\tif (it.module === SELECTION_MODULE) {\n\t\t\t\tconst diffX = it.x - this.dragOriginal[it.id].x;\n\t\t\t\tconst diffY = it.y - this.dragOriginal[it.id].y;\n\n\t\t\t\t(diffX || diffY) && it.selections && it.selections.forEach(id => {\n\t\t\t\t\tlet { x, y, module } = this.selections[id];\n\t\t\t\t\tif (!this.dragOriginal[id]) {\n\t\t\t\t\t\tthis.dragOriginal[id] = {\n\t\t\t\t\t\t\tx,\n\t\t\t\t\t\t\ty\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tx = this.dragOriginal[id].x + diffX;\n\t\t\t\t\ty = this.dragOriginal[id].y + diffY;\n\n\t\t\t\t\tthis.$emit(\'change\', {\n\t\t\t\t\t\ttype: \'UPDATE\',\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tchanged: {\n\t\t\t\t\t\t\tx,\n\t\t\t\t\t\t\ty\n\t\t\t\t\t\t},\n\t\t\t\t\t\t// 是否记录历史\n\t\t\t\t\t\thistory: false\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * 目标拖动结束\n\t\t */\n\t\thandleDragEnd(it) {\n\t\t\tLogger.debug(\'drag-end\', it.module);\n\t\t\tthis.$emit(\'drag-end\', it);\n\t\t\tif (it.module === SELECTION_MODULE) {\n\t\t\t\tthis.dragOriginal = {};\n\n\t\t\t\t// 用于激活状态下再次拖拽\n\t\t\t\tthis.dragOriginal[it.id] = {\n\t\t\t\t\tx: it.x,\n\t\t\t\t\ty: it.y\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\n\n\t\t/**\n\t\t * 目标所有变化行为结束\n\t\t * original 用于回到历史位置\n\t\t */\n\t\thandleEnd(original, it, index) {\n\t\t\tLogger.debug(\'end\', it.module);\n\t\t\tlet action = {\n\t\t\t\ttype: \'UPDATE\',\n\t\t\t\tid: it.id,\n\t\t\t\tindex,\n\t\t\t\toriginal,\n\t\t\t\trevert: it.selections && it.selections.length,\n\t\t\t};\n\t\t\tthis.$emit(\'change\', action);\n\n\t\t\tif (it.module === SELECTION_MODULE) {\n\t\t\t\tconst diffX = it.x - original.x;\n\t\t\t\tconst diffY = it.y - original.y;\n\n\t\t\t\t(diffX || diffY) && it.selections && it.selections.forEach(id => {\n\t\t\t\t\tlet { x, y, module } = this.selections[id];\n\t\t\t\t\tthis.$emit(\'change\', {\n\t\t\t\t\t\ttype: \'UPDATE\',\n\t\t\t\t\t\tid,\n\t\t\t\t\t\trevert: it.selections && it.selections.length,\n\t\t\t\t\t\toriginal: {\n\t\t\t\t\t\t\tx: x - diffX,\n\t\t\t\t\t\t\ty: y - diffY\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t},\n};\n<\/script>\n\n<style lang="scss">\n@import "../../../style/index.scss";\n\n$block: vm-frame-draggable;\n\n@include block($block) {\n\t@include element(wrapper) {\n\t\toverflow: auto; // hidden时考虑使用悬浮的滚动条\n\t\theight: 100%; // 兼容无ruler模式\n\t\t@include scroller();\n\t}\n\t@include element(content) {\n\t\t// 不可缩小\n\t\tflex-shrink: 0;\n\t\tborder: 1px solid $border;\n\t\tposition: relative;\n\t\t// overflow: hidden;\n\t\tz-index: 1;\n\t}\n}\n</style>\n']},media:void 0})}),oe,void 0,!1,void 0,!1,yt,void 0,void 0),le={name:"vm-frame-inner",props:{hasPage:Boolean}},de=function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"vm-frame-sortable--inner"},[this._t("content")],2)};de._withStripped=!0;function Ae(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,i)}return e}function ce(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?Ae(Object(e),!0).forEach((function(n){S.default(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Ae(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}var me={name:"vm-frame",components:{"vm-sortable":Ot,"vm-inner":vt({render:de,staticRenderFns:[]},(function(t){t&&t("data-v-641aa406_0",{source:"@charset \"UTF-8\";\n/**\n * [commonDirectionFill 方向名词补充]\n * @param  {[string]} $key [l r b t]\n * @return {[string]}      [left right bottom top]\n */\n/**\n * [commonColumnWidth 平均分配百分比]\n * @param  {[number]} $col   [所占比]\n * @param  {[number]} $total [总]\n * @return {[number]}        [所占比/总 * 100%]\n */\n/**\n * [commonBorder 1px的兼容问题]\n * @param  {[string]} $border: ltbr          [border的方向缩写拼接]\n * @return {[type]}          [1px border]\n */\n/**\n * 1px\n * 已为父元素添加position: relative;\n * 其他只操作before和after;\n * 暂时不抽离公用\n */\n/**\n * [commonPadding padding]\n * @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonMargin margin]\n* @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonAbsolute absolute]\n * @param  {[list]} $direction-val... [top, right, bottom, left 的值]\n * @return {[type]}                   [description]\n */\n/**\n * 水平垂直居中\n */\n/**\n * 文字相关\n */\n/**\n * 一行文字\n */\n/* stylelint-disable */\n/**\n * [commonClearfix 清除浮动]\n * @return {[type]} [description]\n */\n/* Var\n -------------------------- */\n/* Func\n -------------------------- */\n/* Mix\n -------------------------- */\n/**\n * @param $root: 默认置顶\n */\n/**\n * 1. +, >, ~, ' '\n * 2. 同element\n * 3. 同modifier\n * 4. 同block\n */\n/**\n * -> [className].is_require \n * 与xxx:hover类似\n */\n/**\n * 用 @at-root 来重置 & 读取次数的计数\n * 如 [clsssName] [className]:hover\n */\n/**\n * 自定义规则\n */\n/**\n * TODO: 使用vc-scroller;\n */\n.vm-frame-sortable--inner {\n  -webkit-box-flex: 1;\n  -webkit-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n  overflow: auto;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  position: relative;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n}\n\n/*# sourceMappingURL=inner.vue.map */",map:{version:3,sources:["inner.vue","/Users/deot/Desktop/wya/github/wya-vm/src/combo/frame/sortable/inner.vue"],names:[],mappings:"AAAA,gBAAgB;AAChB;;;;EAIE;ACgBF;;;;;EAAA;ADTA;;;;EAIE;AACF;;;;;EAKE;AACF;;;;;;;EAOE;AACF;;;;;;;EAOE;AACF;;;;EAIE;AACF;;EAEE;AACF;;EAEE;AACF;;EAEE;AACF,sBAAsB;AACtB;;;EAGE;AACF;6BAC6B;AAC7B;6BAC6B;AAC7B;6BAC6B;AAC7B;;EAEE;AACF;;;;;EAKE;AACF;;;EAGE;AACF;;;EAGE;AACF;;EAEE;AACF;;EAEE;AACF;ECnEA,mBAAA;EAAA,eAAA;MAAA,WAAA;UAAA,OAAA;EACA,cAAA;EACA,oBAAA;EAAA,qBAAA;EAAA,oBAAA;EAAA,aAAA;EACA,kBAAA;EACA,yBAAA;EAAA,2BAAA;MAAA,sBAAA;UAAA,mBAAA;EACA,wBAAA;EAAA,+BAAA;MAAA,qBAAA;UAAA,uBAAA;ADqEA;;AAEA,oCAAoC",file:"inner.vue",sourcesContent:["@charset \"UTF-8\";\n/**\n * [commonDirectionFill 方向名词补充]\n * @param  {[string]} $key [l r b t]\n * @return {[string]}      [left right bottom top]\n */\n/**\n * [commonColumnWidth 平均分配百分比]\n * @param  {[number]} $col   [所占比]\n * @param  {[number]} $total [总]\n * @return {[number]}        [所占比/总 * 100%]\n */\n/**\n * [commonBorder 1px的兼容问题]\n * @param  {[string]} $border: ltbr          [border的方向缩写拼接]\n * @return {[type]}          [1px border]\n */\n/**\n * 1px\n * 已为父元素添加position: relative;\n * 其他只操作before和after;\n * 暂时不抽离公用\n */\n/**\n * [commonPadding padding]\n * @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonMargin margin]\n* @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonAbsolute absolute]\n * @param  {[list]} $direction-val... [top, right, bottom, left 的值]\n * @return {[type]}                   [description]\n */\n/**\n * 水平垂直居中\n */\n/**\n * 文字相关\n */\n/**\n * 一行文字\n */\n/* stylelint-disable */\n/**\n * [commonClearfix 清除浮动]\n * @return {[type]} [description]\n */\n/* Var\n -------------------------- */\n/* Func\n -------------------------- */\n/* Mix\n -------------------------- */\n/**\n * @param $root: 默认置顶\n */\n/**\n * 1. +, >, ~, ' '\n * 2. 同element\n * 3. 同modifier\n * 4. 同block\n */\n/**\n * -> [className].is_require \n * 与xxx:hover类似\n */\n/**\n * 用 @at-root 来重置 & 读取次数的计数\n * 如 [clsssName] [className]:hover\n */\n/**\n * 自定义规则\n */\n/**\n * TODO: 使用vc-scroller;\n */\n.vm-frame-sortable--inner {\n  flex: 1;\n  overflow: auto;\n  display: flex;\n  position: relative;\n  align-items: center;\n  justify-content: center;\n}\n\n/*# sourceMappingURL=inner.vue.map */",'<template>\n\t<div class="vm-frame-sortable--inner">\n\t\t<slot name="content" />\n\t</div>\n</template>\n\n<script>\nexport default {\n\tname: \'vm-frame-inner\',\n\tprops: {\n\t\thasPage: Boolean\n\t}\n};\n<\/script>\n\n<style lang="scss">\n@import "../../../style/index.scss";\n\n$block: vm-frame-sortable--inner;\n@include block($block) {\n\tflex: 1;\n\toverflow: auto;\n\tdisplay: flex; \n\tposition: relative;\n\talign-items: center;\n\tjustify-content: center;\n}\n</style>']},media:void 0})}),le,void 0,!1,void 0,!1,yt,void 0,void 0)},props:{width:Number,height:Number,dataSource:Array,editor:Object,frameStyle:Object},data:function(){return{dragType:"@wya/vm",dragWaiting:!1,scrollTop:0,vm:{type:"frame"}}},computed:{style:function(){return{width:this.width?"".concat(this.width,"px"):"auto",height:this.height?"".concat(this.height,"px"):"auto"}},hasPage:function(){return this.dataSource.some((function(t){return"page"===t.module}))}},created:function(){this.timer=null},beforeDestory:function(){clearTimeout(this.timer)},methods:{getItemStyle:function(t,n){if("function"==typeof t.wrapperStyle){var e=this.scrollTop,i={row:t,index:n,dataSource:this.dataSource,scrollTop:e,vm:this.vm};return t.wrapperStyle(i,this)}return t.wrapperStyle||{}},handleScroll:function(t){this.scrollTop=t.target.scrollTop},handleDragEnter:function(t){var n=this;this.timer=setTimeout((function(){n.dragWaiting=!n.$refs.sort||n.$refs.sort.every((function(t){return!1===t.highlight}))}),300)},handleDragLeave:function(t){clearTimeout(this.timer),this.dragWaiting=!1},handleDrop:function(t){clearTimeout(this.timer),this.dragWaiting=!1;var n=this.dataSource.length;this.$refs.sort&&this.$refs.sort.forEach((function(t,e){!0===t.highlight&&(n=t.index+1,t.highlight=!1)}));var e=JSON.parse(t.dataTransfer.getData("@wya/vm"))||{},i=e.module,r=e.index,a=this.$parent.$options.modules[i];if(a)if(a.max&&a.max<=this.dataSource.filter((function(t){return t.module===i})).length)this.$emit("error",{type:"create",msg:"当前模块最多只能创建".concat(a.max,"个")});else{var s=lt(),l=ce(ce({},o.cloneDeep("function"==typeof a.data?a.data(r,this.dataSource):a.data)),{},{module:i,id:s});if("function"==typeof a.insertion)if(!a.insertion(n,this.dataSource))return;switch(a.insertion){case"first":n=0;break;case"last":n=this.dataSource.length}this.$emit("change",{type:"CREATE",index:n,id:s,data:l}),this.setActived(n)}},setActived:function(t){var n=this;this.$nextTick((function(){try{n.$refs.sort.find((function(n){return n.index===t})).setActived()}catch(t){console.error(t)}}))},setActivedById:function(t){this.setActived(this.dataSource.findIndex((function(n){return n.id===t})))},handleSorting:function(t){this.$emit("change",{type:"SORT",changed:t,history:!1})},handleSortEnd:function(t){this.$emit("change",{type:"SORT",original:t,history:!0}),this.$emit("sort-end",t,this.dataSource)}}},ue=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("vm-inner",{staticClass:"vm-frame-sortable",attrs:{"has-page":t.hasPage},scopedSlots:t._u([{key:"content",fn:function(){return[t._t("frame-header"),t._v(" "),e("div",{staticClass:"vm-frame-sortable__wrapper",style:[t.style,t.frameStyle],on:{scroll:t.handleScroll,dragover:function(t){t.preventDefault()},dragenter:t.handleDragEnter,dragleave:t.handleDragLeave,drop:t.handleDrop}},[e("transition-group",{attrs:{tag:"div",name:"flip-list"}},t._l(t.dataSource,(function(n,i){return e("div",{key:n.id,staticClass:"vm-frame-sortable__item"},[e("div",{style:t.getItemStyle(n,i)},[e("vm-sortable",{ref:"sort",refInFor:!0,attrs:{index:i,type:t.dragType,disabled:n.disabled,draggable:n.draggable||void 0===n.draggable,closeable:n.closeable||void 0===n.closeable,prevent:!1},on:{activated:function(e){return t.$emit("activated",arguments[0],n)},deactivated:function(e){return t.$emit("deactivated",arguments[0],n)},delete:function(e){return t.$emit("change",{type:"delete",id:n.id})},sorting:t.handleSorting,"sort-end":t.handleSortEnd}},[e("vm-"+n.module+"-viewer",t._b({tag:"component",staticStyle:{"min-height":"3px"},attrs:{index:i,vm:t.vm}},"component",n,!1))],1)],1),t._v(" "),n.placeholder?e("div",{style:{height:n.placeholder+"px"}}):t._e()])})),0)],1),t._v(" "),t._t("frame-footer")]},proxy:!0}],null,!0)})};ue._withStripped=!0;var he={Draggable:se,Sortable:vt({render:ue,staticRenderFns:[]},(function(t){t&&t("data-v-5e4f7629_0",{source:"@charset \"UTF-8\";\n/**\n * [commonDirectionFill 方向名词补充]\n * @param  {[string]} $key [l r b t]\n * @return {[string]}      [left right bottom top]\n */\n/**\n * [commonColumnWidth 平均分配百分比]\n * @param  {[number]} $col   [所占比]\n * @param  {[number]} $total [总]\n * @return {[number]}        [所占比/总 * 100%]\n */\n/**\n * [commonBorder 1px的兼容问题]\n * @param  {[string]} $border: ltbr          [border的方向缩写拼接]\n * @return {[type]}          [1px border]\n */\n/**\n * 1px\n * 已为父元素添加position: relative;\n * 其他只操作before和after;\n * 暂时不抽离公用\n */\n/**\n * [commonPadding padding]\n * @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonMargin margin]\n* @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonAbsolute absolute]\n * @param  {[list]} $direction-val... [top, right, bottom, left 的值]\n * @return {[type]}                   [description]\n */\n/**\n * 水平垂直居中\n */\n/**\n * 文字相关\n */\n/**\n * 一行文字\n */\n/* stylelint-disable */\n/**\n * [commonClearfix 清除浮动]\n * @return {[type]} [description]\n */\n/* Var\n -------------------------- */\n/* Func\n -------------------------- */\n/* Mix\n -------------------------- */\n/**\n * @param $root: 默认置顶\n */\n/**\n * 1. +, >, ~, ' '\n * 2. 同element\n * 3. 同modifier\n * 4. 同block\n */\n/**\n * -> [className].is_require \n * 与xxx:hover类似\n */\n/**\n * 用 @at-root 来重置 & 读取次数的计数\n * 如 [clsssName] [className]:hover\n */\n/**\n * 自定义规则\n */\n/**\n * TODO: 使用vc-scroller;\n */\n.vm-frame-sortable {\n  background: #f7f6fa;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n  -webkit-flex-direction: column;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.vm-frame-sortable__wrapper {\n  -webkit-flex-shrink: 0;\n      -ms-flex-negative: 0;\n          flex-shrink: 0;\n  border: 1px solid #d9d9d9;\n  position: relative;\n  overflow: auto;\n  /**\n   * scrollbar width\n   */\n  /**\n   * scrollbar bg\n   */\n  /**\n   * Handle\n   */\n}\n.vm-frame-sortable__wrapper::-webkit-scrollbar {\n  width: 4px;\n}\n.vm-frame-sortable__wrapper::-webkit-scrollbar:horizontal {\n  height: 4px;\n}\n.vm-frame-sortable__wrapper::-webkit-scrollbar-track {\n  background: rgba(0, 0, 0, 0);\n  z-index: 0;\n}\n.vm-frame-sortable__wrapper::-webkit-scrollbar-thumb {\n  background: rgba(0, 0, 0, 0.2);\n  border: 1px solid rgba(0, 0, 0, 0.2);\n}\n.vm-frame-sortable__wrapper::-webkit-scrollbar-corner {\n  background: rgba(0, 0, 0, 0.2);\n}\n.vm-frame-sortable__item {\n  -webkit-transition: all 0.5s;\n  transition: all 0.5s;\n}\n.flip-list-enter,\n.flip-list-leave-to {\n  opacity: 0;\n}\n.flip-list-leave-active {\n  display: none;\n}\n\n/*# sourceMappingURL=frame.vue.map */",map:{version:3,sources:["frame.vue","/Users/deot/Desktop/wya/github/wya-vm/src/combo/frame/sortable/frame.vue"],names:[],mappings:"AAAA,gBAAgB;AAChB;;;;EAIE;AACF;;;;;EAKE;AACF;;;;EAIE;AACF;;;;;EAKE;AACF;;;;;;;EAOE;AACF;;;;;;;EAOE;AACF;;;;EAIE;AACF;;EAEE;AACF;;EAEE;AACF;;EAEE;AACF,sBAAsB;ACsNtB;;;EAAA;ADjNA;6BAC6B;AAC7B;6BAC6B;AAC7B;6BAC6B;AAC7B;;EAEE;AACF;;;;;EAKE;AACF;;;EAGE;AACF;;;EAGE;AACF;;EAEE;AACF;;EAEE;AACF;EC2KA,mBAAA;EACA,oBAAA;EAAA,qBAAA;EAAA,oBAAA;EAAA,aAAA;EACA,4BAAA;EAAA,6BAAA;EAAA,8BAAA;MAAA,0BAAA;UAAA,sBAAA;ADzKA;AACA;EC0KA,sBAAA;MAAA,oBAAA;UAAA,cAAA;EACA,yBAAA;EAEA,kBAAA;EACA,cAAA;EDzKE;;IAEE;EACF;;IAEE;EACF;;IAEE;AACJ;AACA;EACE,UAAU;AACZ;AACA;EACE,WAAW;AACb;AACA;EACE,4BAA4B;EAC5B,UAAU;AACZ;AACA;EACE,8BAA8B;EAC9B,oCAAoC;AACtC;AACA;EACE,8BAA8B;AAChC;AAEA;ECiJA,4BAAA;EAAA,oBAAA;AD/IA;ACoJA;;EAEA,UAAA;ADjJA;ACmJA;EACA,aAAA;ADhJA;;AAEA,oCAAoC",file:"frame.vue",sourcesContent:["@charset \"UTF-8\";\n/**\n * [commonDirectionFill 方向名词补充]\n * @param  {[string]} $key [l r b t]\n * @return {[string]}      [left right bottom top]\n */\n/**\n * [commonColumnWidth 平均分配百分比]\n * @param  {[number]} $col   [所占比]\n * @param  {[number]} $total [总]\n * @return {[number]}        [所占比/总 * 100%]\n */\n/**\n * [commonBorder 1px的兼容问题]\n * @param  {[string]} $border: ltbr          [border的方向缩写拼接]\n * @return {[type]}          [1px border]\n */\n/**\n * 1px\n * 已为父元素添加position: relative;\n * 其他只操作before和after;\n * 暂时不抽离公用\n */\n/**\n * [commonPadding padding]\n * @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonMargin margin]\n* @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonAbsolute absolute]\n * @param  {[list]} $direction-val... [top, right, bottom, left 的值]\n * @return {[type]}                   [description]\n */\n/**\n * 水平垂直居中\n */\n/**\n * 文字相关\n */\n/**\n * 一行文字\n */\n/* stylelint-disable */\n/**\n * [commonClearfix 清除浮动]\n * @return {[type]} [description]\n */\n/* Var\n -------------------------- */\n/* Func\n -------------------------- */\n/* Mix\n -------------------------- */\n/**\n * @param $root: 默认置顶\n */\n/**\n * 1. +, >, ~, ' '\n * 2. 同element\n * 3. 同modifier\n * 4. 同block\n */\n/**\n * -> [className].is_require \n * 与xxx:hover类似\n */\n/**\n * 用 @at-root 来重置 & 读取次数的计数\n * 如 [clsssName] [className]:hover\n */\n/**\n * 自定义规则\n */\n/**\n * TODO: 使用vc-scroller;\n */\n.vm-frame-sortable {\n  background: #f7f6fa;\n  display: flex;\n  flex-direction: column;\n}\n.vm-frame-sortable__wrapper {\n  flex-shrink: 0;\n  border: 1px solid #d9d9d9;\n  position: relative;\n  overflow: auto;\n  /**\n   * scrollbar width\n   */\n  /**\n   * scrollbar bg\n   */\n  /**\n   * Handle\n   */\n}\n.vm-frame-sortable__wrapper::-webkit-scrollbar {\n  width: 4px;\n}\n.vm-frame-sortable__wrapper::-webkit-scrollbar:horizontal {\n  height: 4px;\n}\n.vm-frame-sortable__wrapper::-webkit-scrollbar-track {\n  background: rgba(0, 0, 0, 0);\n  z-index: 0;\n}\n.vm-frame-sortable__wrapper::-webkit-scrollbar-thumb {\n  background: rgba(0, 0, 0, 0.2);\n  border: 1px solid rgba(0, 0, 0, 0.2);\n}\n.vm-frame-sortable__wrapper::-webkit-scrollbar-corner {\n  background: rgba(0, 0, 0, 0.2);\n}\n\n.vm-frame-sortable__item {\n  transition: all 0.5s;\n}\n\n.flip-list-enter,\n.flip-list-leave-to {\n  opacity: 0;\n}\n\n.flip-list-leave-active {\n  display: none;\n}\n\n/*# sourceMappingURL=frame.vue.map */",'<template>\n\t<vm-inner :has-page="hasPage" class="vm-frame-sortable">\n\t\t<template #content>\n\t\t\t<slot name="frame-header" />\n\t\t\t<div \n\t\t\t\t:style="[style, frameStyle]" \n\t\t\t\tclass="vm-frame-sortable__wrapper"\n\t\t\t\t@scroll="handleScroll"\n\t\t\t\t@dragover.prevent\n\t\t\t\t@dragenter="handleDragEnter"\n\t\t\t\t@dragleave="handleDragLeave"\n\t\t\t\t@drop="handleDrop"\n\t\t\t>\n\t\t\t\t<transition-group tag="div" name="flip-list">\n\t\t\t\t\t<div v-for="(it, index) in dataSource" :key="it.id" class="vm-frame-sortable__item">\n\t\t\t\t\t\t\x3c!-- prevent为true用于点击时可以触发输入框的失焦 --\x3e\n\t\t\t\t\t\t<div :style="getItemStyle(it, index)">\n\t\t\t\t\t\t\t<vm-sortable\n\t\t\t\t\t\t\t\tref="sort"\n\t\t\t\t\t\t\t\t:index="index"\n\t\t\t\t\t\t\t\t:type="dragType"\n\t\t\t\t\t\t\t\t:disabled="it.disabled"\n\t\t\t\t\t\t\t\t:draggable="it.draggable || typeof it.draggable === \'undefined\'"\n\t\t\t\t\t\t\t\t:closeable="it.closeable || typeof it.closeable === \'undefined\'"\n\t\t\t\t\t\t\t\t:prevent="false"\n\t\t\t\t\t\t\t\t@activated="$emit(\'activated\', arguments[0], it)"\n\t\t\t\t\t\t\t\t@deactivated="$emit(\'deactivated\', arguments[0], it)"\n\t\t\t\t\t\t\t\t@delete="$emit(\'change\', { type: \'delete\', id: it.id })"\n\t\t\t\t\t\t\t\t@sorting="handleSorting"\n\t\t\t\t\t\t\t\t@sort-end="handleSortEnd"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<component \n\t\t\t\t\t\t\t\t\t:is="`vm-${it.module}-viewer`" \n\t\t\t\t\t\t\t\t\t:index="index"\n\t\t\t\t\t\t\t\t\t:vm="vm"\n\t\t\t\t\t\t\t\t\tv-bind="it" \n\t\t\t\t\t\t\t\t\tstyle="min-height: 3px"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</vm-sortable>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if="it.placeholder" :style="{height: `${it.placeholder}px`}" />\n\t\t\t\t\t</div>\n\t\t\t\t</transition-group>\n\t\t\t</div>\n\t\t\t<slot name="frame-footer" />\n\t\t</template>\n\t</vm-inner>\n</template>\n\n<script>\nimport Inner from \'./inner.vue\';\nimport Sortable from \'../../../base/sortable.vue\';\nimport { getUid, cloneDeep, throttle } from \'../../../utils/helper\';\nimport { SORT_IN_FRAME, WIDGET_TO_FRAME, PAGE_MOULE } from \'../../../utils/constants\';\n\nexport default {\n\tname: \'vm-frame\',\n\tcomponents: {\n\t\t\'vm-sortable\': Sortable,\n\t\t\'vm-inner\': Inner,\n\t},\n\tprops: {\n\t\twidth: Number,\n\t\theight: Number,\n\t\tdataSource: Array,\n\t\teditor: Object,\n\t\tframeStyle: Object,\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tdragType: SORT_IN_FRAME,\n\t\t\tdragWaiting: false,\n\t\t\tscrollTop: 0,\n\t\t\tvm: {\n\t\t\t\ttype: \'frame\'\n\t\t\t}\n\t\t};\n\t},\n\tcomputed: {\n\t\tstyle() {\n\t\t\tconst w = !this.width ? \'auto\' : `${this.width}px`;\n\t\t\tconst h = !this.height ? \'auto\' : `${this.height}px`;\n\t\t\treturn {\n\t\t\t\twidth: w,\n\t\t\t\theight: h\n\t\t\t};\n\t\t},\n\t\thasPage() {\n\t\t\treturn this.dataSource.some(i => i.module === PAGE_MOULE);\n\t\t}\n\t},\n\tcreated() {\n\t\tthis.timer = null;\n\t},\n\tbeforeDestory() {\n\t\tclearTimeout(this.timer);\n\t},\n\tmethods: {\n\n\t\tgetItemStyle(it, index) {\n\n\t\t\tif (typeof it.wrapperStyle === \'function\') {\n\t\t\t\tconst { scrollTop, dataSource, vm } = this;\n\t\t\t\tlet params = {\n\t\t\t\t\trow: it,\n\t\t\t\t\tindex,\n\t\t\t\t\tdataSource,\n\t\t\t\t\tscrollTop,\n\t\t\t\t\tvm\n\t\t\t\t};\n\t\t\t\treturn it.wrapperStyle(params, this);\n\t\t\t}\n\n\t\t\treturn it.wrapperStyle || {};\n\t\t},\n\n\t\t// 不添加throttle, 具体情况draggable frame\n\t\thandleScroll(e) {\n\t\t\tthis.scrollTop = e.target.scrollTop;\n\t\t},\n\n\t\t/**\n\t\t * TODO：\n\t\t * 1. dragWaiting等待时，默认插入到最后一个\n\t\t * 2. 区分是widget还是内部排序\n\t\t */\n\t\thandleDragEnter(e) {\n\t\t\tthis.timer = setTimeout(() => {\n\t\t\t\tthis.dragWaiting = !this.$refs.sort || this.$refs.sort.every(i => i.highlight === false);\n\t\t\t}, 300);\n\t\t},\n\t\thandleDragLeave(e) {\n\t\t\tclearTimeout(this.timer);\n\t\t\tthis.dragWaiting = false;\n\t\t},\n\t\thandleDrop(e) {\n\t\t\tclearTimeout(this.timer);\n\t\t\tthis.dragWaiting = false;\n\n\t\t\tlet rowIndex = this.dataSource.length;\n\t\t\t/**\n\t\t\t * 清理高亮, 设置插入位置\n\t\t\t */\n\t\t\tif (this.$refs.sort) {\n\t\t\t\tthis.$refs.sort.forEach((instance, index) => {\n\t\t\t\t\tif (instance.highlight === true) {\n\t\t\t\t\t\trowIndex = instance.index + 1;\n\t\t\t\t\t\tinstance.highlight = false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlet { module, index } = JSON.parse(e.dataTransfer.getData(WIDGET_TO_FRAME)) || {};\n\t\t\tlet result = this.$parent.$options.modules[module];\n\t\t\t// 不存在的模块\n\t\t\tif (!result) return;\n\n\t\t\tif (result.max && result.max <= this.dataSource.filter(i => i.module === module).length) {\n\t\t\t\tthis.$emit(\'error\', {\n\t\t\t\t\ttype: \'create\',\n\t\t\t\t\tmsg: `当前模块最多只能创建${result.max}个`\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tlet id = getUid();\n\n\t\t\tlet data = {\n\t\t\t\t...cloneDeep(\n\t\t\t\t\ttypeof result.data === \'function\' \n\t\t\t\t\t\t? result.data(index, this.dataSource) \n\t\t\t\t\t\t: result.data\n\t\t\t\t),\n\t\t\t\tmodule,\n\t\t\t\tid,\n\t\t\t};\n\n\t\t\t// 计算是否允许插入\n\t\t\tif (typeof result.insertion === \'function\') {\n\t\t\t\tlet allow = result.insertion(rowIndex, this.dataSource);\n\n\t\t\t\tif (!allow) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// 只能插入到第一个位置\n\t\t\tswitch (result.insertion) {\n\t\t\t\tcase \'first\':\n\t\t\t\t\trowIndex = 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \'last\':\n\t\t\t\t\trowIndex = this.dataSource.length;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tthis.$emit(\'change\', { \n\t\t\t\ttype: \'CREATE\', \n\t\t\t\tindex: rowIndex,\n\t\t\t\tid,\n\t\t\t\tdata\n\t\t\t});\n\n\t\t\t// 新元素处于激活状态\n\t\t\tthis.setActived(rowIndex);\n\t\t},\n\n\t\t/**\n\t\t * refs.sort是递增的，和index无关\n\t\t */\n\t\tsetActived(index) {\n\t\t\tthis.$nextTick(() => {\n\t\t\t\ttry {\n\t\t\t\t\tlet target = this.$refs.sort.find(i => i.index === index);\n\t\t\t\t\ttarget.setActived();\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tsetActivedById(id) {\n\t\t\tthis.setActived(this.dataSource.findIndex(i => i.id === id));\n\t\t},\n\n\t\t/**\n\t\t * 交换位置\n\t\t */\n\t\thandleSorting(v) {\n\t\t\tthis.$emit(\'change\', {\n\t\t\t\ttype: \'SORT\',\n\t\t\t\tchanged: v,\n\t\t\t\thistory: false\n\t\t\t});\n\t\t},\n\n\n\t\thandleSortEnd(v) {\n\t\t\tthis.$emit(\'change\', {\n\t\t\t\ttype: \'SORT\',\n\t\t\t\toriginal: v,\n\t\t\t\thistory: true\n\t\t\t});\n\n\t\t\tthis.$emit(\'sort-end\', v, this.dataSource);\n\t\t}\n\t},\n};\n<\/script>\n\n<style lang="scss">\n@import "../../../style/index.scss";\n\n$block: vm-frame-sortable;\n\n@include block($block) {\n\tbackground: #f7f6fa;\n\tdisplay: flex;\n\tflex-direction: column;\n\t@include element(wrapper) {\n\t\tflex-shrink: 0;\n\t\tborder: 1px solid $border;\n\t\t// margin-left: 20px;\n\t\tposition: relative;\n\t\toverflow: auto;\n\t\t@include scroller();\n\t}\n\t@include element(item) {\n\t\ttransition: all .5s;\n\t}\n}\n\n// 开始消失/进入的元素\n.flip-list-enter, \n.flip-list-leave-to{\n\topacity: 0;\n}\n.flip-list-leave-active {\n\tdisplay: none;\n}\n</style>\n']},media:void 0})}),me,void 0,!1,void 0,!1,yt,void 0,void 0)},pe={name:"vm-widget",components:{"vc-customer":P.default,"vm-widget-item":Tt},props:{width:Number,height:Number,type:{type:String,default:"free"},dataSource:Array,contentStyle:Object},data:function(){var t,n=this.$parent.$options.modules,e={};for(var i in n){if(ot(n,i)&&"basic"!==n[i].type){var r=n[i],o=r.type||"undefined";e[o]||(e[o]=[],t=!0),(r.showWidget||void 0===r.showWidget)&&e[o].push({module:r.module,component:r.Widget||r.name,widgets:r.widgets,draggable:!(r.widgets||!r.Viewer||!r.Editor),active:!(!t||!r.widgets)})}t=!1}var a=Object.keys(e);return{toolsList:e,tabs:a.filter((function(t){return t&&"undefined"!==t})),showTip:!0,currentTab:a[0]}},computed:{style:function(){return{width:0===this.width?"auto":"".concat(this.width,"px"),height:0===this.height?"auto":"".concat(this.height,"px")}}},created:function(){},methods:{handleEvent:function(t){var n=this;return{change:function(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];return n.$emit.apply(n,["change",t].concat(i))}}}}},ge=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"vm-widget",style:t.style},[e("div",{staticClass:"vm-widget__wrapper"},[e("p",{staticClass:"vm-widget__header"},[t._v("\n\t\t\t组件库\n\t\t")]),t._v(" "),t.showTip?e("div",{staticClass:"vm-widget__tip"},[e("span",{staticClass:"vm-widget__icon-warn"},[t._v("!")]),t._v(" "),e("p",[t._v("请拖动下方组件到指定位置设置")]),t._v(" "),e("span",{on:{click:function(n){t.showTip=!t.showTip}}},[t._v("✕")])]):t._e(),t._v(" "),e("div",{staticClass:"vm-widget__menu"},[e("div",{staticClass:"vm-widget__tabs"},t._l(t.tabs,(function(n){return e("p",{key:n,class:{"is-active":t.currentTab==n},on:{click:function(e){t.currentTab=n}}},[t._v("\n\t\t\t\t\t"+t._s(n)+"\n\t\t\t\t")])})),0),t._v(" "),e("div",{staticClass:"vm-widget__content",style:t.contentStyle},t._l(t.toolsList[t.currentTab],(function(n){return e("vm-widget-item",{key:n.module,attrs:{draggable:n.draggable,module:n.module}},[e("div",{staticClass:"vm-widget__title",class:{"is-active":n.active,"is-draggable":n.draggable,"is-click":n.widgets},on:{click:function(t){n.widgets&&(n.active=!n.active)}}},["string"==typeof n.component?e("p",{domProps:{innerHTML:t._s(n.component)}}):e("vm-"+n.module+"-widget",t._g({tag:"component"},t.handleEvent(n.module))),t._v(" "),n.widgets?e("div",{staticClass:"vm-widget__arrow"}):t._e()],1),t._v(" "),n.active?e("div",{staticClass:"vm-widget__combo"},t._l(n.widgets,(function(i,r){return e("vm-widget-item",{key:r,staticClass:"vm-widget__item",attrs:{module:n.module,index:r,draggable:""}},[i.render?[e("vc-customer",{attrs:{render:i.render,index:r}})]:[e("img",{attrs:{src:i.image}}),t._v(" "),e("p",[t._v(t._s(i.name))])]],2)})),1):t._e()])})),1)])])])};ge._withStripped=!0;var fe=vt({render:ge,staticRenderFns:[]},(function(t){t&&t("data-v-1c0869e5_0",{source:"@charset \"UTF-8\";\n/**\n * [commonDirectionFill 方向名词补充]\n * @param  {[string]} $key [l r b t]\n * @return {[string]}      [left right bottom top]\n */\n/**\n * [commonColumnWidth 平均分配百分比]\n * @param  {[number]} $col   [所占比]\n * @param  {[number]} $total [总]\n * @return {[number]}        [所占比/总 * 100%]\n */\n/**\n * [commonBorder 1px的兼容问题]\n * @param  {[string]} $border: ltbr          [border的方向缩写拼接]\n * @return {[type]}          [1px border]\n */\n/**\n * 1px\n * 已为父元素添加position: relative;\n * 其他只操作before和after;\n * 暂时不抽离公用\n */\n/**\n * [commonPadding padding]\n * @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonMargin margin]\n* @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonAbsolute absolute]\n * @param  {[list]} $direction-val... [top, right, bottom, left 的值]\n * @return {[type]}                   [description]\n */\n/**\n * 水平垂直居中\n */\n/**\n * 文字相关\n */\n/**\n * 一行文字\n */\n/* stylelint-disable */\n/**\n * [commonClearfix 清除浮动]\n * @return {[type]} [description]\n */\n/* Var\n -------------------------- */\n/* Func\n -------------------------- */\n/* Mix\n -------------------------- */\n/**\n * @param $root: 默认置顶\n */\n/**\n * 1. +, >, ~, ' '\n * 2. 同element\n * 3. 同modifier\n * 4. 同block\n */\n/**\n * -> [className].is_require \n * 与xxx:hover类似\n */\n/**\n * 用 @at-root 来重置 & 读取次数的计数\n * 如 [clsssName] [className]:hover\n */\n/**\n * 自定义规则\n */\n/**\n * TODO: 使用vc-scroller;\n */\n.vm-widget {\n  -webkit-box-flex: 0;\n  -webkit-flex: 0 0 284px;\n      -ms-flex: 0 0 284px;\n          flex: 0 0 284px;\n  width: 284px;\n}\n.vm-widget__wrapper {\n  background: #fff;\n  padding: 10px 0 0;\n  height: 100%;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n  -webkit-flex-direction: column;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  -webkit-box-align: stretch;\n  -webkit-align-items: stretch;\n      -ms-flex-align: stretch;\n          align-items: stretch;\n}\n.vm-widget__header {\n  font-size: 15px;\n  color: #000;\n  padding: 8px 15px;\n  font-weight: 400;\n}\n.vm-widget__tip {\n  background: #FDF5E8;\n  height: 40px;\n  margin: 2px 9px 15px;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  padding: 0 10px;\n  color: #666;\n  border-radius: 4px;\n  border: none;\n}\n.vm-widget__tip p {\n  -webkit-box-flex: 1;\n  -webkit-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n}\n.vm-widget__tip span {\n  cursor: pointer;\n}\n.vm-widget__icon-warn {\n  width: 14px;\n  height: 14px;\n  background: #EC9C39;\n  border-radius: 100%;\n  color: #fff;\n  font-size: 12px;\n  line-height: 14px;\n  text-align: center;\n  margin-right: 7px;\n}\n.vm-widget__menu {\n  border-top: 1px solid #d9d9d9;\n  overflow-y: auto;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-flex: 1;\n  -webkit-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n  -webkit-box-pack: justify;\n  -webkit-justify-content: space-between;\n      -ms-flex-pack: justify;\n          justify-content: space-between;\n  -webkit-box-align: stretch;\n  -webkit-align-items: stretch;\n      -ms-flex-align: stretch;\n          align-items: stretch;\n  -webkit-flex-wrap: nowrap;\n      -ms-flex-wrap: nowrap;\n          flex-wrap: nowrap;\n}\n.vm-widget__tabs {\n  width: 48px;\n  height: 100%;\n  padding: 0;\n  color: #666;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  line-height: 24px;\n  font-size: 12px;\n  border-right: 1px solid #d9d9d9;\n  -webkit-box-pack: start;\n  -webkit-justify-content: flex-start;\n      -ms-flex-pack: start;\n          justify-content: flex-start;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n  -webkit-flex-direction: column;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  /**\n   * scrollbar width\n   */\n  /**\n   * scrollbar bg\n   */\n  /**\n   * Handle\n   */\n}\n.vm-widget__tabs::-webkit-scrollbar {\n  width: 4px;\n}\n.vm-widget__tabs::-webkit-scrollbar:horizontal {\n  height: 4px;\n}\n.vm-widget__tabs::-webkit-scrollbar-track {\n  background: rgba(0, 0, 0, 0);\n  z-index: 0;\n}\n.vm-widget__tabs::-webkit-scrollbar-thumb {\n  background: rgba(0, 0, 0, 0.2);\n  border: 1px solid rgba(0, 0, 0, 0.2);\n}\n.vm-widget__tabs::-webkit-scrollbar-corner {\n  background: rgba(0, 0, 0, 0.2);\n}\n.vm-widget__tabs p {\n  text-align: center;\n  height: 49px;\n  cursor: pointer;\n  line-height: 49px;\n}\n.vm-widget__tabs p.is-active {\n  color: #000000;\n  background-color: #efefef;\n}\n.vm-widget__content {\n  width: 236px;\n  overflow: auto;\n  height: 100%;\n  /**\n   * scrollbar width\n   */\n  /**\n   * scrollbar bg\n   */\n  /**\n   * Handle\n   */\n}\n.vm-widget__content::-webkit-scrollbar {\n  width: 4px;\n}\n.vm-widget__content::-webkit-scrollbar:horizontal {\n  height: 4px;\n}\n.vm-widget__content::-webkit-scrollbar-track {\n  background: rgba(0, 0, 0, 0);\n  z-index: 0;\n}\n.vm-widget__content::-webkit-scrollbar-thumb {\n  background: rgba(0, 0, 0, 0.2);\n  border: 1px solid rgba(0, 0, 0, 0.2);\n}\n.vm-widget__content::-webkit-scrollbar-corner {\n  background: rgba(0, 0, 0, 0.2);\n}\n.vm-widget__title {\n  padding: 15px 12px;\n  font-size: 12px;\n  color: #000;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: justify;\n  -webkit-justify-content: space-between;\n      -ms-flex-pack: justify;\n          justify-content: space-between;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  cursor: pointer;\n  border-bottom: 1px solid #d9d9d9;\n}\n.vm-widget__title.is-draggable {\n  cursor: move;\n}\n.vm-widget__title.is-click {\n  cursor: pointer;\n}\n.vm-widget__title.is-active {\n  color: #5495f6;\n}\n.vm-widget__title.is-active .vm-widget__arrow {\n  -webkit-transform: rotate(-135deg);\n      -ms-transform: rotate(-135deg);\n          transform: rotate(-135deg);\n}\n.vm-widget__arrow {\n  width: 8px;\n  height: 8px;\n  border: 2px solid #d9d9d9;\n  border-top: 0;\n  border-left: 0;\n  -webkit-transform: rotate(45deg);\n      -ms-transform: rotate(45deg);\n          transform: rotate(45deg);\n  -webkit-transition: -webkit-transform 0.2s ease-in-out;\n  transition: -webkit-transform 0.2s ease-in-out;\n  transition: transform 0.2s ease-in-out;\n  transition: transform 0.2s ease-in-out, -webkit-transform 0.2s ease-in-out;\n}\n.vm-widget__combo {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-flex-wrap: wrap;\n      -ms-flex-wrap: wrap;\n          flex-wrap: wrap;\n  width: 100%;\n  border-bottom: 1px solid #d9d9d9;\n  padding: 6px 6px;\n}\n.vm-widget__item {\n  -webkit-box-flex: 0;\n  -webkit-flex: 0 0 50%;\n      -ms-flex: 0 0 50%;\n          flex: 0 0 50%;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n  -webkit-flex-direction: column;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  padding: 6px 6px;\n  cursor: move;\n}\n.vm-widget__item img {\n  width: 100%;\n}\n.vm-widget__item p {\n  padding-top: 8px;\n}\n\n/*# sourceMappingURL=widget.vue.map */",map:{version:3,sources:["widget.vue","/Users/deot/Desktop/wya/github/wya-vm/src/combo/widget/widget.vue"],names:[],mappings:"AAAA,gBAAgB;AAChB;;;;EAIE;AACF;;;;;EAKE;AACF;;;;EAIE;AACF;;;;;EAKE;ACkJF;;;;;;;EAAA;AAsBA;;;;;;;EAAA;AAsBA;;;;EAAA;AAqBA;;EAAA;AASA;;EAAA;AAIA;;EAAA;AAUA,sBAAA;AAWA;;;EAAA;ADjNA;6BAC6B;AAC7B;6BAC6B;AAC7B;6BAC6B;AAC7B;;EAEE;AACF;;;;;EAKE;AC+GF;;;EAAA;AAkBA;;;EAAA;AAUA;;EAAA;AD/HA;;EAEE;AACF;EC0EA,mBAAA;EAAA,uBAAA;MAAA,mBAAA;UAAA,eAAA;EACA,YAJA;ADpEA;AACA;ECyEA,gBAAA;EACA,iBAAA;EACA,YAAA;EACA,oBAAA;EAAA,qBAAA;EAAA,oBAAA;EAAA,aAAA;EACA,4BAAA;EAAA,6BAAA;EAAA,8BAAA;MAAA,0BAAA;UAAA,sBAAA;EACA,0BAAA;EAAA,4BAAA;MAAA,uBAAA;UAAA,oBAAA;ADvEA;AAEA;ECwEA,eAAA;EACA,WAAA;EACA,iBAAA;EACA,gBAAA;ADtEA;AAEA;ECuEA,mBAAA;EACA,YAAA;EACA,oBAAA;EACA,oBAAA;EAAA,qBAAA;EAAA,oBAAA;EAAA,aAAA;EACA,yBAAA;EAAA,2BAAA;MAAA,sBAAA;UAAA,mBAAA;EACA,eAAA;EACA,WAAA;EACA,kBAAA;EACA,YAAA;ADrEA;ACsEA;EACA,mBAAA;EAAA,eAAA;MAAA,WAAA;UAAA,OAAA;ADpEA;ACsEA;EAEA,eAAA;ADrEA;AAEA;ECuEA,WAAA;EACA,YAAA;EACA,mBAAA;EACA,mBAAA;EACA,WAAA;EACA,eAAA;EACA,iBAAA;EACA,kBAAA;EACA,iBAAA;ADrEA;AAEA;ECsEA,6BAAA;EACA,gBAAA;EACA,oBAAA;EAAA,qBAAA;EAAA,oBAAA;EAAA,aAAA;EACA,mBAAA;EAAA,eAAA;MAAA,WAAA;UAAA,OAAA;EACA,yBAAA;EAAA,sCAAA;MAAA,sBAAA;UAAA,8BAAA;EACA,0BAAA;EAAA,4BAAA;MAAA,uBAAA;UAAA,oBAAA;EACA,yBAAA;MAAA,qBAAA;UAAA,iBAAA;ADpEA;AAEA;ECqEA,WA5DA;EA6DA,YAAA;EACA,UAAA;EACA,WAAA;EACA,oBAAA;EAAA,qBAAA;EAAA,oBAAA;EAAA,aAAA;EACA,iBAAA;EACA,eAAA;EACA,+BAAA;EACA,uBAAA;EAAA,mCAAA;MAAA,oBAAA;UAAA,2BAAA;EACA,4BAAA;EAAA,6BAAA;EAAA,8BAAA;MAAA,0BAAA;UAAA,sBAAA;EDnEE;;IAEE;EACF;;IAEE;EACF;;IAEE;AACJ;AACA;EACE,UAAU;AACZ;AACA;EACE,WAAW;AACb;AACA;EACE,4BAA4B;EAC5B,UAAU;AACZ;AACA;EACE,8BAA8B;EAC9B,oCAAoC;AACtC;AACA;EACE,8BAA8B;AAChC;AC2CA;EACA,kBAAA;EACA,YAAA;EACA,eAAA;EACA,iBAAA;ADzCA;AC0CA;EACA,cAAA;EACA,yBAAA;ADxCA;AAEA;EC2CA,YAlFA;EAmFA,cAAA;EACA,YAAA;EDzCE;;IAEE;EACF;;IAEE;EACF;;IAEE;AACJ;AACA;EACE,UAAU;AACZ;AACA;EACE,WAAW;AACb;AACA;EACE,4BAA4B;EAC5B,UAAU;AACZ;AACA;EACE,8BAA8B;EAC9B,oCAAoC;AACtC;AACA;EACE,8BAA8B;AAChC;AAEA;ECkBA,kBAAA;EACA,eAAA;EACA,WAAA;EAEA,oBAAA;EAAA,qBAAA;EAAA,oBAAA;EAAA,aAAA;EACA,yBAAA;EAAA,sCAAA;MAAA,sBAAA;UAAA,8BAAA;EACA,yBAAA;EAAA,2BAAA;MAAA,sBAAA;UAAA,mBAAA;EACA,eAAA;EACA,gCAAA;ADjBA;AC1CA;EA6DA,YAAA;ADhBA;AC7CA;EAgEA,eAAA;ADfA;ACjDA;EAmEA,cAAA;ADdA;ACeA;EACA,kCAAA;MAAA,8BAAA;UAAA,0BAAA;ADbA;AAEA;ECgBA,UAAA;EACA,WAAA;EACA,yBAAA;EACA,aAAA;EACA,cAAA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;EACA,sDAAA;EAAA,8CAAA;EAAA,sCAAA;EAAA,0EAAA;ADdA;AAEA;ECeA,oBAAA;EAAA,qBAAA;EAAA,oBAAA;EAAA,aAAA;EACA,uBAAA;MAAA,mBAAA;UAAA,eAAA;EACA,WAAA;EACA,gCAAA;EAEA,gBAAA;ADdA;AAEA;ECeA,mBAAA;EAAA,qBAAA;MAAA,iBAAA;UAAA,aAAA;EACA,oBAAA;EAAA,qBAAA;EAAA,oBAAA;EAAA,aAAA;EACA,yBAAA;EAAA,2BAAA;MAAA,sBAAA;UAAA,mBAAA;EACA,4BAAA;EAAA,6BAAA;EAAA,8BAAA;MAAA,0BAAA;UAAA,sBAAA;EACA,gBAAA;EACA,YAAA;ADbA;ACcA;EACA,WAAA;ADZA;ACeA;EACA,gBAAA;ADbA;;AAEA,qCAAqC",file:"widget.vue",sourcesContent:["@charset \"UTF-8\";\n/**\n * [commonDirectionFill 方向名词补充]\n * @param  {[string]} $key [l r b t]\n * @return {[string]}      [left right bottom top]\n */\n/**\n * [commonColumnWidth 平均分配百分比]\n * @param  {[number]} $col   [所占比]\n * @param  {[number]} $total [总]\n * @return {[number]}        [所占比/总 * 100%]\n */\n/**\n * [commonBorder 1px的兼容问题]\n * @param  {[string]} $border: ltbr          [border的方向缩写拼接]\n * @return {[type]}          [1px border]\n */\n/**\n * 1px\n * 已为父元素添加position: relative;\n * 其他只操作before和after;\n * 暂时不抽离公用\n */\n/**\n * [commonPadding padding]\n * @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonMargin margin]\n* @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonAbsolute absolute]\n * @param  {[list]} $direction-val... [top, right, bottom, left 的值]\n * @return {[type]}                   [description]\n */\n/**\n * 水平垂直居中\n */\n/**\n * 文字相关\n */\n/**\n * 一行文字\n */\n/* stylelint-disable */\n/**\n * [commonClearfix 清除浮动]\n * @return {[type]} [description]\n */\n/* Var\n -------------------------- */\n/* Func\n -------------------------- */\n/* Mix\n -------------------------- */\n/**\n * @param $root: 默认置顶\n */\n/**\n * 1. +, >, ~, ' '\n * 2. 同element\n * 3. 同modifier\n * 4. 同block\n */\n/**\n * -> [className].is_require \n * 与xxx:hover类似\n */\n/**\n * 用 @at-root 来重置 & 读取次数的计数\n * 如 [clsssName] [className]:hover\n */\n/**\n * 自定义规则\n */\n/**\n * TODO: 使用vc-scroller;\n */\n.vm-widget {\n  flex: 0 0 284px;\n  width: 284px;\n}\n.vm-widget__wrapper {\n  background: #fff;\n  padding: 10px 0 0;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n}\n\n.vm-widget__header {\n  font-size: 15px;\n  color: #000;\n  padding: 8px 15px;\n  font-weight: 400;\n}\n\n.vm-widget__tip {\n  background: #FDF5E8;\n  height: 40px;\n  margin: 2px 9px 15px;\n  display: flex;\n  align-items: center;\n  padding: 0 10px;\n  color: #666;\n  border-radius: 4px;\n  border: none;\n}\n.vm-widget__tip p {\n  flex: 1;\n}\n.vm-widget__tip span {\n  cursor: pointer;\n}\n\n.vm-widget__icon-warn {\n  width: 14px;\n  height: 14px;\n  background: #EC9C39;\n  border-radius: 100%;\n  color: #fff;\n  font-size: 12px;\n  line-height: 14px;\n  text-align: center;\n  margin-right: 7px;\n}\n\n.vm-widget__menu {\n  border-top: 1px solid #d9d9d9;\n  overflow-y: auto;\n  display: flex;\n  flex: 1;\n  justify-content: space-between;\n  align-items: stretch;\n  flex-wrap: nowrap;\n}\n\n.vm-widget__tabs {\n  width: 48px;\n  height: 100%;\n  padding: 0;\n  color: #666;\n  display: flex;\n  line-height: 24px;\n  font-size: 12px;\n  border-right: 1px solid #d9d9d9;\n  justify-content: flex-start;\n  flex-direction: column;\n  /**\n   * scrollbar width\n   */\n  /**\n   * scrollbar bg\n   */\n  /**\n   * Handle\n   */\n}\n.vm-widget__tabs::-webkit-scrollbar {\n  width: 4px;\n}\n.vm-widget__tabs::-webkit-scrollbar:horizontal {\n  height: 4px;\n}\n.vm-widget__tabs::-webkit-scrollbar-track {\n  background: rgba(0, 0, 0, 0);\n  z-index: 0;\n}\n.vm-widget__tabs::-webkit-scrollbar-thumb {\n  background: rgba(0, 0, 0, 0.2);\n  border: 1px solid rgba(0, 0, 0, 0.2);\n}\n.vm-widget__tabs::-webkit-scrollbar-corner {\n  background: rgba(0, 0, 0, 0.2);\n}\n.vm-widget__tabs p {\n  text-align: center;\n  height: 49px;\n  cursor: pointer;\n  line-height: 49px;\n}\n.vm-widget__tabs p.is-active {\n  color: #000000;\n  background-color: #efefef;\n}\n\n.vm-widget__content {\n  width: 236px;\n  overflow: auto;\n  height: 100%;\n  /**\n   * scrollbar width\n   */\n  /**\n   * scrollbar bg\n   */\n  /**\n   * Handle\n   */\n}\n.vm-widget__content::-webkit-scrollbar {\n  width: 4px;\n}\n.vm-widget__content::-webkit-scrollbar:horizontal {\n  height: 4px;\n}\n.vm-widget__content::-webkit-scrollbar-track {\n  background: rgba(0, 0, 0, 0);\n  z-index: 0;\n}\n.vm-widget__content::-webkit-scrollbar-thumb {\n  background: rgba(0, 0, 0, 0.2);\n  border: 1px solid rgba(0, 0, 0, 0.2);\n}\n.vm-widget__content::-webkit-scrollbar-corner {\n  background: rgba(0, 0, 0, 0.2);\n}\n\n.vm-widget__title {\n  padding: 15px 12px;\n  font-size: 12px;\n  color: #000;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  cursor: pointer;\n  border-bottom: 1px solid #d9d9d9;\n}\n.vm-widget__title.is-draggable {\n  cursor: move;\n}\n\n.vm-widget__title.is-click {\n  cursor: pointer;\n}\n\n.vm-widget__title.is-active {\n  color: #5495f6;\n}\n.vm-widget__title.is-active .vm-widget__arrow {\n  transform: rotate(-135deg);\n}\n\n.vm-widget__arrow {\n  width: 8px;\n  height: 8px;\n  border: 2px solid #d9d9d9;\n  border-top: 0;\n  border-left: 0;\n  transform: rotate(45deg);\n  transition: transform 0.2s ease-in-out;\n}\n\n.vm-widget__combo {\n  display: flex;\n  flex-wrap: wrap;\n  width: 100%;\n  border-bottom: 1px solid #d9d9d9;\n  padding: 6px 6px;\n}\n\n.vm-widget__item {\n  flex: 0 0 50%;\n  display: flex;\n  align-items: center;\n  flex-direction: column;\n  padding: 6px 6px;\n  cursor: move;\n}\n.vm-widget__item img {\n  width: 100%;\n}\n.vm-widget__item p {\n  padding-top: 8px;\n}\n\n/*# sourceMappingURL=widget.vue.map */",'<template>\n\t<div :style="style" class="vm-widget">\n\t\t<div class="vm-widget__wrapper">\n\t\t\t<p class="vm-widget__header">\n\t\t\t\t组件库\n\t\t\t</p>\n\t\t\t<div v-if="showTip" class="vm-widget__tip">\n\t\t\t\t<span class="vm-widget__icon-warn">!</span>\n\t\t\t\t<p>请拖动下方组件到指定位置设置</p>\n\t\t\t\t<span @click="showTip = !showTip">✕</span>\n\t\t\t</div>\n\t\t\t<div class="vm-widget__menu">\n\t\t\t\t<div class="vm-widget__tabs">\n\t\t\t\t\t<p\n\t\t\t\t\t\tv-for="(item) in tabs"\n\t\t\t\t\t\t:key="item"\n\t\t\t\t\t\t:class="{ \'is-active\': currentTab == item}"\n\t\t\t\t\t\t@click="currentTab = item"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ item }}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<div :style="contentStyle" class="vm-widget__content">\n\t\t\t\t\t<vm-widget-item\n\t\t\t\t\t\tv-for="(it) in toolsList[currentTab]"\n\t\t\t\t\t\t:key="it.module"\n\t\t\t\t\t\t:draggable="it.draggable"\n\t\t\t\t\t\t:module="it.module"\n\t\t\t\t\t>\n\t\t\t\t\t\t\x3c!-- 组件标题 --\x3e\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t:class="{ \'is-active\': it.active, \'is-draggable\': it.draggable, \'is-click\': it.widgets }"\n\t\t\t\t\t\t\tclass="vm-widget__title"\n\t\t\t\t\t\t\t@click="it.widgets && (it.active = !it.active)"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\x3c!-- eslint-disable --\x3e\n\t\t\t\t\t\t\t<p v-if="typeof it.component === \'string\'" v-html="it.component" />\n\t\t\t\t\t\t\t\x3c!-- eslint-enable --\x3e\n\t\t\t\t\t\t\t<component :is="`vm-${it.module}-widget`" v-else v-on="handleEvent(it.module)" />\n\t\t\t\t\t\t\t<div v-if="it.widgets" class="vm-widget__arrow" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\x3c!-- 子元素 --\x3e\n\t\t\t\t\t\t<div v-if="it.active" class="vm-widget__combo">\n\t\t\t\t\t\t\t<vm-widget-item\n\t\t\t\t\t\t\t\tv-for="(widget, index) in it.widgets"\n\t\t\t\t\t\t\t\t:key="index"\n\t\t\t\t\t\t\t\t:module="it.module"\n\t\t\t\t\t\t\t\t:index="index"\n\t\t\t\t\t\t\t\tdraggable\n\t\t\t\t\t\t\t\tclass="vm-widget__item"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<template v-if="widget.render">\n\t\t\t\t\t\t\t\t\t<vc-customer\n\t\t\t\t\t\t\t\t\t\t:render="widget.render"\n\t\t\t\t\t\t\t\t\t\t:index="index"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t<img :src="widget.image">\n\t\t\t\t\t\t\t\t\t<p>{{ widget.name }}</p>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</vm-widget-item>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</vm-widget-item>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport Widget from \'../../base/widget.vue\';\nimport { hasOwn } from \'../../utils/helper\';\nimport { WIDGET_TO_FRAME } from \'../../utils/constants\';\nimport { Customer } from \'../../vc\';\n\nexport default {\n\tname: \'vm-widget\',\n\tcomponents: {\n\t\t\'vc-customer\': Customer,\n\t\t\'vm-widget-item\': Widget,\n\t},\n\tprops: {\n\t\twidth: Number,\n\t\theight: Number,\n\t\ttype: {\n\t\t\ttype: String,\n\t\t\tdefault: \'free\' // sort-list\n\t\t},\n\t\tdataSource: Array,\n\t\tcontentStyle: Object\n\t},\n\tdata() {\n\t\tconst { modules } = this.$parent.$options;\n\t\tlet toolsList = {};\n\t\tlet isFirst;\n\t\tfor (let key in modules) {\n\t\t\t// 过滤页面设置\n\t\t\tif (hasOwn(modules, key) && modules[key].type !== \'basic\') {\n\t\t\t\tlet item = modules[key];\n\t\t\t\tlet type = item.type || \'undefined\';\n\t\t\t\tif (!toolsList[type]) {\n\t\t\t\t\ttoolsList[type] = [];\n\t\t\t\t\tisFirst = true;\n\t\t\t\t}\n\t\t\t\tif (item.showWidget || typeof item.showWidget === \'undefined\') {\n\t\t\t\t\ttoolsList[type].push({\n\t\t\t\t\t\tmodule: item.module,\n\t\t\t\t\t\tcomponent: item.Widget || item.name,\n\t\t\t\t\t\twidgets: item.widgets,\n\t\t\t\t\t\t// 最外层拖拽\n\t\t\t\t\t\tdraggable: !!(!item.widgets && item.Viewer && item.Editor),\n\n\t\t\t\t\t\t// 更多, 由click事件控制\n\t\t\t\t\t\tactive: !!(isFirst && item.widgets)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tisFirst = false;\n\t\t}\n\t\tlet tabs = Object.keys(toolsList);\n\t\treturn {\n\t\t\ttoolsList,\n\t\t\ttabs: tabs.filter(i => i && i !== \'undefined\'),\n\t\t\tshowTip: true,\n\t\t\tcurrentTab: tabs[0]\n\t\t};\n\t},\n\tcomputed: {\n\t\tstyle() {\n\t\t\tconst w = this.width === 0 ? \'auto\' : `${this.width}px`;\n\t\t\tconst h = this.height === 0 ? \'auto\' : `${this.height}px`;\n\n\t\t\treturn {\n\t\t\t\twidth: w,\n\t\t\t\theight: h\n\t\t\t};\n\t\t}\n\t},\n\tcreated() {\n\t\t// console.log(this.$options.modules);\n\t},\n\tmethods: {\n\t\thandleEvent(module) {\n\t\t\treturn {\n\t\t\t\tchange: (...rest) => this.$emit(\'change\', module, ...rest)\n\t\t\t};\n\t\t}\n\t},\n};\n<\/script>\n\n<style lang="scss">\n@import "../../style/index.scss";\n\n$block: vm-widget;\n$tabs-w: 48px;\n$content-w: 236px;\n$w: $tabs-w + $content-w;\n\n@include block($block) {\n\tflex: 0 0 $w;\n\twidth: $w;\n\t@include element(wrapper) {\n\t\tbackground: $white;\n\t\tpadding: 10px 0 0;\n\t\theight: 100%;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: stretch;\n\t}\n\t@include element(header) {\n\t\tfont-size: 15px;\n\t\tcolor: #000;\n\t\tpadding: 8px 15px;\n\t\tfont-weight: 400;\n\t}\n\t@include element(tip) {\n\t\tbackground: #FDF5E8;\n\t\theight: 40px;\n\t\tmargin: 2px 9px 15px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tpadding: 0 10px;\n\t\tcolor: $assit;\n\t\tborder-radius: 4px;\n\t\tborder:none;\n\t\tp {\n\t\t\tflex: 1;\n\t\t}\n\t\tspan {\n\t\t\t// color: $assit;\n\t\t\tcursor: pointer;\n\t\t}\n\t}\n\t@include element(icon-warn) {\n\t\twidth: 14px;\n\t\theight: 14px;\n\t\tbackground: #EC9C39;\n\t\tborder-radius: 100%;\n\t\tcolor: $white;\n\t\tfont-size: 12px;\n\t\tline-height: 14px;\n\t\ttext-align: center;\n\t\tmargin-right: 7px;\n\t}\n\t@include element(menu) {\n\t\tborder-top: 1px solid $border;\n\t\toverflow-y: auto;\n\t\tdisplay: flex;\n\t\tflex:1;\n\t\tjustify-content: space-between;\n\t\talign-items: stretch;\n\t\tflex-wrap: nowrap;\n\t}\n\t@include element(tabs) {\n\t\twidth: $tabs-w;\n\t\theight: 100%;\n\t\tpadding: 0;\n\t\tcolor: $assit;\n\t\tdisplay: flex;\n\t\tline-height: 24px;\n\t\tfont-size: 12px;\n\t\tborder-right: 1px solid $border;\n\t\tjustify-content: flex-start;\n\t\tflex-direction: column;\n\t\t@include scroller();\n\t\tp {\n\t\t\ttext-align: center;\n\t\t\theight: 49px;\n\t\t\tcursor: pointer;\n\t\t\tline-height: 49px;\n\t\t\t&.is-active {\n\t\t\t\tcolor: $black;\n\t\t\t\tbackground-color: $acitved;\n\t\t\t}\n\t\t}\n\t}\n\t@include element(content) {\n\t\twidth: $content-w;\n\t\toverflow: auto;\n\t\theight: 100%;\n\t\t@include scroller();\n\t}\n\n\t@include element(title) {\n\t\tpadding: 15px 12px;\n\t\tfont-size: 12px;\n\t\tcolor: #000;\n\t\t// font-weight: bold;\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tcursor: pointer;\n\t\tborder-bottom: 1px solid $border;\n\t\t@include when(draggable) {\n\t\t\tcursor: move;\n\t\t}\n\t\t@include when(click) {\n\t\t\tcursor: pointer;\n\t\t}\n\t\t@include when(active) {\n\t\t\tcolor: $primary;\n\t\t\t.vm-widget__arrow {\n\t\t\t\ttransform: rotate(-135deg);\n\t\t\t}\n\t\t}\n\t}\n\t@include element(arrow) {\n\t\twidth: 8px;\n\t\theight: 8px;\n\t\tborder: 2px solid $border;\n\t\tborder-top: 0;\n\t\tborder-left: 0;\n\t\ttransform: rotate(45deg);\n\t\ttransition: transform 0.2s ease-in-out;\n\t}\n\t@include element(combo) {\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t\twidth: 100%;\n\t\tborder-bottom: 1px solid $border;\n\t\t// justify-content: center;\n\t\tpadding: 6px 6px;\n\t}\n\t@include element(item) {\n\t\tflex: 0 0 50%;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tflex-direction: column;\n\t\tpadding: 6px 6px;\n\t\tcursor: move;\n\t\timg {\n\t\t\twidth: 100%;\n\t\t\t// border: 1px dashed $border;\n\t\t}\n\t\tp {\n\t\t\tpadding-top: 8px;\n\t\t}\n\t}\n}\n\n</style>\n']},media:void 0})}),pe,void 0,!1,void 0,!1,yt,void 0,void 0),be=["id","history"];function ve(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,i)}return e}function xe(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?ve(Object(e),!0).forEach((function(n){S.default(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):ve(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}var Ee={name:"vm-editor",components:{},props:{value:Object,width:{type:Number,default:328},height:Number},data:function(){return{SELECTION_MODULE:Z,currentValue:this.value}},computed:{styles:function(){var t=this.width;return{flex:"0 0 ".concat(t,"px"),width:"".concat(t,"px")}}},watch:{value:{deep:!0,handler:function(t){this.resetCurEditor(this.value)}}},methods:{resetCurEditor:o.debounce((function(){this.currentValue=this.value}),10),handleChange:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("object"===M.default(t)){var n=t.id,e=t.history,i=z.default(t,be),r={};for(var o in i){var a=i[o];["x","y","z","r","w","h"].includes(o)&&(a=Number(a)),ot(i,o)&&!dt(a)&&(r[o]=a)}this.$emit("change",{type:"UPDATE",id:n||this.currentValue.id,changed:r,history:e})}},emitChange:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.handleChange(xe(xe({},n),{},{id:t}))}}},ye=function(){var t=this,n=t.$createElement,e=t._self._c||n;return t.currentValue?e("div",{staticClass:"vm-editor vm-hack-editor",style:t.styles},[e("div",{staticClass:"vm-editor__wrapper"},[t.currentValue.module!==t.SELECTION_MODULE?[e("vm-"+t.currentValue.module+"-editor",t._b({key:t.currentValue.id,ref:"target",tag:"component",on:{change:t.handleChange}},"component",t.currentValue,!1,!0))]:[e("div")]],2)]):t._e()};ye._withStripped=!0;var we=vt({render:ye,staticRenderFns:[]},(function(t){t&&t("data-v-5f1898da_0",{source:"@charset \"UTF-8\";\n/**\n * [commonDirectionFill 方向名词补充]\n * @param  {[string]} $key [l r b t]\n * @return {[string]}      [left right bottom top]\n */\n/**\n * [commonColumnWidth 平均分配百分比]\n * @param  {[number]} $col   [所占比]\n * @param  {[number]} $total [总]\n * @return {[number]}        [所占比/总 * 100%]\n */\n/**\n * [commonBorder 1px的兼容问题]\n * @param  {[string]} $border: ltbr          [border的方向缩写拼接]\n * @return {[type]}          [1px border]\n */\n/**\n * 1px\n * 已为父元素添加position: relative;\n * 其他只操作before和after;\n * 暂时不抽离公用\n */\n/**\n * [commonPadding padding]\n * @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonMargin margin]\n* @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonAbsolute absolute]\n * @param  {[list]} $direction-val... [top, right, bottom, left 的值]\n * @return {[type]}                   [description]\n */\n/**\n * 水平垂直居中\n */\n/**\n * 文字相关\n */\n/**\n * 一行文字\n */\n/* stylelint-disable */\n/**\n * [commonClearfix 清除浮动]\n * @return {[type]} [description]\n */\n/* Var\n -------------------------- */\n/* Func\n -------------------------- */\n/* Mix\n -------------------------- */\n/**\n * @param $root: 默认置顶\n */\n/**\n * 1. +, >, ~, ' '\n * 2. 同element\n * 3. 同modifier\n * 4. 同block\n */\n/**\n * -> [className].is_require \n * 与xxx:hover类似\n */\n/**\n * 用 @at-root 来重置 & 读取次数的计数\n * 如 [clsssName] [className]:hover\n */\n/**\n * 自定义规则\n */\n/**\n * TODO: 使用vc-scroller;\n */\n.vm-editor {\n  -webkit-flex-shrink: 0;\n      -ms-flex-negative: 0;\n          flex-shrink: 0;\n}\n.vm-editor__wrapper {\n  position: relative;\n  padding: 0;\n  height: 100%;\n  border: 1px solid rgba(0,0,0,0.10196);\n  border-radius: 0px;\n  -webkit-box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);\n          box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);\n  background: #fff;\n  z-index: 2;\n}\n.vm-editor__arrow {\n  left: -7px;\n  top: 20px;\n  width: 14px;\n  height: 14px;\n  -webkit-transform: translateX(-50%) rotate(45deg);\n      -ms-transform: translateX(-50%) rotate(45deg);\n          transform: translateX(-50%) rotate(45deg);\n  -webkit-box-shadow: -3px 3px 7px rgba(0, 0, 0, 0.07);\n          box-shadow: -3px 3px 7px rgba(0, 0, 0, 0.07);\n  background: #fff;\n  -webkit-transform: rotate(45deg);\n      -ms-transform: rotate(45deg);\n          transform: rotate(45deg);\n  position: absolute;\n  border-color: rgba(0,0,0,0);\n  border-style: solid;\n  border-left: 1px solid rgba(0,0,0,0.10196);\n  border-bottom: 1px solid rgba(0,0,0,0.10196);\n}\n\n/*# sourceMappingURL=editor.vue.map */",map:{version:3,sources:["editor.vue","/Users/deot/Desktop/wya/github/wya-vm/src/combo/editor/editor.vue"],names:[],mappings:"AAAA,gBAAgB;AAChB;;;;EAIE;AACF;;;;;EAKE;AACF;;;;EAIE;AACF;;;;;EAKE;AACF;;;;;;;EAOE;AACF;;;;;;;EAOE;AACF;;;;EAIE;AACF;;EAEE;AACF;;EAEE;AACF;;EAEE;AACF,sBAAsB;AACtB;;;EAGE;AACF;6BAC6B;AAC7B;6BAC6B;AAC7B;6BAC6B;AAC7B;;EAEE;ACgFF;;;;;EAAA;ADzEA;;;EAGE;AACF;;;EAGE;AACF;;EAEE;AACF;;EAEE;AACF;ECmCA,sBAAA;MAAA,oBAAA;UAAA,cAAA;ADjCA;AACA;ECkCA,kBAAA;EACA,UAAA;EACA,YAAA;EACA,qCAAA;EACA,kBAAA;EACA,kDAAA;UAAA,0CAAA;EACA,gBAAA;EACA,UAAA;ADhCA;AAEA;ECiCA,UAAA;EACA,SAAA;EACA,WAAA;EACA,YAAA;EACA,iDAAA;MAAA,6CAAA;UAAA,yCAAA;EACA,oDAAA;UAAA,4CAAA;EACA,gBAAA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;EACA,kBAAA;EACA,2BAAA;EACA,mBAAA;EACA,0CAAA;EACA,4CAAA;AD/BA;;AAEA,qCAAqC",file:"editor.vue",sourcesContent:["@charset \"UTF-8\";\n/**\n * [commonDirectionFill 方向名词补充]\n * @param  {[string]} $key [l r b t]\n * @return {[string]}      [left right bottom top]\n */\n/**\n * [commonColumnWidth 平均分配百分比]\n * @param  {[number]} $col   [所占比]\n * @param  {[number]} $total [总]\n * @return {[number]}        [所占比/总 * 100%]\n */\n/**\n * [commonBorder 1px的兼容问题]\n * @param  {[string]} $border: ltbr          [border的方向缩写拼接]\n * @return {[type]}          [1px border]\n */\n/**\n * 1px\n * 已为父元素添加position: relative;\n * 其他只操作before和after;\n * 暂时不抽离公用\n */\n/**\n * [commonPadding padding]\n * @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonMargin margin]\n* @param  {[number/string]} $t  [string 方向首字母拼接 top的距离]\n * @param  {[number]} $r: $t            [right的距离]\n * @param  {[number]} $b: $t            [bottom的距离]\n * @param  {[number]} $l: $r            [left的距离]\n * @return {[type]}     [description]\n */\n/**\n * [commonAbsolute absolute]\n * @param  {[list]} $direction-val... [top, right, bottom, left 的值]\n * @return {[type]}                   [description]\n */\n/**\n * 水平垂直居中\n */\n/**\n * 文字相关\n */\n/**\n * 一行文字\n */\n/* stylelint-disable */\n/**\n * [commonClearfix 清除浮动]\n * @return {[type]} [description]\n */\n/* Var\n -------------------------- */\n/* Func\n -------------------------- */\n/* Mix\n -------------------------- */\n/**\n * @param $root: 默认置顶\n */\n/**\n * 1. +, >, ~, ' '\n * 2. 同element\n * 3. 同modifier\n * 4. 同block\n */\n/**\n * -> [className].is_require \n * 与xxx:hover类似\n */\n/**\n * 用 @at-root 来重置 & 读取次数的计数\n * 如 [clsssName] [className]:hover\n */\n/**\n * 自定义规则\n */\n/**\n * TODO: 使用vc-scroller;\n */\n.vm-editor {\n  flex-shrink: 0;\n}\n.vm-editor__wrapper {\n  position: relative;\n  padding: 0;\n  height: 100%;\n  border: 1px solid #0000001a;\n  border-radius: 0px;\n  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);\n  background: #fff;\n  z-index: 2;\n}\n\n.vm-editor__arrow {\n  left: -7px;\n  top: 20px;\n  width: 14px;\n  height: 14px;\n  transform: translateX(-50%) rotate(45deg);\n  box-shadow: -3px 3px 7px rgba(0, 0, 0, 0.07);\n  background: #fff;\n  transform: rotate(45deg);\n  position: absolute;\n  border-color: #0000;\n  border-style: solid;\n  border-left: 1px solid #0000001a;\n  border-bottom: 1px solid #0000001a;\n}\n\n/*# sourceMappingURL=editor.vue.map */",'<template>\n\t<div \n\t\tv-if="currentValue"\n\t\t:style="styles" \n\t\tclass="vm-editor vm-hack-editor"\n\t>\t\n\t\t<div class="vm-editor__wrapper">\n\t\t\t\x3c!-- <div class="vm-editor__arrow" /> --\x3e\n\t\t\t<template v-if="currentValue.module !== SELECTION_MODULE">\n\t\t\t\t\x3c!-- vm-type让组件内部处理如何渲染或其他操作 --\x3e\n\t\t\t\t<component\n\t\t\t\t\t:is="`vm-${currentValue.module}-editor`"\n\t\t\t\t\tref="target"\n\t\t\t\t\t:key="currentValue.id"\n\t\t\t\t\tv-bind.sync="currentValue"\n\t\t\t\t\t@change="handleChange"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t\x3c!-- 组合拖拽 --\x3e\n\t\t\t\t<div />\n\t\t\t</template>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport { valueIsNaN, hasOwn, getUid, debounce } from "../../utils/helper";\nimport { SELECTION_MODULE } from "../../utils/constants";\n\nexport default {\n\tname: \'vm-editor\',\n\tcomponents: {\n\t},\n\tprops: {\n\t\tvalue: Object,\n\t\twidth: {\n\t\t\ttype: Number,\n\t\t\tdefault: 328\n\t\t},\n\t\theight: Number\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tSELECTION_MODULE,\n\t\t\tcurrentValue: this.value,\n\t\t};\n\t},\n\tcomputed: {\n\t\tstyles() {\n\t\t\tconst { width } = this;\n\t\t\treturn { \n\t\t\t\tflex: `0 0 ${width}px`, \n\t\t\t\twidth: `${width}px`, \n\t\t\t};\n\t\t}\n\t},\n\twatch: {\n\t\tvalue: {\n\t\t\tdeep: true,\n\t\t\thandler(v) {\n\t\t\t\t// 相关触发失焦，frame 中子元素需要设置prevent，默认不阻止\n\t\t\t\tthis.resetCurEditor(this.value);\n\t\t\t}\n\t\t}\n\t},\n\tmethods: {\n\t\t/**\n\t\t * 延迟触发\n\t\t * 用户端在激活时不要立马做操作, 失焦事件需要触发对应的change事件\n\t\t */\n\t\tresetCurEditor: debounce(function () {\n\t\t\tthis.currentValue = this.value;\n\t\t}, 10),\n\n\t\t/**\n\t\t * hack操作\n\t\t * 业务上避免使用该操作\n\t\t *\n\t\t * 从Viewer传递出来\n\t\t * id 和 history 这是内部字段\n\t\t */\n\t\thandleChange(opts = {}) {\n\t\t\tif (typeof opts !== \'object\') return;\n\t\t\tconst { id, history, ...rest } = opts;\n\n\t\t\tconst changed = {};\n\t\t\tfor (let key in rest) {\n\t\t\t\tlet val = rest[key];\n\n\t\t\t\t[\'x\', \'y\', \'z\', \'r\', \'w\', \'h\'].includes(key) && (val = Number(val));\n\n\t\t\t\tif (hasOwn(rest, key) && !valueIsNaN(val)) {\n\t\t\t\t\tchanged[key] = val;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.$emit(\'change\', {\n\t\t\t\ttype: \'UPDATE\',\n\t\t\t\tid: id || this.currentValue.id,\n\t\t\t\tchanged,\n\t\t\t\t// 是否记录历史\n\t\t\t\thistory\n\t\t\t});\n\t\t},\n\n\t\t// 仅用于映射\n\t\temitChange(id, opts = {}) {\n\t\t\tthis.handleChange({\n\t\t\t\t...opts,\n\t\t\t\tid\n\t\t\t});\n\t\t}\n\t},\n};\n<\/script>\n<style lang="scss">\n@import "../../style/index.scss";\n\n$block: vm-editor;\n\n@include block($block) {\n\tflex-shrink: 0;\n\t@include element(wrapper) {\n\t\tposition: relative;\n\t\tpadding: 0;\n\t\theight: 100%;\n\t\tborder: 1px solid #0000001a;\n\t\tborder-radius: 0px;\n\t\tbox-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);\n\t\tbackground: #fff;\n\t\tz-index: 2;\n\t}\n\t@include element(arrow) {\n\t\tleft: -7px;\n\t\ttop: 20px;\n\t\twidth: 14px;\n\t\theight: 14px;\n\t\ttransform: translateX(-50%) rotate(45deg);\n\t\tbox-shadow: -3px 3px 7px rgba(0, 0, 0, 0.07);\n\t\tbackground: #fff;\n\t\ttransform: rotate(45deg);\n\t\tposition: absolute;\n\t\tborder-color: #0000;\n\t\tborder-style: solid;\n\t\tborder-left: 1px solid #0000001a;\n\t\tborder-bottom: 1px solid #0000001a;\n\t}\n}\n</style>\n']},media:void 0})}),Ee,void 0,!1,void 0,!1,yt,void 0,void 0);function Ce(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,i)}return e}function _e(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?Ce(Object(e),!0).forEach((function(n){S.default(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Ce(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}var $e=un(["Preview","PreviewPopup"]),ke=O.default($e,2),Be=ke[0],De=ke[1];n.Draggable=$t,n.Sortable=Ot,n.Widget=Tt,n.createVMDrags=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ht,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=n.mode,i=void 0===e?"draggable":e;try{Object.keys(t).forEach((function(n){"page"===t[n].module&&(t[n].data=_e(_e({},o.cloneDeep("function"==typeof t[n].data?t[n].data(0,t):t[n].data)),{},{draggable:!1,closeable:!1,resizable:!1,rotatable:!1}))}));var r=o.cloneDeep(n.Combo||xn),a=o.cloneDeep(n.Frame||("draggable"===i?he.Draggable:he.Sortable)),s=o.cloneDeep(n.Widget||fe),l=o.cloneDeep(n.Preview||Be),d=o.cloneDeep(n.Editor||we),A={},c={},m={};Object.keys(t).forEach((function(n,e){var i=o.kebabCase(n),r=t[n],a=r.Viewer,s=r.Editor,l=r.Widget;A["vm-".concat(i,"-viewer")]=a,c["vm-".concat(i,"-editor")]=s,m["vm-".concat(i,"-widget")]=l})),r.modules=t,r.viewers=A,r.editors=c,a.components=_e(_e({},a.components),A),d.components=_e(_e({},d.components),c),s.components=_e(_e({},s.components),m),r.components=_e(_e({},r.components),{},{"vm-frame":a,"vm-editor":d,"vm-widget":s}),l.components=_e(_e({},l.components),A);var u=o.cloneDeep(r),h=o.cloneDeep(l),p=new X.default(De,{mode:i,promise:!1,components:{"vm-preview":l}});return h.popup=p.popup,h.destroy=p.destroy,u.previewManager=p,{Combo:u,Preview:h}}catch(t){throw console.error("[wya-vm/register]",t),new Error(t)}}}}]);